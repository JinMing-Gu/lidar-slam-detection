var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,i=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&l(e,n,t[n]);return e},s=(e,a)=>t(e,n(a)),c=(e,t)=>{var n={};for(var l in e)r.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&a)for(var l of a(e))t.indexOf(l)<0&&o.call(e,l)&&(n[l]=e[l]);return n};import{r as m,R as u,S as p,T as d,c as f,C as g,B as h,m as E,u as v,N as x,i as b,a as y,b as w,d as C,e as S,E as k,P as M,M as I,f as N,g as P,h as R,D as _,j as L,k as A,l as z,n as F,o as O,A as D,p as T,q as j,s as B,t as U,v as G,w as V,x as H,y as q,z as $,F as W,G as Y,H as X,L as K,I as Z,J,K as Q,O as ee,Q as te,U as ne,V as ae,W as re,X as oe,Y as le,Z as ie,_ as se,$ as ce,a0 as me,a1 as ue,a2 as pe,a3 as de,a4 as fe,a5 as ge,a6 as he,a7 as Ee,a8 as ve,a9 as xe,aa as be,ab as ye,ac as we,ad as Ce,ae as Se,af as ke,ag as Me,ah as Ie,ai as Ne,aj as Pe,ak as Re,al as _e,am as Le,an as Ae,ao as ze,ap as Fe,aq as Oe,ar as De,as as Te,at as je,au as Be,av as Ue,aw as Ge,ax as Ve,ay as He,az as qe,aA as $e,aB as We,aC as Ye,aD as Xe,aE as Ke,aF as Ze,aG as Je,aH as Qe,aI as et,aJ as tt,aK as nt,aL as at,aM as rt,aN as ot,aO as lt,aP as it,aQ as st,aR as ct,aS as mt,aT as ut,aU as pt,aV as dt,aW as ft,aX as gt,aY as ht,aZ as Et,a_ as vt,a$ as xt,b0 as bt,b1 as yt,b2 as wt,b3 as Ct,b4 as St,b5 as kt,b6 as Mt,b7 as It,b8 as Nt,b9 as Pt,ba as Rt,bb as _t,bc as Lt,bd as At,be as zt,bf as Ft,bg as Ot,bh as Dt,bi as Tt,bj as jt,bk as Bt,bl as Ut,bm as Gt,bn as Vt,bo as Ht,bp as qt,bq as $t,br as Wt,bs as Yt,bt as Xt,bu as Kt,bv as Zt,bw as Jt,bx as Qt,by as en,bz as tn,bA as nn,bB as an,bC as rn,bD as on,bE as ln,bF as sn,bG as cn,bH as mn,bI as un,bJ as pn,bK as dn,bL as fn,bM as gn,bN as hn,bO as En,bP as vn,bQ as xn,bR as bn,bS as yn,bT as wn,bU as Cn,bV as Sn,bW as kn,bX as Mn,bY as In}from"./vendor.3980aeab.js";const Nn={components:{MuiTextField:{defaultProps:{variant:"outlined",fullWidth:!0}},MuiGrid:{defaultProps:{spacing:1,alignItems:"center"},styleOverrides:{container:{marginTop:"0.5rem"}}},MuiSwitch:{defaultProps:{color:"primary"}},MuiFormControl:{defaultProps:{variant:"outlined",fullWidth:!0}}},palette:{mode:"light"},typography:{subtitle1:{fontSize:"1rem",fontWeight:"bold"},subtitle2:{fontSize:"0.8rem",fontWeight:"bold"},h6:{fontSize:"1.2rem",fontWeight:"bold"}}};function Pn({isDarkMode:e,children:t}){const[n,a]=m.exports.useState(Nn);return m.exports.useEffect((()=>{a((t=>s(i({},t),{palette:{mode:e?"dark":"light"}})));var t=document.head,n=document.createElement("style");return n.textContent=e?"\n:root {\n    --tp-base-background-color: hsla(230, 7%, 20%, 1.00);\n    --tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);\n    --tp-button-background-color: hsla(230, 7%, 70%, 1.00);\n    --tp-button-background-color-active: hsla(230, 7%, 85%, 1.00);\n    --tp-button-background-color-focus: hsla(230, 7%, 80%, 1.00);\n    --tp-button-background-color-hover: hsla(230, 7%, 75%, 1.00);\n    --tp-button-foreground-color: hsla(230, 7%, 20%, 1.00);\n    --tp-container-background-color: hsla(230, 7%, 75%, 0.10);\n    --tp-container-background-color-active: hsla(230, 7%, 75%, 0.25);\n    --tp-container-background-color-focus: hsla(230, 7%, 75%, 0.20);\n    --tp-container-background-color-hover: hsla(230, 7%, 75%, 0.15);\n    --tp-container-foreground-color: hsla(230, 0%, 100%, 1.00);\n    --tp-groove-foreground-color: hsla(230, 0%, 0%, 0.20);\n    --tp-input-background-color: hsla(230, 7%, 0%, 0.20);\n    --tp-input-background-color-active: hsla(230, 7%, 0%, 0.35);\n    --tp-input-background-color-focus: hsla(230, 7%, 0%, 0.30);\n    --tp-input-background-color-hover: hsla(230, 7%, 0%, 0.25);\n    --tp-input-foreground-color: hsla(230, 7%, 75%, 1.00);\n    --tp-label-foreground-color: hsla(230, 0%, 100%, 1.00);\n    --tp-monitor-background-color: hsla(230, 7%, 0%, 0.20);\n    --tp-monitor-foreground-color: hsla(230, 7%, 75%, 0.70);\n  }\n":"\n:root {\n    --tp-base-background-color: hsla(230, 5%, 90%, 1.00);\n    --tp-base-shadow-color: hsla(0, 0%, 0%, 0.10);\n    --tp-button-background-color: hsla(230, 7%, 75%, 1.00);\n    --tp-button-background-color-active: hsla(230, 7%, 60%, 1.00);\n    --tp-button-background-color-focus: hsla(230, 7%, 65%, 1.00);\n    --tp-button-background-color-hover: hsla(230, 7%, 70%, 1.00);\n    --tp-button-foreground-color: hsla(230, 10%, 30%, 1.00);\n    --tp-container-background-color: hsla(230, 15%, 30%, 0.20);\n    --tp-container-background-color-active: hsla(230, 15%, 30%, 0.32);\n    --tp-container-background-color-focus: hsla(230, 15%, 30%, 0.28);\n    --tp-container-background-color-hover: hsla(230, 15%, 30%, 0.24);\n    --tp-container-foreground-color: hsla(230, 10%, 30%, 1.00);\n    --tp-groove-foreground-color: hsla(230, 15%, 30%, 0.10);\n    --tp-input-background-color: hsla(230, 15%, 30%, 0.10);\n    --tp-input-background-color-active: hsla(230, 15%, 30%, 0.22);\n    --tp-input-background-color-focus: hsla(230, 15%, 30%, 0.18);\n    --tp-input-background-color-hover: hsla(230, 15%, 30%, 0.14);\n    --tp-input-foreground-color: hsla(230, 10%, 30%, 1.00);\n    --tp-label-foreground-color: hsla(230, 10%, 30%, 0.70);\n    --tp-monitor-background-color: hsla(230, 15%, 30%, 0.10);\n    --tp-monitor-foreground-color: hsla(230, 10%, 30%, 0.50);\n  }\n",t.appendChild(n),()=>{t.removeChild(n)}}),[e]),u.createElement(p,{injectFirst:!0},u.createElement(d,{theme:f(n)},u.createElement(g,null),t))}function Rn({toggle:e,children:t}){const n=m.exports.useRef({queue:[]});return u.createElement(h,{color:"inherit",onClick:()=>{const{queue:t}=n.current,a=performance.now();t.push(a),t[0]<a-5e3&&t.shift(),t.length>=5&&(n.current.queue=[],e())}},t)}const _n=E((e=>({buttonSelected:{"& div":{borderBottom:"1px solid"}},link:{color:"white",textDecoration:"none"}})));function Ln({links:e=[]}){const{t:t}=v(),n=_n();return u.createElement("div",null,e&&e.map((e=>u.createElement(x,{to:`/${e}`,activeClassName:n.buttonSelected,className:n.link,key:e},u.createElement(h,{key:e,color:"inherit"},u.createElement("div",null,t(e)))))))}const An={"zh-CN":{translation:{"zh-CN":"简体中文","en-US":"English",Day:"天",Hour:"时",Minute:"分",Second:"秒",Permanent:"永久",home:"主页",config:"配置",preview:"预览",calibration:"标定",configDev:"配置（开发者）",log:"日志",upgrade:"升级",PowerOff:"关机",Reboot:"重启",ConfirmPowerOff:"您确定关闭系统吗?",ConfirmReboot:"您确定重启系统吗?",NoPermit:"软件未授权",Permit:"激活正常",NoPermitDescription:"软件试用时间已到，请联系厂商获取激活码",LicenceUage:"许可证使用剩余时间: ",NoPermitUpgrade:"试用版软件，无法升级",ValidNumber:"激活码",Register:"激活",RegisterSuccess:"激活成功,页面正在跳转",RegisterError:"激活失败",currentDevice:"本机用户",ClientIP:"客户端",LastConnectTime:"最近时间",RequestCount:"请求次数",Action:"访问限制",Allow:"允许",Deny:"禁止",device:"设备信息",network:"网络",lidar:"激光设置",camera:"相机设置",radar:"雷达设置",radarDevice:"输入接口",collection:"数据采集",Mode:"模式",detect:"目标检测",slam:"建图定位",detect_slam:"目标检测+建图定位",output:"输出方式",advance:"高级选项",reset:"重置",update:"更新",OpenTerminal:"终端",selectConfig:"配置选择",selectCalibration:"标定选择",BoardConfig:"设备参数",SelectFunctions:"功能选择",address:"地址",netmask:"子网掩码",gateway:"网关",timesync:"时间同步",master:"主机模式",slave:"从机模式",eth0:"网络接口0",eth1:"网络接口1",eth2:"网络接口2",eth3:"网络接口3",server:"服务器地址",inputDevice:"输入设备",workmode:"工作模式",duplicatedInterface:"网络接口重复",duplicatedServer:"地址重复",objects:"目标类别",vehicle:"车辆",pedestrian:"行人",cyclist:"骑行者",traffic_cone:"三角锥",freespace:"可行驶区域",destination:"目标地址",coordinate:"坐标系",baud:"波特率",freespaceConfig:"可行驶区域",minHeight:"最小高度",maxHeight:"最大高度",resolution:"分辨率",slamMethod:"建图算法",method:"算法",mapping:"建图模式",localization:"定位模式",sensor:"传感器配置",mapParam:"地图参数",locParam:"定位参数",distance:"距离步长",rotation:"角度步长",LocDistance:"地图采样距离步长",LocRotation:"地图采样角度步长",mapResolution:"精度",locResolution:"下采样精度",mapKeyFrameRange:"关键帧范围",originLat:"原点纬度",originLon:"原点经度",originAlt:"原点海拔",originMannual:"手动指定",originAuto:"自动计算",mapPath:"地图路径",otherParam:"其他参数",groundConstraint:"地面约束",loopClosure:"回环检测",pointcloudForward:"点云转发",system:"系统",resetSetting:"恢复出厂设置",needRestore:"用户配置将会被清除！ 请确认是否恢复出厂设置？",name:"设备名称",port:"端口号",roi:"最大范围",intrinsics:"内参",extrinsics:"外参",imageWidth:"宽度",imageHeight:"高度",undistortion:"畸变校准",stream:"远程推流",streamProtocol:"推流协议",True:"是",False:"否",ins:"惯导设置",insType:"输出类型",insExtrinsic:"惯导外参",imuExtrinsic:"IMU外参",insStatusTable:"惯导状态",switchOn:"启用",switchOff:"禁用",rtkFix:"固定解",rtkFloat:"浮点解",rtkNormal:"一般解",rtkStatus:"状态值",rtkStableTime:"稳定时间",rtkPrecision:"定位精度",insRelay:"惯导转发",invalidConfig:"无效配置",configReset:"配置已重置",configUpdated:"配置已更新",needReboot:"设备需要重启以应用当前配置，是否确认？",yes:"确认",no:"取消",abortReboot:"重启已取消",doReboot:"正在重启设备，请等待页面自动刷新",hostTime:"主机时间",deviceTime:"设备时间",status:"设备状态",disk:"外接磁盘",diskVolume:"容量 ",diskLeft:"剩余 ",viewFile:"浏览",mode:"运行模式",online:"实时",offline:"回放","Network Error":"网络异常",Booting:"启动中",Initializing:"初始化中",Paused:"暂停",Running:"运行中",roiAdd:"添加ROI",roiDel:"删除ROI",roiSegIn:"取内部区域",roiSegOut:"取外部区域",roiCancel:"取消",selectFile:"选择文件夹",playbackRate:"倍速",playbackPosition:"当前播放",restartMapping:"重新建图",saveMap:"保存地图",mapEditor:"地图编辑",radarDisplay:"毫米波显示",ActiveFloorContraint:"使能地面约束",DeactiveFloorContraint:"关闭地面约束",setInitPoseOk:"初始位置设定成功",startEstimationInitPose:"在地图上滑动鼠标，选取起始位置",loopDetected:"回环检测成功！",invalidName:"非法名称",invalidAddress:"非法地址",invalidPort:"非法端口号",duplicatedPorts:"端口号重复",duplicatedName:"设备名称重复",invalidNumber:"非法数字",invalidBaud:"非法波特率",invalidFreespaceResolution:"分辨率应在0.2-1.0之间",invalidMapResolution:"分辨率应在0.1-1.0之间",invalidLocResolution:"分辨率应在0-1.0之间",invalidInterval:"步长应该在0-100之间",invalidKeyFrameRange:"范围应在0-1000之间",emptySensorInput:"传感器配置不能为空",calibrate_lidar:"激光雷达标定",calibrate_lidar_camera:"激光雷达-相机标定",calibrate_camera:"相机内参标定",calibrate_lidar_radar:"激光雷达-毫米波标定",calibrate_lidar_ins:"激光雷达-惯导标定",calibrate_lidar_imu:"激光雷达-IMU标定",calibrate_panorama_camera:"全景相机标定",stepNameCalibCamera:"相机标定",helpMsgCalibCamera:"将标定棋盘格摆放在不同位置，按下空格键选取图片，完成角点检测（不小于10张）",helpMsgCalibCameraCheck:"使用Ctrl键切换图像，检查畸变矫正的效果",boardCol:"列数: ",boardRow:"棋盘格行数: ",boardSize:"尺寸: ",calibPreview:"预览",calibStatus:"状态",stepNameSelectCamera:"选择相机",stepNameCalibLidarAndCamera:"联合标定",stepNameCheck:"结果检查",helpMsgSelectCamera:"请选择需要标定的相机",helpMsgCalibLidarAndCamera:"请按住空格键暂停，在暂停状态下按住Ctrl键并使用鼠标左键，在左右视图中分别选择对应的参考点（不少于4对）",helpMsgCheck:"",clearPoints:"清空点",previousFrame:"前一帧",nextFrame:"后一帧",stepNameSelectLidar:"选择雷达",stepNameCalibGroud:"标定地面",stepNameCalibFront:"标定朝向",stepNameFinetune:"参数微调",helpMsgSelectLidar:"请选择需要标定的激光雷达",helpMsgCalibGroud:"请按住Ctrl键并使用鼠标左键框选地面区域，通过鼠标右键闭合所选区域，点击[下一步]进行地面标定",helpMsgCalibFront:"请按住Ctrl键并使用鼠标左键来选择参考点（多于1个），并在右侧输入参考点在参考坐标系下的坐标，输入完成后点击[下一步]进行朝向标定,",helpMsgFinetune:"",next:"下一步",previous:"上一步",skip:"跳过",resetCalibration:"再次标定",calibFinish:"完成",redraw:"重画",setPoints:"请在下方输入点的目标坐标值:",local:"局部",global:"全局",useCoordinate:"标定采用 ",Coordinate:"坐标系",stepNameLidarInsBegin:"开始标定",stepNameLidarInsCalib:"联合标定",stepNameLidarInsCheck:"参数微调",helpMsgLidarInsBegin:"请确保激光雷达与惯导设备连接正常",helpMsgLidarInsCalib:"请发动车辆，并按照8字路线低速行驶",helpMsgLidarInsCheck:"请等待标定结果收敛，并进行参数微调",notConnected:"状态: 设备未连接",LidarInsConnect:"状态: 激光雷达（正常） 惯导（正常）",InsDisconnect:"状态: 激光雷达（正常） 惯导（未连接）",LidarDisconnect:"状态: 激光雷达（未连接） 惯导（正常）",LidarInsDisconnect:"状态: 激光雷达（未连接） 惯导（未连接）",calibProgress:"行驶进度 ",optProgress:"标定进度 ",index:"序号",xCar:"x",yCar:"y",LatCar:"纬度",LonCar:"经度",xLidar:"",yLidar:"",action:"动作",target:"目标",reference:"参考",stepNameLidarImuBegin:"开始标定",stepNameLidarImuCalib:"联合标定",stepNameLidarImuCheck:"结果检查",helpMsgLidarImuBegin:"请确保激光雷达与惯导设备连接正常",helpMsgLidarImuCalib:"请发动车辆，并按照8字路线低速行驶",helpMsgLidarImuCheck:"请检查绿色线段（激光雷达行驶轨迹）与红色线段（IMU行驶轨迹）是否重合较好",stepNameSelectRadar:"选择毫米波",helpMsgSelectRadar:"请选择需要标定的毫米波雷达",Camera:"相机",helpMsgSelectPanoramaCamera:"按视角从左往右顺序选择需要全景标定的相机（至多3个）",helpMsgCalibPanoramaCamera:"调整相机位置，使多个相机视角平行，并且包含一定的重叠区域，按下“空格”键进行标定",helpMsgCalibPanoramaCameraCheck:"检查全景相机拼接结果",CurrentStitchCamera:"当前标定的相机: ",axis:"坐标轴",size:"尺寸",visible:"显示",frustumCulled:"视锥剔除",objectVisible:"3D显示",map:"地图",step:"间隔",showOnImage:"2D显示",objectType:"目标类别",sensorType:"传感器类型",objObject:"模型",polarGrid:"极坐标栅格",radius:"半径",radials:"周向分区数",circles:"轴向分区数",color:"颜色",gray:"灰色",depth:"深度",rgb:"RGB",height:"高度",intensity:"强度",maxIntensity:"最大强度",sampleStep:"下采样尺寸",type:"视角",NORMAL:"默认",UP:"俯视",DRIVER:"驾驶员",FOLLOW:"跟随",SELF:"第一人称",pointcloud:"点云",object:"目标",direction:"包围框方向",details:"详细信息",labelScale:"标签尺寸",trajectory:"预测轨迹",freespaceSub:"可通行区域",currentVersion:"当前版本",InvalidFirmware:"无效文件",Choose:"选择固件",Upgrade:"升级",FirmwareInfo:"固件详情",uploadFirmware:"开始升级",idle:"等待升级",uploading:"上传固件",preparing:"升级准备",upgrading:"正在升级",verifying:"系统校验",postprocessing:"文件清理",restarting:"系统重启",failed:"升级失败",success:"升级成功",UpgradeDone:"完成",UnKnown:"未知",mapEdge:"显示轨迹",OpeningMaps:"正在打开地图...",loadingMaps:"正在加载地图数据, 请耐心等待...",ClosingMap:"正在关闭地图...",DeletingMap:"正在进行删除操作...",finishLoadingMaps:"地图加载已完成",finishClosingMap:"地图关闭已完成",finishDeletingMap:"删除操作已完成",NotSupportReversePoints:"暂不支持点云反向选取操作",Vertex:"顶点",Edge:"边",Delete:"删除",File:"文件",MapOpen:"打开地图",MapMerge:"合并地图",MapSave:"保存地图",MapExport:"导出点云",MapClose:"关闭地图",confirmCloseMap:"确认关闭地图",warnCloseMap:"未保存的地图数据将会丢失，请确认是否关闭地图",MapInputSaveName:"请输入需要保存地图的文件名称",MapExit:"退出编辑",Edit:"编辑",MapManualLoop:"手动回环",AutoAlign:"对齐",Reset:"重置",MapOptimization:"优化视图",zRange:"高度范围",id:"序号",pos:"坐标",stamp:"时间戳",fix:"固定",LoopBegin:"回环起点",LoopEnd:"回环终点",SelectionDelete:"删除选取",confirmDeleteSelect:"正在删除数据",needOptimize:"操作完成后是否进行地图优化?",View:"视图",RefreashMap:"刷新地图",MapSelection:"框选地图",VertexSelection:"节点",PointsSelection:"点云",ReverseSelection:"反向选取",MapClearSelection:"清除选择",MapGraphInfo:"地图详情",MapStatistics:"统计信息",MapVertexNum:"顶点数",MapEdgeNum:"边数",FixedVertex:"固定顶点",UnFix:"取消固定",Help:"帮助",MapAbout:"关于",aboutTitle:"TSARI 地图编辑软件",AddMessage:"添加消息",AddChart:"曲线图",selectMessage:"选择消息",ChartConfig:"曲线图设置",charXData:"选择X轴数据",charYData:"选择Y轴数据",charDataViz:"显示列表",AddAxisData:"新增曲线",chartWidth:"窗口宽度",chartDomain:"坐标轴范围",SetCloudMessageConfig:"点云显示参数",OdometryConfig:"里程计显示参数",OdometryQueue:"队列长度",OdometryAxisSize:"坐标尺寸",PathConfig:"路径显示参数",LineWidth:"线段宽度",PointSize:"点尺寸"}},"en-US":{translation:{"zh-CN":"简体中文","en-US":"English",home:"Home",config:"Config",preview:"Preview",calibration:"Calibration",configDev:"Config(Dev)",log:"Log",upgrade:"Upgrade",PowerOff:"PowerOff",Reboot:"Reboot",ConfirmPowerOff:"Confirm to power off",ConfirmReboot:"Confirm to reboot",currentDevice:"Current User",ClientIP:"Client",LastConnectTime:"Time",RequestCount:"Requests",Action:"Action",device:"Device",network:"Network",lidar:"Lidar",camera:"Camera",radar:"Radar",collection:"Acquisition",Mode:"Mode",detect:"Detect",slam:"SLAM",detect_slam:"Detect+SLAM",output:"Output",advance:"Advance",reset:"Reset",update:"Update",OpenTerminal:"Terminal",selectConfig:"Select Config",selectCalibration:"Select Calibration",BoardConfig:"Board Config",SelectFunctions:"Select Functions",address:"Address",netmask:"Netmask",gateway:"Gateway",timesync:"Time Sync",master:"Master",slave:"Slave",eth0:"Eth0",eth1:"Eth1",eth2:"Eth2",eth3:"Eth3",server:"Server Address",inputDevice:"Input Device",workmode:"Mode",objects:"Object Type",vehicle:"Vehicle",pedestrian:"Pedestrian",cyclist:"Cyclist",traffic_cone:"Traffic Cone",freespace:"Freespace",destination:"Destination",coordinate:"Coordinate",baud:"Baud",freespaceConfig:"Freespace Config",minHeight:"Min Height",maxHeight:"Max Height",resolution:"Resolution",slamMethod:"Slam Algorithm",method:"Algorithm",mapping:"Mapping",localization:"Localization",sensor:"Sensor Configuration",mapParam:"Map Configuration",locParam:"Localization Configuration",distance:"Distance",rotation:"Rotation",LocDistance:"Distance",LocRotation:"Rotation",mapResolution:"Resolution",locResolution:"Resolution",mapKeyFrameRange:"Keyframe Range",originLat:"Origin Lat",originLon:"Origin Lon",originAlt:"Origin Alt",originMannual:"Mannual",originAuto:"Auto",mapPath:"Map Path",otherParam:"Other Parameters",groundConstraint:"Ground Constraint",loopClosure:"Loop Closure",pointcloudForward:"Point Cloud Forward",system:"System",resetSetting:"Restore Setting",needRestore:"User settings will be cleanup, make sure to restore?",name:"Name",port:"Port",roi:"Max Range",intrinsics:"Intrinsics",extrinsics:"Extrinsics",imageWidth:"Width",imageHeight:"Height",undistortion:"Undistortion",stream:"Streaming",streamProtocol:"Protocol",radarDevice:"Input Device",ins:"INS",insType:"Output Type",insExtrinsic:"INS Extrinsics",imuExtrinsic:"IMU Extrinsics",insStatusTable:"INS Status Table",switchOn:"On",switchOff:"Off",rtkFix:"RTK Fix",rtkFloat:"RTK Float",rtkNormal:"RTK Normal",rtkStatus:"Status",rtkStableTime:"Stable Time",rtkPrecision:"Precision",insRelay:"Ins Relay",invalidConfig:"Invalid Config",configReset:"Config is reset",configUpdated:"Config is updated",needReboot:"System need reboot to perform this operation, are you sure?",yes:"Confirm",no:"Cancel",abortReboot:"Reboot aborted!",doReboot:"Rebooting, please wait for page reloading.",hostTime:"Host Time",deviceTime:"Device Time",status:"Status",disk:"Disk",diskVolume:"Volume ",diskLeft:"Free ",viewFile:"View",mode:"Mode",online:"Online",offline:"Offline",roiAdd:"Add ROI",roiDel:"Delete  ROI",roiSegIn:"Segment In",roiSegOut:"Segment Out",roiCancel:"Cancel",selectFile:"Select Directory",playbackRate:"X",playbackPosition:"Current",restartMapping:"Restart Mapping",saveMap:"Save Mapping",mapEditor:"Map Editor",radarDisplay:"Radar Display",ActiveFloorContraint:"Enable Floor Constraint",DeactiveFloorContraint:"Disable Floor Constraint",setInitPoseOk:"Initialize Pose",startEstimationInitPose:"Move mouse to set the initial pose",loopDetected:"Loop is detected!",invalidName:"Invalid Name",invalidAddress:"Invalid Address",invalidPort:"Invalid Port",duplicatedPorts:"Duplicated Ports",duplicatedName:"Duplicated Names",invalidNumber:"Invalid Number",invalidBaud:"Invalid Baud",invalidFreespaceResolution:"Invalid Resolution",invalidMapResolution:"Invalid Resolution",invalidLocResolution:"Invalid Resolution",invalidInterval:"Invalid Number",invalidKeyFrameRange:"Invalid Range",emptySensorInput:"Invalid Input",calibrate_lidar:"Lidar Calibration",calibrate_lidar_camera:"Lidar & Camera Calibration",calibrate_camera:"Camera Calibration",calibrate_lidar_radar:"Lidar & Radar Calibration ",calibrate_lidar_ins:"Lidar & INS Calibration",calibrate_lidar_imu:"Lidar & IMU Calibration",calibrate_panorama_camera:"Panorama Camera Calibration",stepNameCalibCamera:"Calibrate",helpMsgCalibCamera:"Put the chessboard on the different position. Press space to select photo and detect the corners（more than 10 frames）",helpMsgCalibCameraCheck:"Press Ctrl to switch the image, check the distortion result",boardCol:"Col: ",boardRow:"Chessboard Row: ",boardSize:"Size: ",calibPreview:"Preview",calibStatus:"Status",stepNameSelectCamera:"Select Camera",stepNameCalibLidarAndCamera:"Calibrate",stepNameCheck:"Check",helpMsgSelectCamera:"Camera",helpMsgCalibLidarAndCamera:"Select points and click next",helpMsgCheck:"",clearPoints:"Clear",previousFrame:"Previous",nextFrame:"Next",stepNameSelectLidar:"LiDAR selection",stepNameCalibGroud:"Ground calibration",stepNameCalibFront:"Orientation calibration",stepNameFinetune:"Finetune",helpMsgSelectLidar:"Please select the LiDAR for calibration",helpMsgCalibGroud:"Please press Ctrl, use left click to pick the ground area, use right click to close the area, click NEXT and wait for ground calibration ",helpMsgCalibFront:"Please press Ctrl, use left click to pick the reference points(more than 1), fill the table in the right side with the coordinates of the points in the target reference coordinate system",helpMsgFinetune:"",next:"Next",previous:"Previous",skip:"Skip",resetCalibration:"Reset",calibFinish:"Finish",redraw:"Redraw",setPoints:"Please set target points value here:",local:"Local",global:"Global",useCoordinate:"Calibration Use ",Coordinate:"Coordinate",stepNameLidarInsBegin:"Begin",stepNameLidarInsCalib:"Calibrate",stepNameLidarInsCheck:"Finetune",helpMsgLidarInsBegin:"Please ensure the Lidar and INS sensors are well connected",helpMsgLidarInsCalib:"Please drive the vehicle and make the route like 8",helpMsgLidarInsCheck:"Finetune the calibration result",notConnected:"Status: device not connected",LidarInsConnect:"Status: Lidar(Connected) INS(Connected)",InsDisconnect:"Status: Lidar(Connected) INS(Disconnected)",LidarDisconnect:"Status: Lidar(Disconnected) INS(Connected)",LidarInsDisconnect:"Status: Lidar(Disconnected) INS(Disconnected)",calibProgress:"Calibration progress ",optProgress:"Optimization progress ",stepNameLidarImuBegin:"Begin",stepNameLidarImuCalib:"Calibrate",stepNameLidarImuCheck:"Check",helpMsgLidarImuBegin:"Please ensure the Lidar and INS sensors are well connected",helpMsgLidarImuCalib:"Please drive the vehicle and make the route like 8",helpMsgLidarImuCheck:"Please check the green line(lidar trajectory) and red line(IMU trajectory) match well",index:"Index",xCar:"x",yCar:"y",LatCar:"lat",LonCar:"lng",xLidar:"",yLidar:"",action:"Action",target:"Target",reference:"Reference",stepNameSelectRadar:"Radar selection",helpMsgSelectRadar:"Please select the Radar for calibration",Camera:"Camera",helpMsgSelectPanoramaCamera:"Select cameras for stitching (from left to right)",helpMsgCalibPanoramaCamera:'Adjust the camera position and ensure the overlaps of views. Press "Space" to calibrate',helpMsgCalibPanoramaCameraCheck:"Check the panorama camera stitching result",CurrentStitchCamera:"Current cameras for calibration",rgb:"RGB",axis:"Axis",size:"Size",visible:"Display",frustumCulled:"Frustum Culled",objectVisible:"3D Display",map:"Map",step:"Step",showOnImage:"2D Display",objectType:"Object Type",sensorType:"Sensor Type",objObject:"Model",polarGrid:"Polar Grid",radius:"Radius",radials:"Radials",circles:"Circles",gray:"Gray",depth:"Depth",height:"Height",intensity:"Intensity",maxIntensity:"Max Intensity",sampleStep:"Downsample Size",type:"Type",NORMAL:"Normal",UP:"Up",DRIVER:"Driver",FOLLOW:"Follow",SELF:"First Person",pointcloud:"Pointcloud",color:"Color",object:"Object",direction:"Direction",details:"Details",labelScale:"Label Scale",trajectory:"Trajectory",freespaceSub:"Freespace",currentVersion:"Version",InvalidFirmware:"Invalid File",Choose:"Choose",Upgrade:"Upgrade",FirmwareInfo:"Firmware Detail",uploadFirmware:"Upload",idle:"Idle",uploading:"Uploading",preparing:"Preparing",upgrading:"Upgrading",verifying:"Verifying",postprocessing:"Postprocessing",restarting:"Restarting",failed:"Fail",success:"Success",UpgradeDone:"Finish",UnKnown:"UnKnown",mapEdge:"Trajectory",OpeningMaps:"Opening map...",loadingMaps:"Loading map data, please wait...",ClosingMap:"Closing map...",DeletingMap:"Deleting...",finishLoadingMaps:"Loading complete",finishClosingMap:"Closing complete",finishDeletingMap:"Deleting complete",NotSupportReversePoints:"Unsupport operation",Vertex:"Vertex",Edge:"Edge",Delete:"Delete",File:"File",MapOpen:"Open",MapMerge:"Merge",MapSave:"Save",MapExport:"Export",MapClose:"Close",confirmCloseMap:"Confirm to close map",warnCloseMap:"map data will be lost, please confirm to close the map",MapInputSaveName:"Please input the name of map",MapExit:"Exit",Edit:"Edit",MapManualLoop:"Manual Loop",AutoAlign:"Align",Reset:"Reset",MapOptimization:"Optimize",zRange:"Z Range",id:"ID",pos:"Pos",stamp:"TimeStamp",fix:"Fix",LoopBegin:"Loop Begin",LoopEnd:"Loop End",SelectionDelete:"Delete",confirmDeleteSelect:"Deleting",needOptimize:"Do you want to optimize the map after deleting?",View:"View",RefreashMap:"Refresh",MapSelection:"Select",VertexSelection:"Vertex",PointsSelection:"Points",ReverseSelection:"Reverse",MapClearSelection:"Clear",MapGraphInfo:"Statistics",MapStatistics:"Information",MapVertexNum:"Vertex Num",MapEdgeNum:"Edge Num",FixedVertex:"Fixed Vertex",UnFix:"UnFix",Help:"Help",MapAbout:"About",aboutTitle:"TSARI Map Editor",AddMessage:"Add Message",AddChart:"Chart",selectMessage:"Message",ChartConfig:"Chart Setting",charXData:"Axis X Data",charYData:"Axis Y Data",charDataViz:"Data List",AddAxisData:"Add",chartWidth:"Windows Size",chartDomain:"Axis Domain",SetCloudMessageConfig:"PointCloud Setting",OdometryConfig:"Odometry Setting",OdometryQueue:"Queue",OdometryAxisSize:"Axis Size",PathConfig:"Path Setting",LineWidth:"Line Width",PointSize:"Point Size"}}};b.use(y).init({resources:An,lng:"zh-CN",keySeparator:!1,interpolation:{escapeValue:!1}});const zn=Object.keys(An);function Fn(){const{t:e,i18n:t}=v(),[n,a]=w("locale",zn[0]);m.exports.useEffect((()=>{t.changeLanguage(n)}),[n,t]);const[r,o]=m.exports.useState(null);return u.createElement("div",null,u.createElement(h,{color:"inherit",onClick:e=>{o(e.currentTarget)}},u.createElement(C,null),u.createElement(S,{ml:"0.5rem"},e(n)),u.createElement(k,null)),u.createElement(M,{anchorEl:r,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},open:Boolean(r),onClose:()=>{o(null)}},zn.map((t=>u.createElement(I,{onClick:()=>(a(t),void o(null)),key:t},e(t))))))}function On({value:e,onChange:t}){return u.createElement(h,{onClick:()=>t("light"===e?"dark":"light"),color:"inherit"},"light"===e?u.createElement(N,null):u.createElement(P,null))}const Dn=E((e=>({popover:{pointerEvents:"none"},typography:{padding:e.spacing(1)}})));function Tn({content:e="",onConfirm:t,onCancel:n}){const[a,r]=m.exports.useState(!1),{t:o}=v();return[u.createElement("div",null,u.createElement(_,{open:a},u.createElement(L,null,e),u.createElement(A,null,u.createElement(h,{onClick:()=>{r(!1),n&&n()}},o("no")),u.createElement(h,{onClick:()=>{r(!1),t&&t()}},o("yes"))))),()=>{r(!0)}]}function jn(){const[e,t]=m.exports.useState(!1),[n,a]=m.exports.useState(""),[r,o]=m.exports.useState();return[u.createElement(z,{open:e,message:n,autoHideDuration:r,onClose:()=>t(!1),anchorOrigin:{vertical:"bottom",horizontal:"left"}}),(e,n=2e3)=>{t(!0),a(e),o(n)}]}function Bn(){const[e,t]=m.exports.useState("Popover content placeholder"),[n,a]=m.exports.useState(void 0),[r,o]=m.exports.useState(),[l,s]=m.exports.useState({}),c=()=>{o(void 0)},p=Dn();return[u.createElement(M,i({open:Boolean(r),anchorEl:r,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},marginThreshold:0,onClose:c,className:p.popover},l),n&&u.createElement(R,{style:{display:"inline-block",fontWeight:"bold"},className:p.typography,variant:"body2"},n),u.createElement(R,{style:{display:"inline-block"},className:p.typography,variant:"body2"},e)),(e,n,r={anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},l)=>{o(e.currentTarget),t(n),s(r),a(l)},c]}const Un=new URL(window.location.href),Gn=""==Un.port||"1234"==Un.port?1235:parseInt(Un.port)+500,Vn=window.location.host.split(":")[0],Hn=F.create({baseURL:`http://${Vn}:${Gn}/`});var qn={nested:{Point3D:{fields:{x:{rule:"required",type:"double",id:1,options:{default:null}},y:{rule:"required",type:"double",id:2,options:{default:null}},z:{rule:"required",type:"double",id:3,options:{default:null}}}},Box3D:{fields:{center:{rule:"required",type:"Point3D",id:1},length:{rule:"required",type:"float",id:2},width:{rule:"required",type:"float",id:3},height:{rule:"required",type:"float",id:4},heading:{rule:"required",type:"float",id:5}}},Trajectory:{fields:{x:{rule:"required",type:"double",id:1},y:{rule:"required",type:"double",id:2},z:{rule:"required",type:"double",id:3},heading:{rule:"required",type:"float",id:4},velocityX:{rule:"required",type:"float",id:5},velocityY:{rule:"required",type:"float",id:6},relativeTimestamp:{rule:"required",type:"uint64",id:7}}},Header:{fields:{version:{type:"bytes",id:1},timestamp:{type:"uint64",id:2},relativeTimestamp:{type:"uint64",id:3},fps:{type:"float",id:4}}},Pose:{fields:{x:{rule:"required",type:"float",id:1},y:{rule:"required",type:"float",id:2},z:{rule:"required",type:"float",id:3},heading:{rule:"required",type:"float",id:4},pitch:{rule:"required",type:"float",id:5},roll:{rule:"required",type:"float",id:6},latitude:{type:"double",id:7},longitude:{type:"double",id:8},altitude:{type:"double",id:9},status:{type:"int32",id:10},state:{type:"string",id:11}}},Object:{fields:{id:{rule:"required",type:"uint32",id:1},type:{rule:"required",type:"Type",id:2},confidence:{rule:"required",type:"float",id:3},box:{rule:"required",type:"Box3D",id:4},velocityX:{rule:"required",type:"float",id:5},velocityY:{rule:"required",type:"float",id:6},angleRate:{rule:"required",type:"float",id:7},accelX:{rule:"required",type:"float",id:8},valid:{rule:"required",type:"bool",id:9},status:{rule:"required",type:"Status",id:10},age:{rule:"required",type:"uint32",id:11},trajectory:{rule:"repeated",type:"Trajectory",id:12},sensor:{rule:"required",type:"SensorType",id:13}},nested:{Type:{values:{UNKNOWN:0,VEHICLE:1,PEDESTRIAN:2,CYCLIST:3,CONE:4}},Status:{values:{UNDEFINED:0,STATIC:1,STOPPED:2,MOVING:3}},SensorType:{values:{LIDAR:0,CAMERA:1,RADAR:2,LIDAR_CAMERA:3,RADAR_CAMERA:4,LIDAR_RADAR_CAMERA:5}}}},FreespaceInfo:{fields:{xMin:{rule:"required",type:"float",id:1},xMax:{rule:"required",type:"float",id:2},yMin:{rule:"required",type:"float",id:3},yMax:{rule:"required",type:"float",id:4},zMin:{rule:"required",type:"float",id:5},zMax:{rule:"required",type:"float",id:6},resolution:{rule:"required",type:"float",id:7},xNum:{rule:"required",type:"int64",id:8},yNum:{rule:"required",type:"int64",id:9}}},Freespace:{fields:{info:{type:"FreespaceInfo",id:1},cells:{type:"bytes",id:2}}},CameraImage:{fields:{cameraName:{rule:"required",type:"string",id:1},image:{rule:"required",type:"bytes",id:2}}},Radar:{fields:{radarName:{type:"string",id:1},radarObject:{rule:"repeated",type:"Object",id:2}}},Detection:{fields:{header:{type:"Header",id:1},object:{rule:"repeated",type:"Object",id:2},freespace:{type:"bytes",id:3},points:{type:"bytes",id:4},image:{rule:"repeated",type:"CameraImage",id:5},radar:{rule:"repeated",type:"Radar",id:6},pose:{type:"Pose",id:7}}},LidarPointcloud:{fields:{lidarName:{rule:"required",type:"string",id:1},points:{rule:"required",type:"bytes",id:2},attr:{type:"bytes",id:3},type:{type:"string",id:4}}},CameraImageBytes:{fields:{cameraName:{rule:"required",type:"string",id:1},image:{rule:"required",type:"bytes",id:2}}},LidarPointcloudMap:{fields:{lp:{rule:"repeated",type:"LidarPointcloud",id:1},image:{rule:"repeated",type:"CameraImageBytes",id:2}}}}};const $n=window.protobuf;console.log($n);const Wn=$n.Root.fromJSON(qn),Yn=Wn.lookupType("Detection"),Xn=Wn.lookupType("Freespace"),Kn=Wn.lookupType("LidarPointcloudMap"),Zn=new URL(window.location.href),Jn=""==Zn.port?80:parseInt(Zn.port),Qn=window.location.host.split(":")[0],ea=F.create({baseURL:`http://${Qn}:${Jn}/`});async function ta(){return(await ea.get("v1/is-permit",{timeout:2e3})).data}async function na(){return(await ea.get("v1/client-users",{timeout:2e3})).data}async function aa(){return(await ea.get("v1/config",{timeout:5e3})).data}async function ra(e){return(await ea.post("v1/config",e)).data}async function oa(e,t){return(await ea.post("v1/roi",{contour:e,include:t})).data}async function la(e){return(await ea.post("v1/save-map",{map_name:e})).data}async function ia(){return(await ea.get("v1/get-save-progress")).data}async function sa(){const e=(new Date).getTime();return(await ea.post("v1/status",{host_date:e})).data}async function ca(){return(await ea.get("v1/player-status")).data}async function ma(){return await ea.get("v1/player-start")}async function ua(){return await ea.get("v1/player-pause")}async function pa(e){return(await ea.post("v1/player-seek",{percent:e})).data}async function da(e){return await ea.post("v1/player-rate",{rate:e})}async function fa(e){return(await ea.post("v1/player-step",{step:e})).data}async function ga(){return(await ea.get("v1/record-files")).data}async function ha(){return(await ea.get("v1/map-files")).data}async function Ea(e){return await ea.post("v1/play-record-file",{record_file:e})}async function va(e){return await ea.post("v1/open-map-file",{map_file:e})}async function xa(e){return await ea.post("v1/merge-map-file",{map_file:e})}async function ba(e=!1,t=0){const n=await ea.post("v1/detection-pb",{display_on_image:e,sample_size:t},{responseType:"arraybuffer"});if(!Yn)throw new Error("Detection has not been parsed!");let a=Yn.decode(new Uint8Array(n.data)),r=new Float32Array(a.points&&a.points.length>0?a.points.buffer.slice(a.points.byteOffset,a.points.byteOffset+a.points.byteLength):[]),o={};if(a.radar)for(let s of a.radar||[])null!=s.radarName&&null!=s.radarObject&&(o[s.radarName]=s.radarObject);else o={};let l={};for(let s of a.image||[])l[s.cameraName]=new Uint8Array(s.image.buffer.slice(s.image.byteOffset,s.image.byteOffset+s.image.byteLength));let i=a.freespace?Xn.decode(a.freespace):void 0;return{header:a.header||void 0,points:r,objects:a.object||[],freespace:i,images:l,pose:a.pose||void 0,radar:o}}async function ya(e,t,n,a){const r={method:"get_projection_forward",params:{lat0:e,lon0:t,lat1:n,lon1:a},jsonrpc:2,id:0};return(await ea.post("api/",r)).data.result}async function wa(e){const t={method:"get_transform",params:{extrinsic_parameters:e},jsonrpc:2,id:0};return ka((await ea.post("api/",t)).data.result)}function Ca(e){for(var t="",n=new Uint8Array(e),a=n.byteLength,r=0;r<a;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)}function Sa(e){for(var t=window.atob(e),n=t.length,a=new Uint8Array(n),r=0;r<n;r++)a[r]=t.charCodeAt(r);return a}function ka(e){return"string"==typeof e&&(e=JSON.parse(e)),(new O).set(...e)}async function Ma(){return(await ea.get("v1/map-vertex")).data}async function Ia(e,t="p"){const n=await ea.post("v1/vertex-data",{id:e,item:t},{responseType:"arraybuffer"});if(!Kn)throw new Error("LidarPointcloudMap has not been parsed!");let a=Kn.decode(new Uint8Array(n.data)),r=[];for(let l of a.lp||[])r[Number(l.lidarName)]=new Float32Array(l.points.buffer.slice(l.points.byteOffset,l.points.byteOffset+l.points.byteLength));let o={};for(let l of a.image||[])o[l.cameraName]=new Uint8Array(l.image.buffer.slice(l.image.byteOffset,l.image.byteOffset+l.image.byteLength));return{points:r[Number(e)],images:o}}async function Na(e){return(await ea.post("v1/map-del-vertex",{id:parseInt(e)})).data}async function Pa(e,t){return(await ea.post("v1/map-set-vertex-fix",{id:parseInt(e),fix:t})).data}async function Ra(){return(await ea.post("api/",{method:"restart_lidar_imu_calibration",jsonrpc:2,id:0})).data}async function _a(e){const t={method:"reboot",jsonrpc:2,id:0,params:{is_confirmed:e,hostname:Qn}};return(await ea.post("api/",t)).data.result}async function La(){return(await ea.get("v1/get-message-meta")).data}async function Aa(e,t){if("PointCloud"==t){const t=await ea.post("v1/get-message-data",{name:e},{responseType:"arraybuffer"});let n,a,r,o=Kn.decode(new Uint8Array(t.data));for(let e of o.lp||[])n=new Float32Array(e.points.buffer.slice(e.points.byteOffset,e.points.byteOffset+e.points.byteLength)),e.type&&(r=e.type),e.attr&&("intensity"==r?a=new Float32Array(e.attr.buffer.slice(e.attr.byteOffset,e.attr.byteOffset+e.attr.byteLength)):"rgb"==r&&(a=new Uint8Array(e.attr.buffer.slice(e.attr.byteOffset,e.attr.byteOffset+e.attr.byteLength))));return{points:n,attr:a,type:r}}if("CompressedImage"==t||"Image"==t){const t=await ea.post("v1/get-message-data",{name:e},{responseType:"arraybuffer"});let n,a=Kn.decode(new Uint8Array(t.data));for(let e of a.image||[])n=new Uint8Array(e.image.buffer.slice(e.image.byteOffset,e.image.byteOffset+e.image.byteLength));return n}return(await ea.post("v1/get-message-data",{name:e})).data}function za(){return u.createElement("input",{defaultValue:Qn,onBlur:e=>{console.log(e.target.value),ea.defaults.baseURL=`http://${e.target.value}:80/`,Hn.defaults.baseURL=`http://${e.target.value}:1235/`}})}function Fa({isDeveloperMode:e=!1,setIsDeveloperMode:t,isDarkMode:n=!1,setIsDarkMode:a,userLinks:r=[],menuBars:o,developerLinks:l=[]}){const s=m.exports.useCallback((()=>t((e=>!e))),[]);return u.createElement(D,{position:"sticky"},u.createElement(T,null,u.createElement(Rn,i({},{toggle:s}),u.createElement(R,{variant:"h4"},"TSARI")),u.createElement(Ln,{links:r}),o,e&&u.createElement(Ln,{links:l}),u.createElement(S,{flexGrow:1}),e&&u.createElement(za,null),u.createElement(S,{mr:"1rem"},e&&"26c741d"),u.createElement(Fn,null),u.createElement(On,{value:n?"dark":"light",onChange:e=>{a("dark"===e)}})))}const Oa=E((e=>({backdrop:{zIndex:e.zIndex.appBar-1,color:"#fff"}})));function Da(){const e=Oa();return u.createElement(j,{open:!0,className:e.backdrop},u.createElement(B,{color:"inherit"}))}const Ta=E((e=>({root:{paddingLeft:"1rem",paddingRight:"1rem",paddingBottom:"0.5rem"}})));function ja(e){var t=e,{t:n,normal:a}=t,r=c(t,["t","normal"]);const o=Ta(),[l,s]=m.exports.useState(!1),[p,d]=m.exports.useState(!1),{data:f,run:g,cancel:h}=U(aa,{pollingInterval:1e3,manual:!0,onSuccess:e=>{h(),"online"==e.input.mode?s(!0):s(!1),d(!1)}}),E=f;m.exports.useEffect((()=>{g()}),[]);return u.createElement(u.Fragment,null,p&&u.createElement(Da,null),u.createElement(G,{className:o.root,elevation:3},u.createElement(V,{size:"small"},u.createElement(H,null,Object.entries(r).map((e=>{const[t,a]=e;return u.createElement(q,{key:t},u.createElement($,null,u.createElement(R,{variant:"h6"},n(t))),u.createElement($,{align:"right"},u.createElement(R,{variant:"body1"},a)))})),a&&u.createElement(q,null,u.createElement($,null,u.createElement(R,{variant:"h6"},n("mode"))),u.createElement($,{align:"right"},u.createElement(W,{control:u.createElement(Y,{onChange:()=>{if(!E)return;let e=E.input;e.mode=l?"offline":"online",E.input=i({},e),d(!0),ra(E).then((()=>{g()}))},checked:l}),label:n(l?"online":"offline"),labelPlacement:"start"})))))))}function Ba(e,t=!1,n=1){const a=t?1e3:1024;if(Math.abs(e)<a)return e+" B";const r=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let o=-1;const l=10**n;do{e/=a,++o}while(Math.round(Math.abs(e)*l)/l>=a&&o<r.length-1);return e.toFixed(n)+r[o]}const Ua=E((e=>({root:{paddingLeft:"2rem",paddingRight:"1rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},line:{display:"flex",alignItems:"center",paddingRight:"0.2rem"}})));X({root:{color:"#ffcc00"}})(R);const Ga=X({root:{color:"#339900"}})(R);function Va({name:e,usage:t,total:n,frame_success:a,frame_lost:r,frame_error:o,isRecording:l,t:i=(e=>e)}){const s=Ua(),[c,m,p]=Bn();return u.createElement(u.Fragment,null,c,u.createElement(G,{className:s.root,elevation:3},u.createElement("div",{className:s.line},u.createElement(R,{variant:"h6"},i("disk")),u.createElement(S,{flexGrow:1}),null!=a&&u.createElement(u.Fragment,null,u.createElement(Ga,{variant:"subtitle1"},a),u.createElement("span",null," "),u.createElement(R,{variant:"subtitle1"},"/"),u.createElement("span",null," "),u.createElement(R,{color:"error",variant:"subtitle1"},r)),u.createElement(Y,{onChange:()=>{l?async function(){(await ea.post("api/",{method:"stop_record",jsonrpc:2,id:0})).data}():async function(){(await ea.post("api/",{method:"start_record",jsonrpc:2,id:0})).data}()},checked:l})),u.createElement("div",null,u.createElement(Ha,{value:t,t:i,onMouseEnter:a=>{const r=i("diskVolume")+Ba(1024*n,!0)+" "+i("diskLeft")+Ba(1024*n*(100-t)/100,!0);m(a,r,{anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},e)},onMouseLeave:p}))))}function Ha(e){return u.createElement(S,i({display:"flex",alignItems:"center"},e),u.createElement(S,{width:"100%",mr:1},u.createElement(K,{variant:"determinate",value:e.value})),u.createElement(S,{mr:1},u.createElement(R,{variant:"body2",color:"textSecondary"},e.value.toFixed(2)+"%")))}const qa={container:{marginTop:"1rem"}};function $a({onNetworkError:e,onSuccess:t}){const{t:n}=v(),[a,r]=m.exports.useState(!1),{data:o,loading:l,error:c}=U(sa,{pollingInterval:1e3,loadingDelay:1e3,onSuccess:t});c&&e&&e(c);const p={hostTime:Wa(new Date),deviceTime:null==o?void 0:o.time,status:n((null==o?void 0:o.status)||(null==c?void 0:c.message)||"")},d={name:null==o?void 0:o.disk.disk_name,total:null==o?void 0:o.disk.total,usage:null==o?void 0:o.disk.used_percent,frame_success:null==o?void 0:o.disk.frame_success,frame_lost:null==o?void 0:o.disk.frame_lost,frame_error:null==o?void 0:o.disk.frame_error};return m.exports.useEffect((()=>{!o||"Paused"!=o.status&&"Running"!=o.status?r(!1):r(!0)}),[o]),u.createElement(Z,{maxWidth:"sm",style:qa.container},u.createElement(ja,s(i({},p),{t:n,normal:a})),u.createElement(S,{mt:"1rem"}),(null==o?void 0:o.disk.has_disk)&&u.createElement(Va,s(i({},d),{isRecording:o.disk.status,t:n})))}function Wa(e){const t=e.getMonth()+1,n=e.getDate(),a=e.getHours(),r=e.getMinutes(),o=e.getSeconds();return[e.getFullYear(),(t>9?"":"0")+t,(n>9?"":"0")+n].join("-")+" "+[(a>9?"":"0")+a,(r>9?"":"0")+r,(o>9?"":"0")+o].join(":")}J(ee,"ipv4",(function(e="Invalid IP address"){return this.matches(/(^(\d{1,3}\.){3}(\d{1,3})$)/,{message:e,excludeEmptyString:!0}).test("ip",e,(e=>void 0===e||""===e.trim()||void 0===e.split(".").find((e=>parseInt(e,10)>255))))})),J(te,"uniqueProperty",(function(e,t){return this.test("unique",t,(function(t){if(!t||!t[e])return!0;if(this.parent.filter((e=>e!==t)).some((n=>n[e]===t[e])))throw this.createError({path:`${this.path}.${e}`});return!0}))})),J(ne,"elementLimit",(function(e,t,n){return this.test("limit",n,(function(a){let r=Number(this.path[this.path.length-2]);if(a<e[r]||a>t[r])throw this.createError({path:`${this.path}`,message:n[r]});return!0}))}));const Ya=Q.array().of(Q.array().of(Q.string()));var Xa=m.exports.memo(m.exports.forwardRef((({initialValues:e,t:t=(e=>e)},n)=>{const a=ae({initialValues:e,validationSchema:Ya,onSubmit:e=>{}});m.exports.useImperativeHandle(n,(()=>s(i({},a),{validationSchema:Ya}))),m.exports.useEffect((()=>{a.setValues(e)}),[e]);let r=[["Source","Sink"]],o=[["Source","Detect","Sink"]],l=[["Source","SLAM","Sink"]],c=[["Source","Split","Detect","Merge","Sink"],["Source","Split","SLAM","Merge","Sink"]];const{values:u,handleChange:p,touched:d,errors:f,setValues:g}=a;return m.exports.createElement(m.exports.Fragment,null,m.exports.createElement(R,{style:{marginTop:"0rem"},variant:"subtitle2",className:"subtitle-no-mt"},t("workmode")),m.exports.createElement(re,{style:{marginTop:"0.5rem"},container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,t("Mode")),m.exports.createElement(ie,{label:t("mode"),name:"",value:(e=>{if(1==e.length){for(let t=0;t<e[0].length;t++){if("Detect"==e[0][t])return o;if("SLAM"==e[0][t])return l}return r}return c})(u),onChange:e=>{g(e.target.value)}},m.exports.createElement(I,{value:r},t("collection")),m.exports.createElement(I,{value:o},t("detect")),m.exports.createElement(I,{value:l},t("slam")),m.exports.createElement(I,{value:c},t("detect_slam"))))),m.exports.createElement(re,{item:!0,md:!0}),m.exports.createElement(re,{item:!0,md:!0})))})));const Ka=Q.array().of(Q.object({name:Q.string().required("invalidName"),port:Q.number().typeError("invalidNumber").required("invalidNumber").min(1024,"invalidPort").max(49151,"invalidPort"),extrinsic_parameters:Q.array().of(Q.number().typeError("invalidNumber").required("invalidNumber")),range:Q.array().of(Q.number().typeError("invalidNumber").required("invalidNumber"))}).uniqueProperty("port","duplicatedPorts"));var Za=m.exports.memo(m.exports.forwardRef((function({lidarDefaultArray:e,initialValues:t,t:n=(e=>e),status:a},r){const o=ae({initialValues:t,validationSchema:Ka,onSubmit:e=>{}});m.exports.useImperativeHandle(r,(()=>s(i({},o),{validationSchema:Ka})));const[l,c]=m.exports.useState(!0);m.exports.useEffect((()=>{o.setValues(t),c(!0)}),[t]);const{values:u,handleChange:p,errors:d,touched:f,setValues:g}=o,[E,v,x]=Bn();return m.exports.createElement(m.exports.Fragment,null,E,u.map((({name:t,port:r,extrinsic_parameters:o,range:i},s)=>{var u,f,E,b,y,w,C;return m.exports.createElement("div",{key:s},m.exports.createElement(re,{container:!0,alignItems:"center"},m.exports.createElement(re,{item:!0,sm:4},m.exports.createElement(oe,null,m.exports.createElement(le,null,n("name")),m.exports.createElement(ie,{label:n("name"),name:`${s}.name`,value:t,onChange:t=>{((t,n)=>{c(!1),g(fe((a=>{const r=e.find((e=>e.name===n));r&&(a[t]=r)})))})(s,t.target.value)}},e.map(((e,t)=>m.exports.createElement(I,{value:e.name,key:e.name},e.name)))))),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(se,{label:n("port"),name:`${s}.port`,value:r,onChange:p,error:Boolean(null==(u=d[s])?void 0:u.port),helperText:n(null==(f=d[s])?void 0:f.port)})),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(se,{label:n("roi"),value:Math.max(-i[0],-i[1],i[3],i[4]),InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"},"m")},onChange:e=>{var t,n;t=s,(n=e).target.value<0&&(n.target.value=0),g(fe((e=>{e[t].range[0]=-n.target.value,e[t].range[1]=-n.target.value,e[t].range[3]=n.target.value,e[t].range[4]=n.target.value})))},error:Boolean(null==(b=null==(E=d[s])?void 0:E.range)?void 0:b[3]),helperText:n(null==(w=null==(y=d[s])?void 0:y.range)?void 0:w[3])})),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement("div",{style:{width:"24px"},onMouseEnter:e=>{var n;if(l&&(null==(n=null==a?void 0:a.lidar)?void 0:n.hasOwnProperty(`${s}-${t}`))&&(null==a?void 0:a.lidar[`${s}-${t}`].valid)){let n=(null==a?void 0:a.lidar[`${s}-${t}`].num[1].toString())+"x"+(null==a?void 0:a.lidar[`${s}-${t}`].num[0].toString());v(e,n,{anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"}})}},onMouseLeave:x},l?(null==(C=null==a?void 0:a.lidar)?void 0:C.hasOwnProperty(`${s}-${t}`))&&(null==a?void 0:a.lidar[`${s}-${t}`].valid)?m.exports.createElement(me,{fontSize:"medium",color:"primary"}):m.exports.createElement(ue,{fontSize:"medium"}):void 0)),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(S,{display:"flex"},m.exports.createElement(S,{flexGrow:1}),m.exports.createElement(h,{color:"primary",onClick:()=>(e=>{c(!1),g(fe((t=>{t.splice(e,1)})))})(s),className:"remove-button"},m.exports.createElement(pe,{fontSize:"large"}))))),m.exports.createElement(re,{container:!0},["x","y","z","roll","pitch","yaw"].map(((e,t)=>{var a,r,l,i;return m.exports.createElement(re,{item:!0,md:!0,key:t},m.exports.createElement(se,{label:e,name:`${s}.extrinsic_parameters.${t}`,value:o[t].toString().slice(0,6),InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"}," ",t<3?"m":"deg")},onChange:p,error:Boolean(null==(r=null==(a=d[s])?void 0:a.extrinsic_parameters)?void 0:r[t]),helperText:n((null==(i=null==(l=d[s])?void 0:l.extrinsic_parameters)?void 0:i[t])||"")}))}))),m.exports.createElement("div",{style:{marginBottom:"0.5rem"}}))})),m.exports.createElement(S,{display:"flex"},m.exports.createElement(S,{flexGrow:1}),m.exports.createElement("div",{hidden:!(u.length<4)},m.exports.createElement(h,{onClick:()=>{c(!1),g(fe((e=>{e.push({name:"",port:0,extrinsic_parameters:[0,0,0,0,0,0],range:[0,0,0,0,0,0]})})))},className:"float-right"},m.exports.createElement(de,{fontSize:"large"})))))})));const Ja=Q.array().of(Q.object({name:Q.string().required("invalidName"),output_width:Q.string(),output_height:Q.string(),undistortion:Q.boolean(),extrinsic_parameters:Q.array().of(Q.number().typeError("invalidNumber").required("invalidNumber")),intrinsic_parameters:Q.array().of(Q.number().typeError("invalidNumber").required("invalidNumber")),stream:Q.object({sink:Q.string(),host:Q.string().when("sink",{is:"udp",then:Q.string().required("invalidAddress").ipv4("invalidAddress"),otherwise:Q.string()}),port:Q.number().when("sink",{is:"none",then:Q.number(),otherwise:Q.number().typeError("invalidNumber").required("invalidNumber")})})}).uniqueProperty("name","duplicatedName"));var Qa=m.exports.memo(m.exports.forwardRef((function({initialValues:e,t:t=(e=>e),status:n},a){for(let i=0;i<e.length;i++)null==e[i].stream&&(e[i].stream={sink:"none",host:"",port:void 0}),null==e[i].undistortion&&(e[i].undistortion=!1);const r=ae({initialValues:e,validationSchema:Ja,onSubmit:()=>{}});m.exports.useImperativeHandle(a,(()=>s(i({},r),{validationSchema:Ja})));const[o,l]=m.exports.useState(!0);m.exports.useEffect((()=>{r.setValues(e),l(!0)}),[e]);const{values:c,handleChange:u,errors:p,touched:d,setValues:f}=r,[g,E,v]=Bn();return m.exports.createElement(m.exports.Fragment,null,g,c.map((({name:e,output_width:a,output_height:r,undistortion:i,intrinsic_parameters:s,extrinsic_parameters:c,stream:d},g)=>{var x,b,y,w,C,k,M,N,P,R,_;return m.exports.createElement("div",{key:g},m.exports.createElement(re,{container:!0,alignItems:"center"},m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(se,{label:t("name"),name:`${g}.name`,value:e,onChange:u,error:Boolean(null==(x=p[g])?void 0:x.name),helperText:t(null==(b=p[g])?void 0:b.name)})),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(se,{label:t("imageWidth"),name:`${g}.output_width`,value:a||"",onChange:u})),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(se,{label:t("imageHeight"),name:`${g}.output_height`,value:r||"",onChange:u})),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,t("undistortion")),m.exports.createElement(ie,{label:t("undistortion"),name:`${g}.undistortion`,value:i,onChange:u},m.exports.createElement(I,{value:"true"},t("True")),m.exports.createElement(I,{value:"false"},t("False"))))),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,t("stream")),m.exports.createElement(ie,{label:t("stream"),name:`${g}.stream.sink`,value:d.sink,onChange:u},m.exports.createElement(I,{value:"none"},t("False")),("udp"==d.sink||"none"==d.sink)&&m.exports.createElement(I,{value:"udp"},t("True")),"rtsp"==d.sink&&m.exports.createElement(I,{value:"rtsp"},t("True"))))),m.exports.createElement("div",{style:{width:"24px"},onMouseEnter:t=>{var a;if(o&&(null==(a=null==n?void 0:n.camera)?void 0:a.hasOwnProperty(e))&&(null==n?void 0:n.camera[e].valid)){let a=(null==n?void 0:n.camera[e].in_w).toString()+"x"+(null==n?void 0:n.camera[e].in_h).toString();E(t,a,{anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"}})}},onMouseLeave:v},o?(null==(y=null==n?void 0:n.camera)?void 0:y.hasOwnProperty(e))&&(null==n?void 0:n.camera[e].valid)?m.exports.createElement(me,{fontSize:"medium",color:"primary"}):m.exports.createElement(ue,{fontSize:"medium"}):void 0),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(S,{display:"flex"},m.exports.createElement(S,{flexGrow:1}),m.exports.createElement(h,{color:"primary",onClick:()=>(e=>{l(!1),f(fe((t=>{t.splice(e,1)})))})(g),className:"remove-button"},m.exports.createElement(pe,{fontSize:"large"}))))),m.exports.createElement("div",{hidden:"none"==d.sink},m.exports.createElement(re,{container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,t("streamProtocol")),m.exports.createElement(ie,{label:t("streamProtocol"),name:`${g}.stream.sink`,value:d.sink,onChange:u},m.exports.createElement(I,{value:"udp"},t("UDP")),m.exports.createElement(I,{value:"rtsp"},t("RTSP")),"none"==d.sink&&m.exports.createElement(I,{value:"none"},t("NONE"))))),m.exports.createElement(re,{hidden:"udp"!=d.sink,item:!0,md:!0},m.exports.createElement(se,{label:t("destination"),value:d.host,onChange:u,name:`${g}.stream.host`,error:Boolean(null==(C=null==(w=p[g])?void 0:w.stream)?void 0:C.host),helperText:t(null==(M=null==(k=p[g])?void 0:k.stream)?void 0:M.host)})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:t("port"),value:d.port,onChange:u,name:`${g}.stream.port`,error:Boolean(null==(P=null==(N=p[g])?void 0:N.stream)?void 0:P.port),helperText:t(null==(_=null==(R=p[g])?void 0:R.stream)?void 0:_.port)})),m.exports.createElement(re,{hidden:!("rtsp"==d.sink),item:!0,md:!0}),m.exports.createElement("div",{style:{width:"24px"}}))),m.exports.createElement(re,{container:!0},["x","y","z","roll","pitch","yaw"].map(((e,n)=>{var a,r,o,l;return m.exports.createElement(re,{item:!0,md:!0,key:n},m.exports.createElement(se,{label:e,name:`${g}.extrinsic_parameters.${n}`,value:c[n].toString().slice(0,6),InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"}," ",n<3?"m":"deg")},onChange:u,error:Boolean(null==(r=null==(a=p[g])?void 0:a.extrinsic_parameters)?void 0:r[n]),helperText:t((null==(l=null==(o=p[g])?void 0:o.extrinsic_parameters)?void 0:l[n])||"")}))})),m.exports.createElement("div",{style:{width:"24px"}})),m.exports.createElement(re,{container:!0},["fx","fy","cx","cy","k1","k2","p1","p2"].map(((e,n)=>{var a,r,o,l;return m.exports.createElement(re,{item:!0,md:!0,key:n},m.exports.createElement(se,{label:e,name:`${g}.intrinsic_parameters.${n}`,value:s[n],onChange:u,error:Boolean(null==(r=null==(a=p[g])?void 0:a.intrinsic_parameters)?void 0:r[n]),helperText:t((null==(l=null==(o=p[g])?void 0:o.intrinsic_parameters)?void 0:l[n])||"")}))})),m.exports.createElement("div",{style:{width:"24px"}})),m.exports.createElement("div",{style:{marginBottom:"0.5rem"}}))})),m.exports.createElement(S,{display:"flex"},m.exports.createElement(S,{flexGrow:1}),m.exports.createElement("div",{hidden:!(c.length<8)},m.exports.createElement(h,{onClick:()=>{l(!1),f(fe((e=>{e.push({name:"",intrinsic_parameters:new Array(8).fill(0),extrinsic_parameters:[0,0,0,0,0,0],output_width:"",output_height:"",undistortion:!1,stream:{sink:"none",host:"",port:void 0}})})))},className:"float-right"},m.exports.createElement(de,{fontSize:"large"})))))})));const er=Q.array().of(Q.object({name:Q.string().required("invalidName"),device:Q.string().required("invalidName"),baud:Q.number().typeError("invalidNumber").required("invalidNumber"),extrinsic_parameters:Q.array().of(Q.number().typeError("invalidNumber").required("invalidNumber"))}));var tr=m.exports.memo(m.exports.forwardRef((function({radarDefaultArray:e,initialValues:t,t:n=(e=>e),status:a},r){const o=ae({initialValues:t,validationSchema:er,onSubmit:e=>{}});m.exports.useImperativeHandle(r,(()=>s(i({},o),{validationSchema:er})));const[l,c]=m.exports.useState(!0);m.exports.useEffect((()=>{o.setValues(t),c(!0)}),[t]);const{values:u,handleChange:p,errors:d,touched:f,setValues:g}=o,[E,v,x]=Bn();return m.exports.createElement(m.exports.Fragment,null,E,u.map((({name:t,device:r,baud:o,extrinsic_parameters:i},s)=>{var u,f,E;return m.exports.createElement("div",{key:s},m.exports.createElement(re,{container:!0,alignItems:"center"},m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,n("name")),m.exports.createElement(ie,{label:n("name"),name:`${s}.name`,value:t,onChange:t=>{((t,n)=>{c(!1),g(fe((a=>{const r=e.find((e=>e.name===n));r&&(a[t]=r)})))})(s,t.target.value)}},e.map(((e,t)=>m.exports.createElement(I,{value:e.name,key:e.name},e.name)))))),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(se,{label:n("radarDevice"),name:`${s}.device`,value:r,onChange:p,error:Boolean(null==(u=d[s])?void 0:u.device),helperText:n(null==(f=d[s])?void 0:f.device)})),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,n("baud")),m.exports.createElement(ie,{label:n("baud"),name:`${s}.baud`,value:o,onChange:p},[1e5,2e5,5e5,1e6].map((e=>m.exports.createElement(I,{value:e,key:e},e)))))),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement("div",{style:{width:"24px"},onMouseEnter:e=>{var n;if(l&&(null==(n=null==a?void 0:a.radar)?void 0:n.hasOwnProperty(`${s}-${t}`))&&(null==a?void 0:a.radar[`${s}-${t}`].valid)){let n=null==a?void 0:a.radar[`${s}-${t}`].num.toString();v(e,n,{anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"}})}},onMouseLeave:x},l?(null==(E=null==a?void 0:a.radar)?void 0:E.hasOwnProperty(`${s}-${t}`))&&(null==a?void 0:a.radar[`${s}-${t}`].valid)?m.exports.createElement(me,{fontSize:"medium",color:"primary"}):m.exports.createElement(ue,{fontSize:"medium"}):void 0)),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement(S,{display:"flex"},m.exports.createElement(S,{flexGrow:1}),m.exports.createElement(h,{color:"primary",onClick:()=>(e=>{c(!1),g(fe((t=>{t.splice(e,1)})))})(s),className:"remove-button"},m.exports.createElement(pe,{fontSize:"large"}))))),m.exports.createElement(re,{container:!0},["x","y","z","roll","pitch","yaw"].map(((e,t)=>{var a,r,o,l;return m.exports.createElement(re,{item:!0,md:!0,key:t},m.exports.createElement(se,{label:e,name:`${s}.extrinsic_parameters.${t}`,value:i[t].toString().slice(0,6),InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"}," ",t<3?"m":"deg")},onChange:p,error:Boolean(null==(r=null==(a=d[s])?void 0:a.extrinsic_parameters)?void 0:r[t]),helperText:n((null==(l=null==(o=d[s])?void 0:o.extrinsic_parameters)?void 0:l[t])||"")}))}))),m.exports.createElement("div",{style:{marginBottom:"0.5rem"}}))})),m.exports.createElement(S,{display:"flex"},m.exports.createElement(S,{flexGrow:1}),m.exports.createElement(h,{onClick:()=>{c(!1),g(fe((e=>{e.push({name:"",device:"",baud:0,extrinsic_parameters:[0,0,0,0,0,0]})})))},className:"float-right"},u.length<4&&m.exports.createElement(de,{fontSize:"large"}))))})));const nr=Q.object({device:Q.string().required("invalidName"),port:Q.number().typeError("invalidNumber").required("invalidNumber").min(1024,"invalidPort").max(49151,"invalidPort"),extrinsic_parameters:Q.array().of(Q.number().typeError("invalidNumber").required("invalidNumber")),imu_extrinsic_parameters:Q.array().of(Q.number().typeError("invalidNumber").required("invalidNumber")),ins_fix:Q.object({use:Q.boolean(),status:Q.number(),stable_time:Q.number().min(0,"invalidNumber").required("invalidNumber"),precision:Q.number().min(.1,"invalidNumber").required("invalidNumber")}),ins_float:Q.object({use:Q.boolean(),status:Q.number(),stable_time:Q.number().min(0,"invalidNumber").required("invalidNumber"),precision:Q.number().min(.1,"invalidNumber").required("invalidNumber")}),ins_normal:Q.object({use:Q.boolean(),status:Q.number(),stable_time:Q.number().min(0,"invalidNumber").required("invalidNumber"),precision:Q.number().min(.1,"invalidNumber").required("invalidNumber")})});var ar=u.memo(u.forwardRef((function({initialValues:e,t:t=(e=>e||"")},n){var a,r,o,l,c,p,d,f,g,h,E,v,x,b,y,w,C,S;const k=ae({initialValues:e,validationSchema:nr,onSubmit:e=>{}});m.exports.useImperativeHandle(n,(()=>s(i({},k),{validationSchema:nr})));const{values:M,setValues:N,handleChange:P,touched:_,errors:L}=k;return u.createElement(u.Fragment,null,u.createElement(re,{container:!0},u.createElement(re,{item:!0,sm:!0},u.createElement(se,{label:t("inputDevice"),name:"device",value:null==M?void 0:M.device,onChange:P,error:Boolean(null==L?void 0:L.device),helperText:t(null==L?void 0:L.device)})),u.createElement(re,{item:!0,sm:!0},u.createElement(se,{label:t("port"),name:"port",value:null==M?void 0:M.port,onChange:P,error:Boolean(null==L?void 0:L.port),helperText:t(null==L?void 0:L.port)})),u.createElement(re,{item:!0,md:!0},u.createElement(oe,null,u.createElement(le,null,t("insType")),u.createElement(ie,{label:t("insType"),name:"ins_type",value:null==M?void 0:M.ins_type,onChange:P},u.createElement(I,{value:"2D"},t("2D")),u.createElement(I,{value:"3D"},t("3D")),u.createElement(I,{value:"6D"},t("6D")))))),u.createElement(R,{variant:"subtitle2",style:{marginTop:"1rem"},className:"subtitle-no-mt"},t("insExtrinsic")),u.createElement(re,{container:!0},["x","y","z","roll","pitch","yaw"].map(((e,n)=>{var a,r;return u.createElement(re,{item:!0,md:!0,key:n},u.createElement(se,{label:e,name:`extrinsic_parameters.${n}`,value:null==M?void 0:M.extrinsic_parameters[n].toString().slice(0,6),InputProps:{endAdornment:u.createElement(ce,{position:"end"}," ",n<3?"m":"deg")},onChange:P,error:Boolean(null==(a=null==L?void 0:L.extrinsic_parameters)?void 0:a[n]),helperText:t(null==(r=null==L?void 0:L.extrinsic_parameters)?void 0:r[n])}))}))),u.createElement(R,{variant:"subtitle2",style:{marginTop:"1rem"},className:"subtitle-no-mt"},t("imuExtrinsic")),u.createElement(re,{container:!0},["x","y","z","roll","pitch","yaw"].map(((e,n)=>{var a,r;return u.createElement(re,{item:!0,md:!0,key:n},u.createElement(se,{label:e,name:`imu_extrinsic_parameters.${n}`,value:null==M?void 0:M.imu_extrinsic_parameters[n].toString().slice(0,6),InputProps:{endAdornment:u.createElement(ce,{position:"end"}," ",n<3?"m":"deg")},onChange:P,error:Boolean(null==(a=null==L?void 0:L.imu_extrinsic_parameters)?void 0:a[n]),helperText:t(null==(r=null==L?void 0:L.imu_extrinsic_parameters)?void 0:r[n])}))}))),u.createElement(R,{variant:"subtitle2",style:{marginTop:"1rem"},className:"subtitle-no-mt"},t("insStatusTable")),u.createElement(re,{container:!0},u.createElement(re,{item:!0,md:!0,key:"fixUse"},u.createElement(ge,{direction:"row",spacing:1,alignItems:"center"},u.createElement(Y,{color:"primary",name:"ins_fix.use",checked:null==M?void 0:M.ins_fix.use,onChange:P}),u.createElement(R,null,t("rtkFix")))),u.createElement(re,{item:!0,md:!0,key:"fixStatus",hidden:!M.ins_fix.use},u.createElement(se,{label:t("rtkStatus"),name:"ins_fix.status",value:null==M?void 0:M.ins_fix.status,onChange:P,error:Boolean(null==(a=null==L?void 0:L.ins_fix)?void 0:a.status),helperText:t(null==(r=null==L?void 0:L.ins_fix)?void 0:r.status)})),u.createElement(re,{item:!0,md:!0,key:"fixStableTime",hidden:!M.ins_fix.use},u.createElement(se,{label:t("rtkStableTime"),name:"ins_fix.stable_time",value:null==M?void 0:M.ins_fix.stable_time,InputProps:{endAdornment:u.createElement(ce,{position:"end"},"s")},onChange:P,error:Boolean(null==(o=null==L?void 0:L.ins_fix)?void 0:o.stable_time),helperText:t(null==(l=null==L?void 0:L.ins_fix)?void 0:l.stable_time)})),u.createElement(re,{item:!0,md:!0,key:"fixPrecision",hidden:!M.ins_fix.use},u.createElement(se,{label:t("rtkPrecision"),name:"ins_fix.precision",value:null==M?void 0:M.ins_fix.precision,InputProps:{endAdornment:u.createElement(ce,{position:"end"},"cm")},onChange:P,error:Boolean(null==(c=null==L?void 0:L.ins_fix)?void 0:c.precision),helperText:t(null==(p=null==L?void 0:L.ins_fix)?void 0:p.precision)}))),u.createElement(re,{container:!0},u.createElement(re,{item:!0,md:!0,key:"floatUse"},u.createElement(ge,{direction:"row",spacing:1,alignItems:"center"},u.createElement(Y,{color:"primary",name:"ins_float.use",checked:null==M?void 0:M.ins_float.use,onChange:P}),u.createElement(R,null,t("rtkFloat")))),u.createElement(re,{item:!0,md:!0,key:"fixStatus",hidden:!M.ins_float.use},u.createElement(se,{label:t("rtkStatus"),name:"ins_float.status",value:null==M?void 0:M.ins_float.status,onChange:P,error:Boolean(null==(d=null==L?void 0:L.ins_float)?void 0:d.status),helperText:t(null==(f=null==L?void 0:L.ins_float)?void 0:f.status)})),u.createElement(re,{item:!0,md:!0,key:"fixStableTime",hidden:!M.ins_float.use},u.createElement(se,{label:t("rtkStableTime"),name:"ins_float.stable_time",value:null==M?void 0:M.ins_float.stable_time,InputProps:{endAdornment:u.createElement(ce,{position:"end"},"s")},onChange:P,error:Boolean(null==(g=null==L?void 0:L.ins_float)?void 0:g.stable_time),helperText:t(null==(h=null==L?void 0:L.ins_float)?void 0:h.stable_time)})),u.createElement(re,{item:!0,md:!0,key:"fixPrecision",hidden:!M.ins_float.use},u.createElement(se,{label:t("rtkPrecision"),name:"ins_float.precision",value:null==M?void 0:M.ins_float.precision,InputProps:{endAdornment:u.createElement(ce,{position:"end"},"cm")},onChange:P,error:Boolean(null==(E=null==L?void 0:L.ins_float)?void 0:E.precision),helperText:t(null==(v=null==L?void 0:L.ins_float)?void 0:v.precision)}))),u.createElement(re,{container:!0},u.createElement(re,{item:!0,md:!0,key:"NormalUse"},u.createElement(ge,{direction:"row",spacing:1,alignItems:"center"},u.createElement(Y,{color:"primary",name:"ins_normal.use",checked:null==M?void 0:M.ins_normal.use,onChange:P}),u.createElement(R,null,t("rtkNormal")))),u.createElement(re,{item:!0,md:!0,key:"fixStatus",hidden:!M.ins_normal.use},u.createElement(se,{label:t("rtkStatus"),name:"ins_normal.status",value:null==M?void 0:M.ins_normal.status,onChange:P,error:Boolean(null==(x=null==L?void 0:L.ins_normal)?void 0:x.status),helperText:t(null==(b=null==L?void 0:L.ins_normal)?void 0:b.status)})),u.createElement(re,{item:!0,md:!0,key:"fixStableTime",hidden:!M.ins_normal.use},u.createElement(se,{label:t("rtkStableTime"),name:"ins_normal.stable_time",value:null==M?void 0:M.ins_normal.stable_time,InputProps:{endAdornment:u.createElement(ce,{position:"end"},"s")},onChange:P,error:Boolean(null==(y=null==L?void 0:L.ins_normal)?void 0:y.stable_time),helperText:t(null==(w=null==L?void 0:L.ins_normal)?void 0:w.stable_time)})),u.createElement(re,{item:!0,md:!0,key:"fixPrecision",hidden:!M.ins_normal.use},u.createElement(se,{label:t("rtkPrecision"),name:"ins_normal.precision",value:null==M?void 0:M.ins_normal.precision,InputProps:{endAdornment:u.createElement(ce,{position:"end"},"cm")},onChange:P,error:Boolean(null==(C=null==L?void 0:L.ins_normal)?void 0:C.precision),helperText:t(null==(S=null==L?void 0:L.ins_normal)?void 0:S.precision)}))))})));const rr=Q.object({freespace:Q.object({min_height:Q.number().typeError("invalidNumber").required("invalidNumber"),max_height:Q.number().typeError("invalidNumber").required("invalidNumber"),resolution:Q.number().typeError("invalidNumber").required("invalidNumber").min(.1,"invalidFreespaceResolution").max(1,"invalidFreespaceResolution")})});var or=m.exports.memo(m.exports.forwardRef((function({initialValues:e,t:t=(e=>e||"")},n){var a,r,o,l,c,u;const p=ae({initialValues:e,validationSchema:rr,onSubmit:e=>{}});m.exports.useImperativeHandle(n,(()=>s(i({},p),{validationSchema:rr}))),m.exports.useEffect((()=>{p.setValues(e)}),[e]);const{values:d,setValues:f,handleChange:g,touched:h,errors:E}=p,v=[],x=[];for(let i of[...Object.keys(d.object),"freespace"])"use"!==i&&(v.push(i),"freespace"===i?d.freespace.use&&x.push(i):d.object[i]&&x.push(i));return m.exports.createElement(S,{flexGrow:1},m.exports.createElement(R,{variant:"subtitle2",className:"subtitle-no-mt"},t("objects")),m.exports.createElement(S,{mb:"1rem"},m.exports.createElement(he,{options:v,value:x,onChange:(e,t)=>{console.log(e,t),f(fe((e=>{for(let n in d.object)"use"!==n&&(e.object[n]=t.includes(n));e.freespace.use=t.includes("freespace")})))},multiple:!0,filterSelectedOptions:!0,renderTags:(e,n)=>e.map(((e,a)=>m.exports.createElement(Ee,i({variant:"outlined",label:t(e)},n({index:a}))))),renderInput:e=>m.exports.createElement(se,s(i({},e),{placeholder:""})),renderOption:(e,n)=>m.exports.createElement(S,i({component:"li"},e),t(n))})),d.freespace.use&&m.exports.createElement(m.exports.Fragment,null,m.exports.createElement(R,{variant:"subtitle2",className:"subtitle"},t("freespace")),m.exports.createElement(re,{container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:t("minHeight"),value:d.freespace.min_height,InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"},"m")},onChange:g,name:"freespace.min_height",error:Boolean(null==(a=null==E?void 0:E.freespace)?void 0:a.min_height),helperText:t(null==(r=null==E?void 0:E.freespace)?void 0:r.min_height)})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:t("maxHeight"),value:d.freespace.max_height,InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"},"m")},onChange:g,name:"freespace.max_height",error:Boolean(null==(o=null==E?void 0:E.freespace)?void 0:o.max_height),helperText:t(null==(l=null==E?void 0:E.freespace)?void 0:l.max_height)})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:t("resolution"),value:d.freespace.resolution,InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"},"m")},onChange:g,name:"freespace.resolution",error:Boolean(null==(c=null==E?void 0:E.freespace)?void 0:c.resolution),helperText:t(null==(u=null==E?void 0:E.freespace)?void 0:u.resolution)})))))})));const lr=Q.object({mapping:Q.object({key_frames_interval:Q.array().of(Q.number().typeError("invalidNumber").required("invalidNumber").min(0,"invalidInterval").max(100,"invalidInterval")),map_resolution:Q.number().typeError("invalidNumber").required("invalidNumber").min(.1,"invalidMapResolution").max(1,"invalidMapResolution"),key_frames_range:Q.number().typeError("invalidNumber").required("invalidNumber").min(0,"invalidKeyFrameRange").max(1e3,"invalidKeyFrameRange"),sensor_input:Q.array().of(Q.string()).min(0,"emptySensorInput"),ground_constraint:Q.boolean(),loop_closure:Q.boolean()}),localization:Q.object({key_frames_interval:Q.array().of(Q.number().typeError("invalidNumber").required("invalidNumber").min(0,"invalidInterval").max(100,"invalidInterval")),map_resolution:Q.number().typeError("invalidNumber").required("invalidNumber").min(0,"invalidLocResolution").max(1,"invalidLocResolution"),map_path:Q.string().required("invalidName"),sensor_input:Q.array().of(Q.string()).min(0,"emptySensorInput")}),origin:Q.object({use:Q.boolean(),latitude:Q.number().typeError("invalidNumber").required("invalidNumber"),longitude:Q.number().typeError("invalidNumber").required("invalidNumber"),altitude:Q.number().typeError("invalidNumber").required("invalidNumber")})});var ir=m.exports.memo(m.exports.forwardRef((({initialValues:e,config:t,t:n=(e=>e)},a)=>{var r,o,l,c,u,p,d,f,g,h,E,v,x,b;const[y,w]=m.exports.useState([]),[C,k]=m.exports.useState([]),M=ae({initialValues:e,validationSchema:lr,onSubmit:e=>{}});m.exports.useImperativeHandle(a,(()=>s(i({},M),{validationSchema:lr}))),m.exports.useEffect((()=>{M.setValues(e);let n=[];for(let e=0;e<t.lidar.length;e++)n[e]=e.toString()+"-"+t.lidar[e].name;let a=[];for(let e=0;e<t.camera.length;e++)a[e]=t.camera[e].name;w(n),k(a)}),[e,t]);const{values:N,handleChange:P,touched:_,errors:L,setValues:A}=M;return"function"!=typeof Array.prototype.subsetTo&&(Array.prototype.subsetTo=function(e){return this.filter((t=>e.includes(t)))}),m.exports.createElement(m.exports.Fragment,null,m.exports.createElement(R,{style:{marginTop:"0rem"},variant:"subtitle2",className:"subtitle-no-mt"},n("workmode")),m.exports.createElement(re,{style:{marginTop:"0.5rem"},container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,n("Mode")),m.exports.createElement(ie,{label:n("mode"),name:"mode",value:N.mode,onChange:P},m.exports.createElement(I,{value:"mapping"},n("mapping")),m.exports.createElement(I,{value:"localization"},n("localization"))))),m.exports.createElement(re,{item:!0,md:!0}),m.exports.createElement(re,{item:!0,md:!0})),m.exports.createElement("div",{hidden:"mapping"!=N.mode},m.exports.createElement(R,{style:{marginTop:"1rem"},variant:"subtitle2",className:"subtitle-no-mt"},n("slamMethod")),m.exports.createElement(re,{style:{marginTop:"0.5rem"},container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,n("method")),m.exports.createElement(ie,{label:n("method"),name:"method",value:N.method||"RTKM",onChange:P},m.exports.createElement(I,{value:"RTKM"},n("RTKM")),m.exports.createElement(I,{value:"FLOAM"},n("FLOAM")),m.exports.createElement(I,{value:"GICPM"},n("GICPM")),m.exports.createElement(I,{value:"FastLIO"},n("FastLIO"))))),m.exports.createElement(re,{item:!0,md:!0}),m.exports.createElement(re,{item:!0,md:!0})),m.exports.createElement(R,{style:{marginTop:"1rem"},variant:"subtitle2",className:"subtitle-no-mt"},n("sensor")),m.exports.createElement(S,{mb:"1rem"},m.exports.createElement(he,{options:[...y,...C,"RTK","IMU"],value:N.mapping.sensor_input.subsetTo([...y,...C,"RTK","IMU"]),onChange:(e,t)=>{A(ve((e=>{e.mapping.sensor_input=t})))},multiple:!0,filterSelectedOptions:!0,renderTags:(e,t)=>e.map(((e,a)=>m.exports.createElement(Ee,i({variant:"outlined",label:C.includes(e)?n("Camera")+"-"+n(e):n(e)},t({index:a}))))),renderInput:e=>{var t,a;return m.exports.createElement(se,s(i({},e),{placeholder:"",error:Boolean(null==(t=L.mapping)?void 0:t.sensor_input),helperText:n((null==(a=L.mapping)?void 0:a.sensor_input)||"")}))},renderOption:(e,t)=>m.exports.createElement(S,i({component:"li"},e),C.includes(t)?n("Camera")+"-"+n(t):n(t))})),m.exports.createElement(R,{style:{marginTop:"1rem"},variant:"subtitle2",className:"subtitle-no-mt"},n("mapParam")),m.exports.createElement(re,{container:!0},["distance","rotation"].map(((e,t)=>{var a,r,o,l;return m.exports.createElement(re,{item:!0,md:!0,key:t},m.exports.createElement(se,{label:n(e),name:`mapping.key_frames_interval.${t}`,value:N.mapping.key_frames_interval[t],InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"},"distance"==e?"m":"deg")},onChange:P,error:Boolean(null==(r=null==(a=L.mapping)?void 0:a.key_frames_interval)?void 0:r[t]),helperText:n((null==(l=null==(o=L.mapping)?void 0:o.key_frames_interval)?void 0:l[t])||"")}))})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:n("mapResolution"),name:"mapping.map_resolution",value:N.mapping.map_resolution,InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"},"m")},onChange:P,error:Boolean(null==(r=L.mapping)?void 0:r.map_resolution),helperText:n((null==(o=L.mapping)?void 0:o.map_resolution)||"")})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:n("mapKeyFrameRange"),name:"mapping.key_frames_range",value:N.mapping.key_frames_range,InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"},"m")},onChange:P,error:Boolean(null==(l=L.mapping)?void 0:l.key_frames_range),helperText:n((null==(c=L.mapping)?void 0:c.key_frames_range)||"")}))),m.exports.createElement(re,{container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:n("originLat"),name:"origin.latitude",value:N.origin.latitude,onChange:P,disabled:N.origin.use,error:Boolean(null==(u=null==L?void 0:L.origin)?void 0:u.latitude),helperText:n((null==(p=null==L?void 0:L.origin)?void 0:p.latitude)||"")})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:n("originLon"),name:"origin.longitude",value:N.origin.longitude,onChange:P,disabled:N.origin.use,error:Boolean(null==(d=null==L?void 0:L.origin)?void 0:d.longitude),helperText:n((null==(f=null==L?void 0:L.origin)?void 0:f.longitude)||"")})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:n("originAlt"),name:"origin.altitude",value:N.origin.altitude,onChange:P,disabled:N.origin.use,error:Boolean(null==(g=null==L?void 0:L.origin)?void 0:g.altitude),helperText:n((null==(h=null==L?void 0:L.origin)?void 0:h.altitude)||"")})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(ge,{direction:"row",spacing:1,alignItems:"center"},m.exports.createElement(Y,{color:"primary",name:"origin.use",checked:N.origin.use,onChange:P}),m.exports.createElement(R,null,N.origin.use?n("originAuto"):n("originMannual"))))),m.exports.createElement(R,{style:{marginTop:"1rem"},variant:"subtitle2",className:"subtitle-no-mt"},n("otherParam")),m.exports.createElement(re,{container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,n("groundConstraint")),m.exports.createElement(ie,{label:n("groundConstraint"),name:"mapping.ground_constraint",value:N.mapping.ground_constraint,onChange:P},m.exports.createElement(I,{value:"true"},n("True")),m.exports.createElement(I,{value:"false"},n("False"))))),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(oe,null,m.exports.createElement(le,null,n("loopClosure")),m.exports.createElement(ie,{label:n("loopClosure"),name:"mapping.loop_closure",value:N.mapping.loop_closure,onChange:P},m.exports.createElement(I,{value:"true"},n("True")),m.exports.createElement(I,{value:"false"},n("False"))))),m.exports.createElement(re,{item:!0,md:!0}))),m.exports.createElement("div",{hidden:"localization"!=N.mode},m.exports.createElement(R,{style:{marginTop:"1rem"},variant:"subtitle2",className:"subtitle-no-mt"},n("sensor")),m.exports.createElement(S,{mb:"1rem"},m.exports.createElement(he,{options:[...y,...C,"RTK","IMU"],value:N.localization.sensor_input.subsetTo([...y,...C,"RTK",,"IMU"]),onChange:(e,t)=>{A(ve((e=>{e.localization.sensor_input=t})))},multiple:!0,filterSelectedOptions:!0,renderTags:(e,t)=>e.map(((e,a)=>m.exports.createElement(Ee,i({variant:"outlined",label:C.includes(e)?n("Camera")+"-"+n(e):n(e)},t({index:a}))))),renderInput:e=>{var t,a;return m.exports.createElement(se,s(i({},e),{placeholder:"",error:Boolean(null==(t=L.localization)?void 0:t.sensor_input),helperText:n((null==(a=L.localization)?void 0:a.sensor_input)||"")}))},renderOption:(e,t)=>m.exports.createElement(S,i({component:"li"},e),C.includes(t)?n("Camera")+"-"+n(t):n(t))})),m.exports.createElement(R,{style:{marginTop:"1rem"},variant:"subtitle2",className:"subtitle-no-mt"},n("locParam")),m.exports.createElement(re,{container:!0},["LocDistance","LocRotation"].map(((e,t)=>{var a,r,o,l;return m.exports.createElement(re,{item:!0,md:!0,key:t},m.exports.createElement(se,{label:n(e),name:`localization.key_frames_interval.${t}`,value:N.localization.key_frames_interval[t],InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"},"LocDistance"==e?"m":"deg")},onChange:P,error:Boolean(null==(r=null==(a=L.localization)?void 0:a.key_frames_interval)?void 0:r[t]),helperText:n((null==(l=null==(o=L.localization)?void 0:o.key_frames_interval)?void 0:l[t])||"")}))})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:n("locResolution"),name:"localization.map_resolution",value:N.localization.map_resolution,InputProps:{endAdornment:m.exports.createElement(ce,{position:"end"},"m")},onChange:P,error:Boolean(null==(E=L.localization)?void 0:E.map_resolution),helperText:n((null==(v=L.localization)?void 0:v.map_resolution)||"")}))),m.exports.createElement(re,{container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(se,{label:n("mapPath"),name:"localization.map_path",value:N.localization.map_path,onChange:P,error:Boolean(null==(x=L.localization)?void 0:x.map_path),helperText:n((null==(b=L.localization)?void 0:b.map_path)||"")})))))})));const sr=Q.object({protocol:Q.object({UDP:Q.object({destination:Q.string().required("invalidAddress").ipv4("invalidAddress"),coordinate:Q.string(),port:Q.number().typeError("invalidNumber").required("invalidNumber").min(1024,"invalidPort").max(49151,"invalidPort")}),CAN:Q.object({device:Q.string().required("invalidName")})}),localization:Q.object({UDP:Q.object({destination:Q.string().required("invalidAddress").ipv4("invalidAddress"),port:Q.number().typeError("invalidNumber").required("invalidNumber").min(1024,"invalidPort").max(49151,"invalidPort")})})});var cr=m.exports.memo(m.exports.forwardRef((function({initialValues:e,t:t=(e=>e||"")},n){var a,r,o,l,c,u,p,d,f,g,h,E,v,x,b,y,w,C,S,k;const M=ae({initialValues:e,validationSchema:sr,onSubmit:e=>{}});m.exports.useImperativeHandle(n,(()=>s(i({},M),{validationSchema:sr}))),m.exports.useEffect((()=>{M.setValues(e)}),[e]);const{values:N,setValues:P,handleChange:_,touched:L,errors:A}=M;return m.exports.createElement(m.exports.Fragment,null,m.exports.createElement(R,{variant:"subtitle2",className:"subtitle-no-mt"},t("detect")),m.exports.createElement(re,{container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(W,{control:m.exports.createElement(Y,{checked:N.protocol.UDP.use,name:"protocol.UDP.use",onChange:_}),label:t("UDP")})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement("div",{hidden:!N.protocol.UDP.use},m.exports.createElement(se,{label:t("destination"),value:N.protocol.UDP.destination,onChange:_,name:"protocol.UDP.destination",error:Boolean(null==(r=null==(a=null==A?void 0:A.protocol)?void 0:a.UDP)?void 0:r.destination),helperText:t(null==(l=null==(o=null==A?void 0:A.protocol)?void 0:o.UDP)?void 0:l.destination)}))),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement("div",{hidden:!N.protocol.UDP.use},m.exports.createElement(se,{label:t("port"),value:N.protocol.UDP.port,onChange:_,name:"protocol.UDP.port",error:Boolean(null==(u=null==(c=null==A?void 0:A.protocol)?void 0:c.UDP)?void 0:u.port),helperText:t(null==(d=null==(p=null==A?void 0:A.protocol)?void 0:p.UDP)?void 0:d.port)}))),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement("div",{hidden:!N.protocol.UDP.use},m.exports.createElement(oe,null,m.exports.createElement(le,null,t("coordinate")),m.exports.createElement(ie,{value:N.protocol.UDP.coordinate,onChange:_,name:"protocol.UDP.coordinate",label:t("coordinate")},["local","global"].map((e=>m.exports.createElement(I,{value:e,key:e},t(e))))))))),m.exports.createElement(re,{container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(W,{control:m.exports.createElement(Y,{checked:N.protocol.CAN.use,onChange:_,name:"protocol.CAN.use"}),label:t("CAN")})),m.exports.createElement(re,{item:!0,sm:!0},m.exports.createElement("div",{hidden:!N.protocol.CAN.use},m.exports.createElement(se,{label:t("name"),name:"protocol.CAN.device",value:N.protocol.CAN.device,onChange:_,error:Boolean(null==(g=null==(f=null==A?void 0:A.protocol)?void 0:f.CAN)?void 0:g.device),helperText:t(null==(E=null==(h=null==A?void 0:A.protocol)?void 0:h.CAN)?void 0:E.device)}))),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement("div",{hidden:!N.protocol.CAN.use},m.exports.createElement(oe,null,m.exports.createElement(le,null,t("baud")),m.exports.createElement(ie,{value:N.protocol.CAN.baud,onChange:_,name:"protocol.CAN.baud",label:t("baud")},[25e4,5e5,1e6].map((e=>m.exports.createElement(I,{value:e,key:e},e))))))),m.exports.createElement(re,{item:!0,md:!0})),m.exports.createElement(R,{style:{marginTop:"1rem"},variant:"subtitle2",className:"subtitle-no-mt"},t("slam")),m.exports.createElement(re,{container:!0},m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement(W,{control:m.exports.createElement(Y,{checked:N.localization.UDP.use,name:"localization.UDP.use",onChange:_}),label:t("UDP")})),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement("div",{hidden:!N.localization.UDP.use},m.exports.createElement(se,{label:t("destination"),value:N.localization.UDP.destination,onChange:_,name:"localization.UDP.destination",error:Boolean(null==(x=null==(v=null==A?void 0:A.localization)?void 0:v.UDP)?void 0:x.destination),helperText:t(null==(y=null==(b=null==A?void 0:A.localization)?void 0:b.UDP)?void 0:y.destination)}))),m.exports.createElement(re,{item:!0,md:!0},m.exports.createElement("div",{hidden:!N.localization.UDP.use},m.exports.createElement(se,{label:t("port"),value:N.localization.UDP.port,onChange:_,name:"localization.UDP.port",error:Boolean(null==(C=null==(w=null==A?void 0:A.localization)?void 0:w.UDP)?void 0:C.port),helperText:t(null==(k=null==(S=null==A?void 0:A.localization)?void 0:S.UDP)?void 0:k.port)}))),m.exports.createElement(re,{item:!0,md:!0})))})));const mr=Q.object({lidar:Q.object({use:Q.boolean(),destination:Q.string().required("invalidAddress").ipv4("invalidAddress")}),ins:Q.object({use:Q.boolean(),destination:Q.string().required("invalidAddress").ipv4("invalidAddress")})});var ur=u.memo(u.forwardRef((function({initialValues:e,t:t=(e=>e||"")},n){var a,r,o,l;const c=ae({initialValues:e,validationSchema:mr,onSubmit:e=>{}});m.exports.useImperativeHandle(n,(()=>s(i({},c),{validationSchema:mr})));const{values:p,setValues:d,handleChange:f,touched:g,errors:h}=c;Tn({content:t("needRestore"),onConfirm:async()=>{await async function(){return(await ea.get("v1/restore-config",{timeout:5e3})).data}(),v(t("doReboot"));const e=await _a(!0);if(e.hostname){let t=`http://${e.hostname}`;const n=window.location.host.split(":")[1];t+=null==n?"":`:${n}`,window.location.href=t}},onCancel:async()=>{}});const[E,v]=jn();return u.createElement(u.Fragment,null,u.createElement(R,{variant:"subtitle2",className:"subtitle-no-mt"},t("pointcloudForward")),u.createElement(re,{container:!0},u.createElement(re,{item:!0,md:!0},u.createElement(W,{control:u.createElement(Y,{checked:p.lidar.use,name:"lidar.use",onChange:f}),label:"UDP"})),u.createElement(re,{item:!0,md:!0},u.createElement(S,{hidden:!p.lidar.use},u.createElement(se,{label:t("destination"),value:p.lidar.destination,name:"lidar.destination",onChange:f,error:Boolean(null==(a=null==h?void 0:h.lidar)?void 0:a.destination),helperText:t(null==(r=null==h?void 0:h.lidar)?void 0:r.destination)}))),u.createElement(re,{item:!0,md:!0})),u.createElement(R,{variant:"subtitle2",style:{marginTop:"1rem"},className:"subtitle-no-mt"},t("insRelay")),u.createElement(re,{container:!0},u.createElement(re,{item:!0,md:!0},u.createElement(W,{control:u.createElement(Y,{checked:p.ins.use,name:"ins.use",onChange:f}),label:"UDP"})),u.createElement(re,{item:!0,md:!0},u.createElement(S,{hidden:!p.ins.use},u.createElement(se,{label:t("destination"),value:p.ins.destination,name:"ins.destination",onChange:f,error:Boolean(null==(o=null==h?void 0:h.ins)?void 0:o.destination),helperText:t(null==(l=null==h?void 0:h.ins)?void 0:l.destination)}))),u.createElement(re,{item:!0,md:!0})))})));function pr({onClick:e,children:t}){return u.createElement(S,{position:"fixed",bottom:"2rem",right:"2rem"},u.createElement(xe,{onClick:e},t))}var dr={avfuns:{config:{device:!0,lidar:!0,camera:!0,radar:!0,ins:!0,detect:!0,slam:!0,output:!0,advance:!0},calibration:{calibrate_lidar:!0,calibrate_lidar_camera:!0,calibrate_camera:!0,calibrate_lidar_ins:!0,calibrate_lidar_radar:!0,calibrate_lidar_imu:!0,calibrate_panorama_camera:!0}}};const fr=be({name:"avfuns",initialState:dr.avfuns,reducers:{getAvfunsConfigAction:(e,t)=>t.payload}}),{getAvfunsConfigAction:gr}=fr.actions;var hr=fr.reducer;const Er=()=>async e=>{try{let t=await async function(){return(await ea.get("v1/get-web-store")).data}();"{}"===JSON.stringify(t)&&(t=dr.avfuns),t=ye.merge(JSON.parse(JSON.stringify(dr.avfuns)),JSON.parse(JSON.stringify(t))),e(gr(t))}catch(t){e(gr(dr.avfuns)),console.log(t)}},vr=X({root:{marginTop:"1rem"},indicator:{backgroundColor:"#1890ff"}})(we),xr=X((e=>Ce({root:{"&:hover":{color:"#40a9ff",opacity:1},"&$selected":{color:"#1890ff"},"&:focus":{color:"#40a9ff"}},selected:{}})))((e=>u.createElement(Se,i({},e))));const br=[5149168,16762545,9863115,16777215],yr=[6724095,16724889,13421568,65280,13369548,5374156],wr=[];for(let qs of br)wr.push(new Re({color:qs,wireframe:!1,transparent:!0,opacity:.4}));const Cr=[];for(let qs of br)Cr.push(new _e({color:qs,linewidth:2}));const Sr=[];for(let qs of yr)Sr.push(new Re({color:qs,wireframe:!1,transparent:!0,opacity:.4}));const kr=[];for(let qs of yr)kr.push(new _e({color:qs,linewidth:2}));function Mr({object:e,children:t,visible:n=!0,planeVisible:a=!0,showArrow:r=!1,colorType:o="objectType"}){const l=m.exports.useRef(),i=m.exports.useRef(),s=m.exports.useRef(),c=m.exports.useRef(),p=u.createElement("group",{ref:c,visible:!1},t,u.createElement("mesh",{ref:l,visible:!1},u.createElement("boxGeometry",{args:[1,1,1]})),u.createElement("lineSegments",{ref:i}),u.createElement("arrowHelper",{ref:s,args:[new Le(1,0,0),new Le(0,0,0),2,16776960],visible:r}));return m.exports.useEffect((()=>{i.current&&l.current&&(i.current.geometry=new Ae(l.current.geometry))}),[]),m.exports.useEffect((()=>{if(e&&e.box){const t=l.current,r=i.current,m=s.current,u=c.current;if(t&&r&&m&&u){if(e.type){const n=e.type-1;"objectType"==o?(t.material=wr[n],r.material=Cr[n]):"sensorType"==o&&(t.material=Sr[e.sensor],r.material=kr[e.sensor]),t.visible=a;const{width:l,height:i,length:s}=e.box;t.scale.set(s,l,i),r.scale.set(s,l,i)}else{const n=0;"objectType"==o?(t.material=wr[n],r.material=Cr[n]):"sensorType"==o&&(t.material=Sr[e.sensor],r.material=kr[e.sensor]),t.visible=a;const l=.2,i=.2,s=.2;t.scale.set(l,i,s),r.scale.set(l,i,s)}m.setLength(Math.max(e.box.length/2,1)),u.position.x=e.box.center.x,u.position.y=e.box.center.y,u.position.z=e.box.center.z,u.rotation.z=e.box.heading,u.visible=n}}}),[e]),p}function Ir({excludeConfig:e=[0,0,0,0,0,0]}){const t=m.exports.useRef(),n=u.createElement("mesh",{ref:t},u.createElement("boxGeometry",{args:[1,1,1]}));return m.exports.useEffect((()=>{if(e){const n=t.current;if(n){n.material=Sr[0];let t=[e[3]-e[0],e[4]-e[1],e[5]-e[2]];n.scale.set(t[0],t[1],t[2]),n.position.x=(e[3]+e[0])/2,n.position.y=(e[4]+e[1])/2,n.position.z=(e[5]+e[2])/2}}}),[e]),n}let Nr=[{color:"#4E91F0",src:"/assets/icons8-car-white.8632b264.svg"},{color:"#FFC6B1",src:"/assets/icons8-ped.64bcb3e8.svg"},{color:"#967FCB",src:"/assets/icons8-cyc-white.f6ed3dfe.svg"},{color:"#DDCC00",src:"/assets/icons8-cone.7bfb3da8.svg"}],Pr=0;for(let qs of Nr){let e=new Image;e.src=qs.src,e.onload=()=>{const t=document.createElement("canvas");let n=t.getContext("2d"),a=64;var r,o,l,i,s,c,m;t.width=a,t.height=a,r=n,o=qs.color,l=0,i=0,s=a,c=a,m=a/3,r.beginPath(),r.moveTo(l,i+m),r.lineTo(l,i+c),r.lineTo(l+s-m,i+c),r.arcTo(l+s,i+c,l+s,i+c-m,m),r.lineTo(l+s,i+m),r.arcTo(l+s,i,l+s-m,i,m),r.lineTo(l+m,i),r.arcTo(l,i,l,i+m,m),r.fillStyle=o,r.fill();let u=44.8,p=32-22.4;null==n||n.drawImage(e,p,p,u,u),qs.canvas=t,Pr+=1}}function Rr({object:e,showInfo:t=!1,scale:n=1}){const[a,r]=m.exports.useState(),[o,l]=m.exports.useState(),s=m.exports.useRef(),c=u.createElement("sprite",{ref:s,scale:[2/.184*n,2*n,1],center:[0,0],visible:!1},u.createElement("spriteMaterial",i({},{sizeAttenuation:!0,depthTest:!1,map:o})));return m.exports.useEffect((()=>{const e=document.createElement("canvas");e.height=184,e.width=1e3,r(e.getContext("2d")),l(new ze(e))}),[]),m.exports.useEffect((()=>{const n=s.current;if(e&&Pr>=Nr.length&&n&&a&&o){n.visible=!0,n.position.z=e.box.height/2,a.drawImage(Nr[e.type-1].canvas,0,120);const r=[`(${e.id},${e.confidence.toFixed(2)},${e.box.center.x.toFixed(2)},${e.box.center.y.toFixed(2)},${e.box.length.toFixed(2)},${e.box.width.toFixed(2)},${e.box.heading.toFixed(2)})`,`(${e.velocityX.toFixed(2)},${e.velocityY.toFixed(2)},${e.angleRate.toFixed(2)},${e.accelX.toFixed(2)},${e.age},${e.valid},${e.status})`];if(a.clearRect(0,0,1e3,120),t&&r){a.fillStyle="rgba(240, 240, 240, 1.0)",a.font="Bold 48px Arial";for(let e=0;e<r.length;e++){const t=r[e];a.fillText(t,0,48*(e+1))}}o.needsUpdate=!0}})),c}function _r({freespace:e,visible:t=!1}){const n=m.exports.useRef(),a=u.createElement("mesh",{ref:n},u.createElement("planeGeometry",{args:[1,1]})),r=m.exports.useRef({canvas:null,texture:null});return m.exports.useEffect((()=>{const e=document.createElement("canvas"),t=new ze(e);n.current.material=new Re({transparent:!0,opacity:.8,map:t}),r.current={canvas:e,texture:t}}),[]),m.exports.useEffect((()=>{const a=n.current,{canvas:o,texture:l}=r.current;if(o&&l&&a&&e&&e.cells&&e.info){if(a.visible=t,t&&e){let t,n;t=e.info.xMax-e.info.xMin,n=e.info.yMax-e.info.yMin,a.scale.set(t,n,1),a.position.x=t/2+e.info.xMin,a.position.y=n/2+e.info.yMin,a.position.z=e.info.zMin;let r=new Uint8ClampedArray(e.info.yNum*e.info.xNum*4);for(let a=0;a<e.cells.length;a++)48==e.cells[a]&&(r[4*a+1]=255),r[4*a+3]=255;let i=new ImageData(r,e.info.xNum,e.info.yNum);o.width=e.info.xNum,o.height=e.info.yNum;const s=o.getContext("2d");null==s||s.putImageData(i,0,0),l.needsUpdate=!0}}else a&&(a.visible=!1)})),a}class Lr{constructor(e,t){this.camera=e,this.dom=t,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp)}onMouseDown(e){this.dom.addEventListener("mousemove",this.onMouseMove)}onMouseUp(e){this.dom.removeEventListener("mousemove",this.onMouseMove)}onMouseMove(e){const t=e.clientX;if(this.lastX){t-this.lastX>0?this.camera.rotateY(Math.PI/90):this.camera.rotateY(-Math.PI/90)}this.lastX=t}dispose(){this.dom.removeEventListener("mousedown",this.onMouseDown),this.dom.removeEventListener("mouseup",this.onMouseUp),this.dom.removeEventListener("mousemove",this.onMouseMove)}}const Ar={NORMAL:0,UP:1,SELF:2,IMAGE:3,ORTHOGRAPHIC:4,CAMERA:5,FOLLOW:6,DRIVER:7};function zr({type:e=Ar.NORMAL,height:t=50,position:n=[0,0,0],enable:a=!0}){const{camera:r,gl:o}=Fe(),[l,i]=m.exports.useState();let s;return m.exports.useEffect((()=>{switch(o.localClippingEnabled=!0,l&&l.dispose(),e){case Ar.ORTHOGRAPHIC:r.up.set(0,0,1),r.position.set(-.001,0,150),r.lookAt(0,0,0),r.zoom=20,r.updateProjectionMatrix(),s=new De(r,o.domElement),s.rotateSpeed=.2,i(s);break;case Ar.FOLLOW:case Ar.NORMAL:r.up.set(0,0,1),r.position.set(n[0]-15,n[1],n[2]+20),r.lookAt(n[0],n[1],n[2]),s=new Oe(r,o.domElement),s.target.set(n[0],n[1],n[2]),i(s),s.update();break;case Ar.CAMERA:r.up.set(0,-1,0),r.position.set(0,0,-10),r.lookAt(0,0,0),r.rotateX(Math.PI),i(new De(r,o.domElement));break;case Ar.UP:r.position.set(-.001,0,t),r.lookAt(0,0,0),r.up.set(0,0,1),s=new Oe(r,o.domElement),s.enableRotate=!1,i(s);break;case Ar.IMAGE:r.position.set(0,0,t),r.lookAt(0,0,0),r.up.set(0,0,1),s=new Oe(r,o.domElement),s.maxPolarAngle=0,s.maxAzimuthAngle=0,s.minAzimuthAngle=0,i(s);break;case Ar.DRIVER:r.up.set(0,0,1),r.position.set(-1,0,1),r.lookAt(20,0,0),i(new Lr(r,o.domElement));break;case Ar.SELF:r.up.set(0,0,1),r.position.set(-15,0,20),r.lookAt(0,0,0),i(new Oe(r,o.domElement))}}),[r,o,e]),m.exports.useEffect((()=>{e==Ar.FOLLOW&&l&&(l.object.lookAt(n[0],n[1],n[2]),l.target.set(n[0],n[1],n[2]))}),[n]),m.exports.useEffect((()=>{l&&(l.enableZoom=a,l.enableRotate=a,l.enablePan=a)}),[a]),null}function Fr({trajectory:e=[],visible:t=!0}){const n=m.exports.useRef(),a=u.createElement("mesh",{ref:n,visible:t},u.createElement("meshBasicMaterial",i({},{color:15642701,transparent:!0,opacity:.8})));return m.exports.useEffect((()=>{let a=e;if(t&&n.current)if(a&&a.length>0){let e=a[1].x-a[0].x,t=a[1].y-a[0].y,r=Math.atan2(t,e)+Math.PI/2;e=.3*Math.cos(r),t=.3*Math.sin(r);let o=[];for(let n=0;n<a.length;n++)o.push(new Te(a[n].x+e,a[n].y+t));for(let n=0;n<a.length;n++)o.push(new Te(a[a.length-1-n].x-e,a[a.length-1-n].y-t));n.current.visible=!0,n.current.geometry.dispose(),n.current.geometry=new je(new Be(o))}else n.current.visible=!1}),[e]),a}function Or({objUrl:e="/assets/car.3e9eceb2.obj",visible:t=!1,props:n}){const a=Ue((()=>new Ge),[]),{scene:r}=Fe(),[o,{set:l,get:i}]=Ve();return m.exports.useEffect((()=>{e&&a.load(e,(e=>{for(let t of e.children)t.material=new Re({wireframe:!0});l("obj",e),t&&(r.remove(e),e.scale.set(1,1,1),n?(e.rotation.set(n.rotation[0],n.rotation[1],n.rotation[2]),e.rotateX(Math.PI/2),e.rotateY(Math.PI),e.position.set(n.position[0],n.position[1],n.position[2])):(e.rotation.set(0,0,0),e.rotateX(Math.PI/2),e.rotateY(Math.PI),e.rotateZ(0),e.position.set(0,0,0)),r.add(e))}))}),[]),m.exports.useEffect((()=>{if(t){const e=i("obj");e&&(r.remove(e),e.scale.set(1,1,1),n?(e.rotation.set(n.rotation[0],n.rotation[1],n.rotation[2]),e.rotateX(Math.PI/2),e.rotateY(Math.PI),e.position.set(n.position[0],n.position[1],n.position[2])):(e.rotation.set(0,0,0),e.rotateX(Math.PI/2),e.rotateY(Math.PI),e.rotateZ(0),e.position.set(0,0,0)),r.add(e))}else{const e=i("obj");e&&r.remove(e)}}),[t,n]),null}function Dr(e,t){const n=Ue((()=>new He),[]),[a,r]=m.exports.useState(),[o,l]=m.exports.useState(640),[i,s]=m.exports.useState(480);return m.exports.useEffect((()=>{e&&n.load(e,(e=>{r(e),l(e.image.width),s(e.image.height),t&&t()}))}),[e]),{texture:a,width:o,height:i}}function Tr({src:e,pointsPicked:t,onChange:n,enabled:a,removing:r=!1,onTextureLoad:o}){m.exports.useRef({width:null,height:null});const{texture:l,width:i,height:s}=Dr(e,o),c=s/i,[p]=m.exports.useState(new Array(10).fill(0).map(((e,t)=>document.createElement("canvas"))));m.exports.useEffect((()=>{p.forEach(((e,t)=>{const n=e.getContext("2d");e.width=320,e.height=32,n&&(n.fillStyle="rgba(240, 0, 0, 1.0)",n.font="Bold 32px Arial",n.fillText(t+1+"",0,32))}))}),[]);return u.createElement(u.Fragment,null,u.createElement(zr,{type:Ar.IMAGE,height:1.2}),u.createElement("mesh",{onClick:e=>{var o;o=e.point,console.log(o),a&&!r&&n(fe(t,(e=>{o.x+=.5,o.y=.5-o.y/c,e.push(o)})))},scale:[1,1*c,1]},u.createElement("planeBufferGeometry",{args:[1,1]}),l?u.createElement("meshBasicMaterial",{map:l}):null),t.map(((e,o)=>u.createElement("group",{position:[e.x-.5,(.5-e.y)*c,0],key:o,onClick:()=>(e=>{a&&r&&n(fe(t,(t=>{t.splice(e,1)})))})(o)},u.createElement("mesh",null,u.createElement("sphereGeometry",{args:[.003,32,32]}),u.createElement("meshBasicMaterial",{color:16711680})),u.createElement("sprite",{"position-x":.005,"position-y":.005,scale:[.5,.05,1],center:[0,0]},u.createElement("spriteMaterial",{sizeAttenuation:!1,depthTest:!1},u.createElement("canvasTexture",{attach:"map",args:[p[o]]})))))))}function jr({maxNum:e=1e6,pointsize:t=1.5,transparent:n=!1,points:a,imageUrl:r,onLoad:o,pointsProps:l,cameraIntrinsic:c,visible:p=!0,zRange:d={min:-1e4,max:1e4}}){const f=Ue((()=>new qe(new Float32Array(4*e),4)),[e]);m.exports.useEffect((()=>{a&&p?(f.set(a),f.count=a.length/4,f.needsUpdate=!0):(f.count=0,f.needsUpdate=!0)}),[a,p]);const{texture:g,width:h,height:E}=Dr(r,(()=>{o&&o()})),v=Ue((()=>({pointSize:{value:t},width:new $e(h),height:new $e(E),textureImage:new $e(g),cx:new $e((null==c?void 0:c.cx)||320),cy:new $e((null==c?void 0:c.cy)||240),fx:new $e((null==c?void 0:c.fx)||600),fy:new $e((null==c?void 0:c.fy)||600),extraT:new $e(l||(new O).set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1))})),[]),x=m.exports.useRef();m.exports.useEffect((()=>{const e=x.current;v.textureImage.value=g,v.width.value=h,v.height.value=E,e&&(e.uniforms.pointSize.value=t),c&&(v.cx.value=c.cx,v.cy.value=c.cy,v.fx.value=c.fx,v.fy.value=c.fy),l&&(v.extraT.value=l)}),[c,l,g,h,E,t]);let b=m.exports.useMemo((()=>u.createElement("bufferGeometry",{attributes:{position:f}})),[f]),y=m.exports.useMemo((()=>u.createElement("shaderMaterial",s(i({ref:x},{uniforms:v,vertexShader:"varying vec4 PointWorld;\nuniform mat4 extraT;\n\nuniform float pointSize;\n#include <clipping_planes_pars_vertex>\nvoid main() {\n  #include <begin_vertex>\n  PointWorld = extraT * vec4(position.x, position.y, position.z, 1.0);\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position.x, position.y, position.z, 1.0);\n\n  gl_PointSize = pointSize;\n  #include <project_vertex>\n  #include <clipping_planes_vertex>\n}",fragmentShader:n?"uniform sampler2D textureImage;\nuniform float cx;\nuniform float cy;\nuniform float fx;\nuniform float fy;\nuniform float width;\nuniform float height;\n\nvarying vec4 PointWorld; // position in camera coordinate\n#include <clipping_planes_pars_fragment>\nvoid main() {\n  #include <clipping_planes_fragment>\n  if(PointWorld.z > 0.1){\n    float u = PointWorld.x/PointWorld.z * fx + cx;\n    float v = PointWorld.y/PointWorld.z * fy + cy;\n    if(u>width || u<0.0 || v>height || v<0.0){\n      discard;\n    }else{\n      v = height - v;\n      vec2 uv = vec2(\n        u/ width,\n        v/ height\n      );\n      gl_FragColor = texture(textureImage, uv );\n    }\n  }else{\n    discard;\n  }\n}":"uniform sampler2D textureImage;\nuniform float cx;\nuniform float cy;\nuniform float fx;\nuniform float fy;\nuniform float width;\nuniform float height;\n\nvarying vec4 PointWorld; // position in camera coordinate\n\nvoid main() {\n  if(PointWorld.z > 0.1){\n    float u = PointWorld.x/PointWorld.z * fx + cx;\n    float v = PointWorld.y/PointWorld.z * fy + cy;\n    if(u>width || u<0.0 || v>height || v<0.0){\n      gl_FragColor = vec4(0.5, 0.5, 0.5, 0);\n    }else{\n      v = height - v;\n      vec2 uv = vec2(\n        u/ width,\n        v/ height\n      );\n      gl_FragColor = texture(textureImage, uv );\n    }\n  }else{\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0);\n  }\n}",clippingPlanes:[new We(new Le(0,0,-1),d.max/10),new We(new Le(0,0,1),-d.min/10)]}),{transparent:n,clipping:!0,onUpdate:e=>{e.needsUpdate=!0}}))),[v,d.min,d.max]);return u.createElement("points",{frustumCulled:!1},b,y)}function Br({points:e,imageData:t,pointSize:n}){const[a,r]=m.exports.useState();return m.exports.useEffect((()=>{aa().then((e=>{const t={};for(let n of e.camera)t[n.name]=n;r(t)}))}),[]),u.createElement(u.Fragment,null,Object.keys(t).sort().map((r=>u.createElement(Ur,{key:r,cameraName:r,points:e,imageData:t[r],cameraConfig:a,pointSize:n}))))}function Ur({cameraName:e="",points:t,imageData:n,cameraConfig:a,pointSize:r}){const o=m.exports.useRef({lock:!1}),[l,i]=m.exports.useState();m.exports.useEffect((()=>{if(!n)return;if(o.current.lock)return;o.current.lock=!0;const e=new Blob([n.buffer],{type:"application/octet-stream"});i(URL.createObjectURL(e))}),[n]);const[s,c]=m.exports.useState();m.exports.useEffect((()=>{if(a&&e){const t=a[e],n=new Le(t.extrinsic_parameters[0],t.extrinsic_parameters[1],t.extrinsic_parameters[2]),r=new Le(1,1,1),o=new Ye,l=new Xe(.01745329251994*t.extrinsic_parameters[3],.01745329251994*t.extrinsic_parameters[4],.01745329251994*t.extrinsic_parameters[5],"XYZ");o.setFromEuler(l),o.set(o.y,o.x,o.z,o.w);const i=new O;i.compose(n,o,r),c(i)}}),[a,e]);const[p,d,f,g]=m.exports.useMemo((()=>{var t;return void 0===e||void 0===a?[600,600,320,240]:null==(t=a[e])?void 0:t.intrinsic_parameters.slice(0,4)}),[e,a]);return u.createElement(jr,{maxNum:1e6,pointsize:2*r,transparent:!0,points:t,imageUrl:l,onLoad:()=>{l&&URL.revokeObjectURL(l),o.current.lock=!1},cameraIntrinsic:{cx:f,cy:g,fx:p,fy:d},pointsProps:s})}var Gr="varying vec4 PointWorld;\n\nuniform float pointSize;\n#include <clipping_planes_pars_vertex>\nvoid main() {\n  #include <begin_vertex>\n  PointWorld = modelMatrix * vec4(position.x, position.y, position.z, 1.0);\n  gl_Position = projectionMatrix * viewMatrix * PointWorld;\n\n  gl_PointSize = pointSize;\n  #include <project_vertex>\n  #include <clipping_planes_vertex>\n}",Vr="varying vec4 PointWorld; // position in world coordinate\n\n// https://stackoverflow.com/questions/15095909/from-rgb-to-hsv-in-opengl-glsl\n// All components are in the range [0…1], including hue.\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec3 hsv0 = vec3(0, 1, 1);\nvec3 hsv1 = vec3(0.9, 1, 1);\n\nvoid main() {\n  float depth = sqrt(PointWorld.x*PointWorld.x + PointWorld.y*PointWorld.y);\n  if(depth > 20.0) depth = 20.0;\n  if(depth < 0.5) depth = 0.5;\n  gl_FragColor = vec4(hsv2rgb(mix(hsv0, hsv1, (depth-0.5)/18.0)), 1.0);\n}",Hr="varying vec4 PointWorld; // position in world coordinate\nuniform float heightColor[2];\n// https://stackoverflow.com/questions/15095909/from-rgb-to-hsv-in-opengl-glsl\n// All components are in the range [0…1], including hue.\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n#include <clipping_planes_pars_fragment>\nvoid main() {\n  #include <clipping_planes_fragment>\n  float heigtRange = heightColor[0] - heightColor[1] + 0.1;\n  vec3 hsv0 = vec3(heightColor[0] / heigtRange, 1, 1.0);\n  vec3 hsv1 = vec3(heightColor[1] / heigtRange, 1, 1.0);\n  float percent = PointWorld.z / heigtRange;\n  gl_FragColor = vec4(hsv2rgb(mix(hsv0, hsv1, percent)), 1.0);\n}";function qr({maxNum:e=1e6,points:t,onPointsUpdate:n,color:a="gray",size:r=1,frustumCulled:o=!1,visible:l=!0,zRange:c={min:-1e4,max:1e4},clip:p,pointsProps:d}){const f=Ue((()=>new qe(new Float32Array(4*e),4)),[e]);m.exports.useEffect((()=>{t&&l?(f.set(t),f.count=t.length/4,f.needsUpdate=!0):(f.count=0,f.needsUpdate=!0),n&&n()}),[t,l]);const g=m.exports.useRef(),h=Ue((()=>{const e=c.max>1e3?4:c.max/10,t=c.min<-1e3?-2:c.min/10;return{pointSize:{value:r},heightColor:{value:[e,t]}}}),[]);return m.exports.useEffect((()=>{const e=g.current;if(e&&e.uniforms){const t=c.max>1e3?4:c.max/10,n=c.min<-1e3?-2:c.min/10;e.uniforms.pointSize.value=r,e.uniforms.heightColor.value=[t,n]}}),[r,c.min,c.max]),u.createElement("points",i({frustumCulled:o},d),u.createElement("bufferGeometry",{attributes:{position:f}}),"gray"!==a&&"rgb"!==a?u.createElement("shaderMaterial",s(i({ref:g},{clippingPlanes:[new We(new Le(0,0,-1),p?p.max/10:c.max/10),new We(new Le(0,0,1),p?-p.min/10:-c.min/10)],vertexShader:Gr,fragmentShader:"depth"===a?Vr:Hr,uniforms:h}),{clipping:!0,onUpdate:e=>{e.needsUpdate=!0}})):u.createElement("pointsMaterial",i({},{size:r,sizeAttenuation:!1,color:210734991,clippingPlanes:[new We(new Le(0,0,-1),p?p.max/10:c.max/10),new We(new Le(0,0,1),p?-p.min/10:-c.min/10)]})))}function $r({maxNum:e=1e6,points:t,onPointsUpdate:n,color:a="intensity",maxIntensity:r=1,size:o=1,frustumCulled:l=!1,visible:s=!0,zRange:c={min:-1e4,max:1e4},clip:p,pointsProps:d}){const f=Ue((()=>new qe(new Float32Array(4*e),4)),[e]),g=Ue((()=>new qe(new Float32Array(3*e),3)),[e]);return m.exports.useEffect((()=>{if(t&&s){let e=[];for(let n=0,a=0;n<t.length;n+=4,a+=3){let o=4*Math.min(1,Math.max(0,t[n+3]/r))+1,l=Math.floor(o),i=o-l;1&l&&(i=1-i);let s,c,m,u=1-i;l<=1?(s=0,c=u,m=1):2==l?(s=0,c=1,m=u):3==l?(s=u,c=1,m=0):(s=1,c=u,m=0),e[a+0]=s,e[a+1]=c,e[a+2]=m}f.set(t),f.count=t.length/4,g.set(e),g.count=e.length/3,f.needsUpdate=!0,g.needsUpdate=!0}else f.count=0,g.count=0,f.needsUpdate=!0,g.needsUpdate=!0;n&&n()}),[t,s,r]),u.createElement("points",i({frustumCulled:l},d),u.createElement("bufferGeometry",{attributes:{position:f,color:g}}),u.createElement("pointsMaterial",i({},{size:o,sizeAttenuation:!1,vertexColors:!0,clippingPlanes:[new We(new Le(0,0,-1),p?p.max/10:c.max/10),new We(new Le(0,0,1),p?-p.min/10:-c.min/10)]})))}function Wr({trajectory:e=[],lineColor:t=65382}){const n=m.exports.useRef(),a=m.exports.useRef();return m.exports.useEffect((()=>{const e=n.current,t=a.current;e&&(e.frustumCulled=!1),t&&(t.frustumCulled=!1)}),[]),m.exports.useEffect((()=>{const t=n.current,r=a.current;t&&r&&e&&(null==t||t.geometry.setFromPoints(e),null==r||r.geometry.setFromPoints(e))}),[e]),u.createElement(u.Fragment,null,u.createElement("line",{ref:n},u.createElement("lineBasicMaterial",{color:t,linewidth:3})),u.createElement("points",{ref:a},u.createElement("pointsMaterial",{color:16711731,size:.2})))}function Yr({config:e=Kr,showMessage:t}){const{t:n}=v(),[a,r]=m.exports.useState([]),[o,l]=m.exports.useState([]),[i,s]=m.exports.useState([]),{data:c}=U(Ma,{pollingInterval:1e3,onError:()=>{r([]),l([]),s([])}});return Ke(Ze((async()=>{if(!c)return;let t=!1,n=Object.keys(c);if(n.length<a.length)return r(a.slice(0,n.length)),l(o.slice(1,n.length+1)),void s(i.slice(0,n.length));for(let r=0;r<a.length;r++){let l=n[r];if(a[r]!=l){t=!0,a[r]=l;let n=parseInt(l)%e.map.step==0;o[r+1]=u.createElement(Xr,{key:l,id:l,config:e.map,visible:n,vertexPose:ka(c[l])}),i[r]=new Le(c[l][3],c[l][7],c[l][11])}}let m=Math.min(10,n.length-a.length);if(m>0){t=!0;let r=a.length;for(let t=r;t<m+r;t++){let r=n[t],l=parseInt(r)%e.map.step==0;a[t]=r,o[t+1]=u.createElement(Xr,{key:r,id:r,config:e.map,visible:l,vertexPose:ka(c[r])}),i[t]=new Le(c[r][3],c[r][7],c[r][11])}}t&&(o[0]=u.createElement(Wr,{key:-1,trajectory:i}),r(a),l(o),s([...i]))})),200),Ke(Ze((async()=>{if(c){(async function(){return(await ea.get("v1/map-status")).data})().then((e=>{e.loop_detected&&t(n("loopDetected"),5e3)}));for(let t=1;t<o.length;t++){let n=a[t-1],r=parseInt(n)%e.map.step==0;o[t]=u.createElement(Xr,{key:n,id:n,config:e.map,visible:r,vertexPose:ka(c[n])}),i[t-1]=new Le(c[n][3],c[n][7],c[n][11])}o[0]=u.createElement(Wr,{key:-1,trajectory:i}),s([...i])}})),3e3),m.exports.useEffect((()=>{if(c)for(let t=1;t<o.length;t++){let n=a[t-1],r=parseInt(n)%e.map.step==0;o[t]=u.createElement(Xr,{key:n,id:n,config:e.map,visible:r,vertexPose:ka(c[n])})}}),[e]),u.createElement(u.Fragment,null,o)}function Xr({id:e,config:t,visible:n,vertexPose:a}){const[r,o]=m.exports.useState(),[l,c]=m.exports.useState();m.exports.useEffect((()=>{e!=r&&n&&(Ia(e).then((e=>{c(e.points)})),o(e))}),[e]),m.exports.useEffect((()=>{!n||null!=l&&0!=l.length&&e==r||(Ia(e).then((e=>{c(e.points)})),o(e))}),[n]);const[p,d]=m.exports.useState();return m.exports.useEffect((()=>{if(a){const e=new Le,t=new Ye,n=new Le;a.decompose(e,t,n);const r=new Xe;if(r.setFromQuaternion(t),p){let t=p.rotation,n=p.position,a=Math.abs(t[0]-r.x)+Math.abs(t[1]-r.y)+Math.abs(t[2]-r.z),o=Math.abs(n[0]-e.x)+Math.abs(n[1]-e.y)+Math.abs(n[2]-e.z);if(a<.1&&o<.1)return}d({position:e.toArray(),rotation:r.toArray()})}}),[a]),u.createElement(u.Fragment,null,"intensity"==t.color?u.createElement($r,s(i({maxNum:l?l.length/4:0,points:l},t),{clip:{min:-1e4,max:1e4},maxIntensity:.75,size:1.5,frustumCulled:t.frustumCulled,visible:t.visible&&n,pointsProps:p})):u.createElement(qr,s(i({maxNum:l?l.length/4:0,points:l},t),{clip:{min:-1e4,max:1e4},size:1.5,frustumCulled:t.frustumCulled,visible:t.visible&&n,pointsProps:p})))}const Kr={axis:{size:2,visible:!0},objObject:{visible:!1},polarGrid:{visible:!0,radius:50,radials:16,circles:5,divisions:64,color:4473924},pointcloud:{color:"gray",size:1.5,maxIntensity:1,sampleStep:0},freespace:{visible:!1},object:{visible:!0,color:"objectType",showOnImage:!1,showInfo:!1,showTrajectory:!1,showArrow:!1,labelScale:1},map:{visible:!0,frustumCulled:!1,color:"height",zRange:{min:-20,max:40},step:5},camera:{type:Ar.NORMAL},radar:{visible:!1}};function Zr({frameData:e,rangeDrawer:t,config:n=Kr,props:a,invProps:r,pointView:o,showMessage:l,children:c}){const m=new Array(3).fill(n?n.axis.size:1),{visible:p,radials:d,radius:f,circles:g,divisions:h,color:E}=n.polarGrid;let v=u.useMemo((()=>u.createElement(Yr,{config:n,showMessage:l})),[n]),x=u.useMemo((()=>u.createElement(zr,s(i({},n&&n.camera),{position:a?a.position:[0,0,0]}))),[n,a]),b=u.useMemo((()=>u.createElement("axesHelper",s(i({},n&&n.axis),{scale:m,"material-linewidth":n.axis.size}))),[n]);return u.createElement(Je,null,u.createElement("polarGridHelper",{args:[f,d,g,h,E,E],visible:p,"rotation-x":Math.PI/2}),u.createElement(Or,s(i({},{visible:n.objObject.visible}),{props:n.camera.type!=Ar.SELF?a:void 0})),u.createElement("group",i({frustumCulled:n.map.frustumCulled},n.camera.type==Ar.SELF?i({},r):{}),v),x,t,o,n.camera.type==Ar.SELF&&"rgb"==n.pointcloud.color&&e&&e.images&&u.createElement(Br,{points:e.points,imageData:e.images,pointSize:n.pointcloud.size}),u.createElement("group",i({},n.camera.type!=Ar.SELF?i({},a):{}),b,c,e&&e.objects.map((e=>u.createElement(u.Fragment,null,u.createElement(Mr,{object:e,planeVisible:"rgb"!=n.pointcloud.color,visible:n&&n.object.visible,showArrow:n&&n.object.showArrow,colorType:n.object.color},u.createElement(Rr,{object:e,showInfo:n&&n.object.showInfo,scale:n&&n.object.labelScale})),u.createElement(Fr,{trajectory:e.trajectory,visible:n&&n.object.showTrajectory})))),e&&u.createElement(_r,i({freespace:e.freespace},n&&n.freespace))))}var Jr=u.forwardRef((function({enabled:e=!1,roi:t,state:n,onChange:a,onStart:r,onEnd:o},l){const i=m.exports.useRef();m.exports.useEffect((()=>{const e=i.current;e&&e.geometry.setFromPoints(t)}),[t]),m.exports.useEffect((()=>{const e=i.current;e&&(e.frustumCulled=!1)}),[]);const s=()=>{e&&"drawing"===n&&(t.length>2?(a([...t,t[0]]),o&&o("idle")):(a([]),o&&o("drawing")))};return m.exports.useImperativeHandle(l,(()=>({start:()=>{r&&r()},stop:s,roi:t}))),u.createElement("group",null,u.createElement("line",{ref:i},u.createElement("lineBasicMaterial",{color:16777215,linewidth:2})),u.createElement("mesh",{onClick:r=>{e&&"drawing"===n&&a([...t,r.intersections[0].point])},onPointerMove:a=>{if(e&&"drawing"===n){const e=i.current;null==e||e.geometry.setFromPoints([...t,a.intersections[0].point])}},visible:!1},u.createElement("planeBufferGeometry",{args:[1e4,1e4]})))}));var Qr=u.forwardRef((function({enabled:e=!1,state:t,setPose:n,onStart:a,onEnd:r},o){const l=m.exports.useRef(),i=m.exports.useRef({lock:!1}),[s,c]=m.exports.useState(new Le(0,0,0));return m.exports.useImperativeHandle(o,(()=>({start:()=>{a&&a()}}))),u.createElement("group",null,"drawing"===t&&u.createElement("points",{ref:l},u.createElement("pointsMaterial",{color:16711680,size:8,sizeAttenuation:!1})),u.createElement("mesh",{onClick:n=>{e&&"drawing"===t&&r&&r("idle",!1)},onPointerMove:a=>{const o=l.current,m=a.intersections[0].point;e&&"drawing"===t&&(o.frustumCulled=!1,o.renderOrder=999,o.material.depthTest=!1,o.material.depthWrite=!1,o.geometry.setFromPoints([m]),!i.current.lock&&m.distanceTo(s)>.5&&(i.current.lock=!0,async function(e){return(await ea.post("v1/get-estimate-pose",{pose_range:e})).data}([[s.x,s.y],[m.x,m.y]]).then((e=>{1==e[6]&&r&&r("idle",!0),n(e),i.current.lock=!1}))),m.distanceTo(s)>1&&c(m))},visible:!1},u.createElement("planeBufferGeometry",{args:[1e4,1e4]})))}));function eo({onStart:e,enabled:t,menuItems:n}){const{t:a}=v(),[r,o]=m.exports.useState({left:0,top:0}),[l,i]=m.exports.useState(!1);return m.exports.useEffect((()=>(document.body.oncontextmenu=n=>{e&&e(),t&&(e=>{i(!0),o({left:e.clientX,top:e.clientY})})(n)},()=>{document.body.oncontextmenu=null})),[n]),u.createElement(M,{anchorReference:"anchorPosition",anchorPosition:r,open:l,onClose:()=>i(!1)},u.createElement(Qe,null,Object.entries(n).map((e=>u.createElement(I,{key:e[0],onClick:()=>{e[1](),i(!1)}},a(e[0]))))))}class to{constructor(e=""){this.msg=e,this.fps=0}hit(){let e,t;return this.t0?(e=performance.now()-this.t0,t=1e3/e*.2+.8*this.fpsBefore,this.fpsBefore=t,this.t0=performance.now(),this.fps=t,t):(this.fpsBefore=0,this.t0=performance.now(),0)}}function no(e,t,n,a){let r=0|(void 0===n?0:n),o=0|(void 0===a?(0|e.length)-r:a);if(o=o-1|0,2147483648&o){const n=2147483648&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(1073741824&o){const n=3221225472&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(536870912&o){const n=3758096384&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(268435456&o){const n=4026531840&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(134217728&o){const n=4160749568&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(67108864&o){const n=4227858432&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(33554432&o){const n=4261412864&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(16777216&o){const n=4278190080&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(8388608&o){const n=4286578688&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(4194304&o){const n=4290772992&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(2097152&o){const n=4292870144&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(1048576&o){const n=4293918720&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(524288&o){const n=4294443008&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(262144&o){const n=4294705152&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(131072&o){const n=4294836224&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(65536&o){const n=4294901760&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(32768&o){const n=4294934528&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(16384&o){const n=4294950912&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(8192&o){const n=4294959104&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(4096&o){const n=4294963200&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(2048&o){const n=4294965248&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(1024&o){const n=4294966272&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(512&o){const n=4294966784&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(256&o){const n=4294967040&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(128&o){const n=4294967168&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(64&o){const n=4294967232&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(32&o){const n=4294967264&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(16&o){const n=4294967280&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(8&o){const n=4294967288&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(4&o){const n=4294967292&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(2&o){const n=4294967294&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}if(1&o){const n=4294967295&o;o^=(o^n-1)&(e[r+n|0]<=t|0)-1>>>0}return e[r+o|0]!==t?-1:r+o|0}function ao(e,t){const n=e.slice(),a=new Le;for(let r=0;r<n.length/4;r++)a.set(n[4*r+0],n[4*r+1],n[4*r+2]),a.applyMatrix4(t),n[4*r+0]=a.x,n[4*r+1]=a.y,n[4*r+2]=a.z;return n}function ro(e){const t=new Array(...e),n=new O,a=new Le(t[0],t[1],t[2]),r=new Ye,o=new Le(1,1,1),l=new Xe(t[3]*Math.PI/180,t[4]*Math.PI/180,t[5]*Math.PI/180,"XYZ");return r.setFromEuler(l),n.compose(a,r,o),n}function oo(e,t,n,a,r,o){const l=r-n,i=o-a,s=l*l+i*i;let c,m,u=-1;0!=s&&(u=((e-n)*l+(t-a)*i)/s),u<0?(c=n,m=a):u>1?(c=r,m=o):(c=n+u*l,m=a+u*i);const p=e-c,d=t-m;return Math.sqrt(p*p+d*d)}function lo(e,t){const n=e.x,a=e.y;let r=!1;for(let o=0,l=t.length-1;o<t.length;l=o++){const e=t[o].x,i=t[o].y,s=t[l].x,c=t[l].y;i>a!=c>a&&n<(s-e)*(a-i)/(c-i)+e&&(r=!r)}return r}const io="MacIntel"===navigator.platform?"Meta":"Control";function so(){const[e,t]=m.exports.useState(!1);return m.exports.useEffect((()=>{const e=e=>{e.key===io&&t(!0)},n=e=>{e.key===io&&t(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",n),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",n)}}),[]),e}function co(){const[e,t]=m.exports.useState(!1);return m.exports.useEffect((()=>{const e=e=>{"Shift"===e.key&&t(!0)},n=e=>{"Shift"===e.key&&t(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",n),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",n)}}),[]),e}function mo({config:e=Kr,setConfig:t,t:n=(e=>e),className:a}){const r=m.exports.useRef();return m.exports.useEffect((()=>{const a=new et.exports.Pane({container:r.current});let o;return a.registerPlugin(tt),a.on("change",(r=>{t(i({},e));for(let t=0;t<a.children.length;t++){let r=a.children[t];r.title==n("pointcloud")&&(r.children[1].hidden="intensity"!=e.pointcloud.color)}})),o=a.addFolder({title:n("axis"),expanded:!1}),o.addInput(e.axis,"size",{min:1,max:10,step:1,label:n("size")}),o.addInput(e.axis,"visible",{label:n("visible")}),o=a.addFolder({title:n("objObject"),expanded:!1}),o.addInput(e.objObject,"visible",{label:n("visible")}),o=a.addFolder({title:n("polarGrid"),expanded:!1}),o.addInput(e.polarGrid,"visible",{label:n("visible")}),o.addInput(e.polarGrid,"radius",{min:10,max:100,step:1,label:n("radius")}),o.addInput(e.polarGrid,"radials",{min:8,max:36,step:1,label:n("radials")}),o.addInput(e.polarGrid,"circles",{min:2,max:16,step:1,label:n("circles")}),o.addInput(e.polarGrid,"color",{view:"color",label:n("color")}),o=a.addFolder({title:n("camera"),expanded:!1}),o.addInput(e.camera,"type",{options:Object.fromEntries(Object.entries(Ar).filter((([e,t])=>{if(t<=2||6==t)return[e,t]})).map((([e,t])=>[n(e),t]))),label:n("type")}),o=a.addFolder({title:n("pointcloud"),expanded:!1}),o.addInput(e.pointcloud,"color",{label:n("color"),options:Object.fromEntries(["gray","depth","height","intensity","rgb"].map((e=>[n(e),e])))}),o.addInput(e.pointcloud,"maxIntensity",{min:.1,max:10,step:.1,label:n("maxIntensity"),hidden:"intensity"!=e.pointcloud.color}),o.addInput(e.pointcloud,"size",{min:1,max:5,step:.5,label:n("size")}),o.addInput(e.pointcloud,"sampleStep",{min:0,max:2,step:.1,label:n("sampleStep")}),o=a.addFolder({title:n("object"),expanded:!1}),o.addInput(e.object,"visible",{label:n("objectVisible")}),o.addInput(e.object,"showOnImage",{label:n("showOnImage")}),o.addInput(e.object,"color",{label:n("color"),options:Object.fromEntries(["objectType","sensorType"].map((e=>[n(e),e])))}),o.addInput(e.object,"showArrow",{label:n("direction")}),o.addInput(e.object,"showInfo",{label:n("details")}),o.addInput(e.object,"labelScale",{label:n("labelScale"),min:1,max:4}),o.addInput(e.object,"showTrajectory",{label:n("trajectory")}),o.addInput(e.freespace,"visible",{label:n("freespaceSub")}),o.addInput(e.radar,"visible",{label:n("radarDisplay")}),o=a.addFolder({title:n("map"),expanded:!1}),o.addInput(e.map,"visible",{label:n("visible")}),o.addInput(e.map,"frustumCulled",{label:n("frustumCulled")}),o.addInput(e.map,"color",{label:n("color"),options:Object.fromEntries(["height","intensity","gray"].map((e=>[n(e),e])))}),o.addInput(e.map,"step",{min:1,max:20,step:1,label:n("step")}),o.addInput(e.map,"zRange",{min:-200,max:200,step:.1,label:n("zRange")}),()=>{a.dispose()}}),[n]),u.createElement("div",{className:a,ref:r})}var uo="varying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",po="uniform vec3 color1;\nuniform vec3 color2;\n\nvarying vec2 vUv;\n\nvoid main() {\n  \n  float h = vUv[1];\n  gl_FragColor = vec4(mix(color1, color2, vUv.y), 1.0-h);\n  // if(h > 0.5)\n  //     gl_FragColor = vec4(mix(color1, color2, vUv.y), 1.0-(h-0.5)*2.0);\n  // else\n  //     gl_FragColor = vec4(mix(color1, color2, vUv.y), h*2.0);\n}";const fo={color1:{value:new nt("white")},color2:{value:new nt("black")}},go=new Re({color:0,transparent:!0,opacity:.8,side:at}),ho=new Re({color:3421236,transparent:!0,opacity:.8,side:at});function Eo({roi:e,inside:t=!0,visible:n=!0}){const a=m.exports.useRef(),r=m.exports.useRef(),o=m.exports.useRef(),l=u.createElement("group",{visible:n},u.createElement("mesh",{ref:o}),u.createElement("mesh",{ref:a},u.createElement("bufferGeometry",null),u.createElement("shaderMaterial",i({},{uniforms:fo,vertexShader:uo,fragmentShader:po,transparent:!0,opacity:.4,side:rt,renderOrder:0}))),u.createElement("mesh",{ref:r},u.createElement("bufferGeometry",null),u.createElement("shaderMaterial",i({},{uniforms:fo,vertexShader:uo,fragmentShader:po,transparent:!0,opacity:.4,side:ot,renderOrder:1})))),{scene:s}=Fe();return m.exports.useEffect((()=>{if(!n)return void(s.background=new nt(0));const l=e;let i=[],c=[],m=[];if(l.length>0){for(const e of l)i=i.concat([e.x,e.y,0]),i=i.concat([e.x,e.y,1]),c=c.concat([0,0]),c=c.concat([0,1]),m.push(new Te(e.x,e.y));i=i.concat([l[0].x,l[0].y,0]),i=i.concat([l[0].x,l[0].y,1]),c=c.concat([0,0]),c=c.concat([0,1])}for(let e of[a,r])if(e.current){e.current.geometry.setAttribute("position",new qe(new Float32Array(i),3)),e.current.geometry.setAttribute("uv",new qe(new Float32Array(c),2));let t=[];for(let e=0;e<l.length;e++){let n=2*e;t=t.concat([n,n+1,n+2,n+2,n+1,n+3])}e.current.geometry.setIndex(t)}const u=o.current;u&&(m.length>0?(u.geometry=new je(new Be(m)),u.visible=!0,t?(s.background=new nt(3421236),u.material=go):(s.background=new nt(0),u.material=ho)):(u.visible=!1,s.background=new nt(0)))}),[n,e,t]),l}function vo({imageData:e,onLoad:t}){const n=Object.keys(e).length;var a=document.getElementsByClassName("MuiToolbar-root")[0];const r=a?a.offsetHeight:0,o=Math.max(100,Math.min(280,(window.innerHeight-r)/n));return u.createElement("div",{className:"container"},Object.keys(e).sort().map(((a,r)=>u.createElement("div",{style:{position:"absolute",left:0,top:o*r}},u.createElement(xo,{key:a,name:a,imageData:e[a],onLoad:t,numCamera:n})))))}function xo({name:e="",imageData:t,onLoad:n,numCamera:a=1}){const r=m.exports.useRef(null),o=m.exports.useRef({lock:!1}),[l,i,s]=Bn();m.exports.useEffect((()=>{if(!t)return;if(o.current.lock)return;if(!r.current)return;o.current.lock=!0;var e=document.getElementsByClassName("MuiToolbar-root")[0];const l=e?e.offsetHeight:0,i=Math.max(100,Math.min(280,(window.innerHeight-l)/a)),s=r.current.naturalWidth/r.current.naturalHeight*i;h(s),v(i);const c=new Blob([t.buffer],{type:"application/octet-stream"}),m=URL.createObjectURL(c);r.current.src=m,r.current.onload=()=>{URL.revokeObjectURL(m),o.current.lock=!1,n&&n()}}),[t]);const[c,p]=m.exports.useState(!1),[d,f]=m.exports.useState(1),[g,h]=m.exports.useState(0),[E,v]=m.exports.useState(0),[x,b]=m.exports.useState(!1);return u.createElement(u.Fragment,null,l,u.createElement(lt,null,u.createElement("img",{draggable:"false",style:{width:(c?2:1)*g*d,height:(c?2:1)*E*d,position:"fixed"},className:x?"maxIndex":void 0,ref:r,onMouseMove:t=>{i(t,e,{anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}}),b(!0)},onWheel:e=>{f(Math.min(3,Math.max(.5,d+-.001*e.deltaY)))},onMouseLeave:e=>{s(),b(!1)},onDoubleClick:e=>{c||Math.abs(d-1)>1e-4?(f(1),p(!1)):p(!c)}})))}const bo=m.exports.forwardRef((function(e,t){return m.exports.createElement(it,i({elevation:6,ref:t,variant:"filled"},e))}));function yo(){const[e,t]=m.exports.useState(!1),[n,a]=m.exports.useState(""),[r,o]=m.exports.useState();return[m.exports.createElement(z,{open:e,autoHideDuration:r,onClose:()=>{t(!1)},anchorOrigin:{vertical:"top",horizontal:"center"}},m.exports.createElement(bo,{onClose:()=>{t(!1)},severity:"success",sx:{width:"100%"}},n)),(e,n=2e3)=>{t(!0),a(e),o(n)}]}const wo=X({root:{height:6},thumb:{height:16,width:16,backgroundColor:"#fff",border:"3px solid currentColor","&:focus, &:hover, &$active":{boxShadow:"inherit"}},active:{},track:{height:8,borderRadius:4},rail:{height:8,borderRadius:4}})(st),Co=E((e=>Ce({container:{display:"flex",flexWrap:"wrap",minWidth:300,maxWidth:500,maxHeight:500}})));function So({className:e,currentFile:t,pause:n,setPause:a,onPlay:r}){const{t:o}=v(),[l,i]=m.exports.useState(!1),[s,c]=yo(),{data:p,loading:d,error:f}=U(ca,{pollingInterval:200}),g=Co(),[E,x]=m.exports.useState(!1),[b,y]=m.exports.useState(!1),[w,C]=m.exports.useState(!1),[S,k]=m.exports.useState(0),[N,P]=m.exports.useState(!1),[z,F]=m.exports.useState({}),[O,D]=m.exports.useState(void 0),[T,j]=m.exports.useState(1),B=function(){const[e,t]=m.exports.useState(!1);return m.exports.useEffect((()=>{const e=e=>{"ArrowLeft"!==e.key&&"a"!==e.key||t(!0)},n=e=>{"ArrowLeft"!==e.key&&"a"!==e.key||t(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",n),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",n)}}),[]),e}(),V=function(){const[e,t]=m.exports.useState(!1);return m.exports.useEffect((()=>{const e=e=>{"ArrowRight"!==e.key&&"d"!==e.key||t(!0)},n=e=>{"ArrowRight"!==e.key&&"d"!==e.key||t(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",n),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",n)}}),[]),e}();let H=u.useMemo((()=>s),[s,c]);m.exports.useEffect((()=>{B&&fa(-1).then((e=>{const t=e.split("/");c(o("playbackPosition")+": "+t[t.length-1])})),V&&fa(1).then((e=>{const t=e.split("/");c(o("playbackPosition")+": "+t[t.length-1])}))}),[B,V]);const[q,$]=m.exports.useState(null),W=e=>{j(e),da(e),$(null)};m.exports.useEffect((()=>{p&&!w&&k(p.percent),p||k(0)}),[p]),m.exports.useEffect((()=>{n?ua():ma()}),[n]),m.exports.useEffect((()=>{da(1),ga().then((e=>{F(e),Object.keys(e).map((n=>{e[n][0]==t&&D(n)}))}))}),[]);if(b&&N&&O){const e=document.getElementById("select_file_item"),t=document.getElementById("files_div");e&&t&&(t.scrollTop=Math.max(0,e.offsetTop-300),y(!1))}const Y=e=>{e&&O&&(i(!0),Ea(z[O][0]).then((()=>{r&&r()})).finally((()=>{i(!1)}))),P(!1)};return u.createElement(u.Fragment,null,l&&u.createElement(Da,null),H,u.createElement("div",{className:e},u.createElement(_,{open:N,onClose:()=>Y(!1)},u.createElement(ct,null,o("selectFile")),u.createElement(L,{id:"files_div"},u.createElement("div",{className:g.container},Object.keys(z).map((e=>{let t=z[e][0].split("/"),n=z[e][1];return u.createElement(mt,{key:e,button:!0,onClick:()=>D(e),onDoubleClick:()=>{return D(t=e),i(!0),Ea(z[t][0]).then((()=>{r&&r()})).finally((()=>{i(!1)})),void P(!1);var t},selected:O==e,id:O==e?"select_file_item":void 0},u.createElement(ut,null,u.createElement(pt,null)),u.createElement(dt,{primary:t[t.length-1],secondary:n.toString()+" Files"}))})))),u.createElement(A,null,u.createElement(h,{onClick:()=>Y(!1),color:"primary"},o("no")),u.createElement(h,{onClick:()=>Y(!0),color:"primary"},o("yes")))),u.createElement(G,{onMouseEnter:()=>{x(!0)},onMouseLeave:()=>{x(!1)},square:!1,elevation:1,style:E?{margin:"0px",width:"800px",padding:"4px",backgroundColor:"rgba(255, 255, 255, 0.8)"}:{margin:"0px",width:"800px",padding:"4px",backgroundColor:"rgba(255, 255, 255, 0.5)"}},u.createElement(re,{spacing:0,container:!0,style:{marginTop:"0rem"}},u.createElement(h,{style:{left:"0px"},size:"small",color:"primary",onClick:()=>{ga().then((e=>{F(e)})),P(!0),y(!0)},onKeyDown:e=>{e.preventDefault()},onKeyUp:e=>{e.preventDefault()}},u.createElement(ft,{style:{fontSize:30}})),u.createElement(h,{style:{left:"-10px"},size:"small",color:"primary",onClick:()=>{a(!n)}},n?u.createElement(gt,{style:{fontSize:30}}):u.createElement(ht,{style:{fontSize:30}})),u.createElement("div",null,u.createElement(h,{style:{left:"-10px"},color:"primary",onClick:e=>{$(e.currentTarget)}},T.toFixed(1)+o("playbackRate")),u.createElement(M,{anchorEl:q,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},open:Boolean(q),onClose:()=>{$(null)}},u.createElement(I,{onClick:()=>W(8)},"8.0"+o("playbackRate")),u.createElement(I,{onClick:()=>W(4)},"4.0"+o("playbackRate")),u.createElement(I,{onClick:()=>W(2)},"2.0"+o("playbackRate")),u.createElement(I,{onClick:()=>W(1)},"1.0"+o("playbackRate")),u.createElement(I,{onClick:()=>W(.5)},"0.5"+o("playbackRate")),u.createElement(I,{onClick:()=>W(.2)},"0.2"+o("playbackRate")))),u.createElement(re,{xs:9,item:!0},u.createElement(re,{spacing:0,direction:"row",container:!0,style:{marginTop:"0rem"}},u.createElement(re,{xs:1,item:!0,style:{marginRight:"1rem"}},u.createElement(R,null,p?p.now_time:"00:00")),u.createElement(re,{xs:9,item:!0},u.createElement(wo,{onChange:(e,t)=>{C(!0),k(t),pa(t).then((e=>{const t=e.split("/");c(o("playbackPosition")+": "+t[t.length-1])}))},onChangeCommitted:(e,t)=>{k(t),pa(t).then((e=>{C(!1);const t=e.split("/");c(o("playbackPosition")+": "+t[t.length-1])}))},color:"primary",defaultValue:0,step:.001,value:S,style:{padding:"0rem",marginBottom:"0.1rem"}})),u.createElement(re,{xs:1,item:!0},u.createElement(R,{style:{marginLeft:"1rem"}},p?p.left_time:"00:00"))))))))}const ko=X({root:{height:0},thumb:{height:0,width:0},active:{},track:{height:14,borderRadius:6,backgroundColor:"#fff"},rail:{height:14,borderRadius:6,backgroundColor:"#888"}})(st),Mo=E((e=>({backdrop:{zIndex:e.zIndex.appBar},paper:{position:"absolute",width:600,backgroundColor:"#0000",opacity:1},root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}})));function Io(){return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}function No({setShowMapSaving:e,setPause:t}){const n=Mo(),[a]=u.useState(Io),[r,o]=u.useState(0);return U(ia,{pollingInterval:200,loadingDelay:1e3,onSuccess:n=>{let a=parseFloat(n);a>=100?(t(!1),e(!1)):o(a)},onError:()=>{t(!1),e(!1)}}),u.createElement(j,{open:!0,className:n.backdrop},u.createElement("div",{style:a,className:n.paper},u.createElement("div",{className:n.root},u.createElement(ko,{color:"primary",defaultValue:0,step:.1,value:r}))))}function Po({onClick:e,disable:t,children:n}){return u.createElement(S,{position:"fixed",bottom:"2rem",right:"1rem"},u.createElement(xe,{color:"primary",size:"small",onClick:e,disabled:t},n))}function Ro(e,t){if(null==e||null==e)return"NaN";return e.toFixed(t).padStart(5,"0")}var _o,Lo;(Lo=_o||(_o={}))[Lo.BEGIN=0]="BEGIN",Lo[Lo.CALIB_GROUND=1]="CALIB_GROUND",Lo[Lo.CALIB_POSITION=2]="CALIB_POSITION",Lo[Lo.FINETUNE=3]="FINETUNE",Lo[Lo.RECALIB=4]="RECALIB";const Ao=["stepNameSelectLidar","stepNameCalibGroud","stepNameCalibFront","stepNameFinetune"],zo=["helpMsgSelectLidar","helpMsgCalibGroud","helpMsgCalibFront","helpMsgFinetune"],Fo=E((e=>({container:{paddingBottom:"0.5rem",padding:"2rem",marginTop:"-1rem",marginLeft:"1rem",marginRight:"1rem",borderRadius:"0.5rem"}})));var Oo=m.exports.memo((function({activeStep:e,setActiveStep:t,children:n,onNext:a,t:r=(e=>e||""),calibEnable:o}){const[l,s]=m.exports.useState({}),[c,p]=m.exports.useState(!1),d=e=>{s(fe((t=>{for(let n=0;n<Ao.length;n++)t[n]=n<e}))),t(e)};m.exports.useEffect((()=>{d(e)}),[e]);const f=Fo();return u.createElement(G,{className:f.container},u.createElement(xt,{nonLinear:!0,activeStep:e},Ao.map(((t,n)=>u.createElement(bt,{key:t,completed:l[n]},u.createElement(yt,i({onClick:()=>d(n)},(t=>e===t&&c?{icon:u.createElement(B,{size:"1.5rem"})}:{})(n)),r(t)))))),u.createElement(S,{px:"2rem",display:"flex",alignItems:"center",style:{whiteSpace:"pre-wrap",marginTop:"1rem"}},u.createElement(R,{variant:"body1"},r(zo[e])),u.createElement("span",null," "),n),u.createElement(S,{px:"1rem",display:"flex"},0===e?void 0:u.createElement(h,{color:"primary",onClick:()=>{d(e-1)}},r("previous")),u.createElement(S,{flexGrow:1}),u.createElement(S,null,e>=Ao.length||u.createElement(h,{color:"primary",onClick:()=>{d(e+1)}},r("skip")),u.createElement(h,{variant:"contained",color:"primary",disabled:!o,onClick:e<Ao.length?async()=>{p(!0),a&&await a(),d(e+1),p(!1)}:()=>{d(0)},onKeyDown:e=>{e.preventDefault()},onKeyUp:e=>{e.preventDefault()}},e==Ao.length-1?r("calibFinish"):e<Ao.length?r("next"):r("resetCalibration")))))}));function Do({lidarArray:e,lidarIndex:t,setLidarIndex:n,activeStep:a,setActiveStep:r}){return u.createElement(ie,{variant:"standard",value:void 0===t?"":t,onChange:e=>{""===e.target.value?n(void 0):(n(e.target.value),a===_o.BEGIN&&r(a+1))},onFocus:e=>{e.target.blur()}},u.createElement(I,{value:"",key:""},u.createElement("em",null,"None")),e.map(((e,t)=>{const n=`${e.name}:${e.port}`;return u.createElement(I,{value:t,key:t},n)})))}function To({lidarArray:e,lidarIndex:t,setLidarIndex:n,activeStep:a,setActiveStep:r}){return u.createElement(ie,{multiple:!0,value:t,onChange:e=>{n(e.target.value)},variant:"standard",renderValue:t=>{let n="";for(let a=0;a<t.length;a++)n=n+e[t[a]].name+":"+e[t[a]].port.toString(),a!=t.length-1&&(n+=", ");return n}},e.map(((e,n)=>{const a=`${e.name}:${e.port}`;return u.createElement(I,{value:n,key:n},u.createElement(wt,{color:"primary",checked:t.indexOf(n)>-1}),u.createElement(dt,{primary:a}))})))}const jo={axis:{size:2,visible:!0},polarGrid:{visible:!0,radius:50,radials:16,circles:5,divisions:64,color:2236962},grid:{visible:!1,size:100,divisions:20,color:2236962},camera:{type:Ar.NORMAL}};function Bo({config:e=jo}){const t=new Le(...new Array(3).fill(e?e.axis.size:1));return u.createElement(u.Fragment,null,u.createElement("axesHelper",s(i({},e&&e.axis),{scale:t,"material-linewidth":2})),!e.polarGrid.visible||u.createElement("polarGridHelper",{args:[e.polarGrid.radius,e.polarGrid.radials,e.polarGrid.circles,e.polarGrid.divisions,e.polarGrid.color,e.polarGrid.color],visible:e.polarGrid.visible,"rotation-x":Math.PI/2}),!e.grid.visible||u.createElement("gridHelper",{args:[e.grid.size,e.grid.divisions,e.grid.color,e.grid.color],visible:e.grid.visible,"rotation-x":Math.PI/2}),u.createElement(zr,i({},e&&e.camera)))}var Uo=u.forwardRef((function({points:e,lidarIndex:t,setCalibEnable:n,disable:a},r){const[o,l]=m.exports.useState([]);m.exports.useImperativeHandle(r,(()=>({calibrate:async()=>void 0!==t&&e?await async function({points:e,contour:t,key:n}){const a={method:"calibrate_ground",params:{points:Ca(e.buffer),contour:t,key:n},jsonrpc:2,id:0};return ka((await ea.post("api/",a)).data.result)}({points:e,contour:o.map((e=>[e.x,e.y])),key:t}):(new O).identity()})));const[i,s]=m.exports.useState("idle");m.exports.useEffect((()=>{a?l([]):s("drawing")}),[a]),m.exports.useEffect((()=>{r?void 0===t||!e||o.length<3||"idle"!=i?n(!1):n(!0):n(null!=t)}),[r,t,o,i]);const c=JSON.parse(JSON.stringify(jo));c.polarGrid.visible=!1,c.grid.visible=!0,c.camera.type=Ar.UP;const p=so(),d=m.exports.useRef();let f=u.createElement(eo,{enabled:p&&"idle"===i,menuItems:{redraw:()=>{var e;null==(e=d.current)||e.start(),l([])}},onStart:p?()=>{var e;return null==(e=d.current)?void 0:e.stop()}:void 0});return u.createElement("div",{className:"calibration-tab"},u.createElement(Je,{onCreated:()=>{var e;null==(e=d.current)||e.start()}},u.createElement(Bo,{config:c}),u.createElement(qr,{points:e,color:"height",size:1.5}),!a&&u.createElement(Jr,{ref:d,enabled:p,roi:o,state:i,onChange:l,onStart:()=>s("drawing"),onEnd:e=>{s(e)}})),!a&&f)}));function Go(e){const{children:t,open:n,value:a}=e;return u.createElement(St,{open:n,enterTouchDelay:0,placement:"top",title:a},t)}function Vo({label:e,value:t,onChange:n,min:a,max:r,step:o}){const l=m.exports.useRef();return u.createElement(u.Fragment,null,u.createElement(R,{style:{width:"2.8rem",cursor:"pointer"},onClick:()=>{l.current.getElementsByClassName("MuiSlider-thumb")[0].focus()}},e),u.createElement("div",{style:{flexGrow:1.5}},u.createElement(st,{ref:l,components:{ValueLabel:Go},size:"small",valueLabelDisplay:"auto","aria-label":"x",value:t,onChange:n,min:a,max:r,step:o})))}function Ho({rotation:e,translation:t,setRotation:n,setTranslation:a}){return u.createElement(u.Fragment,null,["X","Y","Z"].map(((e,n)=>u.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:"0.1rem"}},u.createElement(Vo,i({},{label:e,value:t[n],onChange:(e,t)=>{a(fe((e=>{e[n]=t})))},min:-5,max:5,step:.01}))))),["Roll","Pitch","Yaw"].map(((t,a)=>u.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:"0.1rem"}},u.createElement(Vo,i({},{label:t,value:e[a],onChange:(e,t)=>{n(fe((e=>{e[a]=t})))},min:-30,max:30,step:.05}))))))}function qo({excludeConfig:e,setExcludeConfig:t}){const n=[0,3,1,4,2,5];return u.createElement(u.Fragment,null,["Xmin","Xmax","Ymin","Ymax","Zmin","Zmax"].map(((a,r)=>u.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:"0.1rem"}},u.createElement(Vo,i({},{label:a,value:e[n[r]],onChange:(a,o)=>{e[n[r]]=o,t([...e])},min:-5,max:5,step:.01}))))))}Go.propTypes={children:Ct.element.isRequired,open:Ct.bool.isRequired,value:Ct.number.isRequired};function $o(e){const t=e.slice();return t[0]=e[0]/180*Math.PI,t[1]=e[1]/180*Math.PI,t[2]=e[2]/180*Math.PI,t}var Wo=u.forwardRef((function({pointsArray:e,targetLidarIndex:t,referenceLidarIndex:n,setCalibEnable:a},r){const[o,l]=m.exports.useState([0,0,0,0,0,0]),[s,c]=m.exports.useState([0,0,0,"XYZ"]),[p,d]=m.exports.useState([0,0,0]),[f,g]=m.exports.useState();m.exports.useEffect((()=>{aa().then((e=>{if(null==e.lidar[0].exclude)for(var n=0;n<=e.lidar.length;n++)null!=e.lidar[n]&&(e.lidar[n].exclude=[0,0,0,0,0,0]);g(e),l(null!=t?e.lidar[t].exclude:[0,0,0,0,0,0])}))}),[]),m.exports.useEffect((()=>{a(null!=t),null!=t&&null!=f&&null!=f.lidar[t].exclude?l(f.lidar[t].exclude):l([0,0,0,0,0,0])}),[t]);const h=JSON.parse(JSON.stringify(jo));return h.polarGrid.visible=!1,h.grid.visible=!0,h.grid.divisions=50,h.camera.type=Ar.ORTHOGRAPHIC,m.exports.useImperativeHandle(r,(()=>({calibrate:async()=>{let e=new O;const n=new Xe,a=s.slice();a[0]=a[0]*Math.PI/180,a[1]=a[1]*Math.PI/180,a[2]=a[2]*Math.PI/180,n.fromArray(a),e.makeRotationFromEuler(n),e.setPosition(...p);const r=e.transpose().toArray();if(void 0===t)throw new Error("No target lidar index!");if(void 0===f)throw new Error("No config obtained!");f.lidar[t].exclude=o,g(i({},f));try{await ra(f),e=await async function({transform:e,lidarIndex:t}){const n={method:"finetune_lidar",params:{transform:e,lidarIndex:t},jsonrpc:2,id:0};return ka((await ea.post("api/",n)).data.result)}({lidarIndex:t,transform:r})}catch(l){console.log(l)}return d([0,0,0]),c([0,0,0,"XYZ"]),e}}))),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab"},u.createElement(Je,{orthographic:!0,style:{position:"absolute"}},u.createElement(Bo,{config:h}),u.createElement(qr,{size:2,points:void 0!==t?e[t]:void 0,pointsProps:{position:p,rotation:$o(s)},color:"height"}),n.map(((t,n)=>u.createElement(qr,{size:2.5,points:void 0!==t?e[t]:void 0}))),u.createElement(Ir,i({},{excludeConfig:o})))),u.createElement("div",{className:"finetune-panel"},u.createElement(Ie,{defaultExpanded:!0,style:{marginBottom:"1px"}},u.createElement(kt,{expandIcon:u.createElement(Mt,null),id:"finetune-panel0-header"}),u.createElement(Ne,{style:{paddingTop:"0px"}},u.createElement("div",null,u.createElement(Ho,i({},{translation:p,rotation:s,setTranslation:d,setRotation:c}))))),u.createElement(Ie,{style:{marginTop:"1px"}},u.createElement(kt,{expandIcon:u.createElement(Mt,null),id:"finetune-panel1-header"}),u.createElement(Ne,{style:{paddingTop:"0px"}},u.createElement("div",null,u.createElement(qo,i({},{excludeConfig:o,setExcludeConfig:l})))))))}));function Yo({maxNum:e=1e6,points:t,onPointsUpdate:n,color:a="gray",pick:r=!0,remove:o=!1,pointsPicked:l=[],onAdd:i,onRemove:s}){const[c]=m.exports.useState(new Array(10).fill(0).map(((e,t)=>document.createElement("canvas"))));return m.exports.useEffect((()=>{c.forEach(((e,t)=>{const n=e.getContext("2d");e.width=320,e.height=32,n&&(n.fillStyle="rgba(240, 0, 0, 1.0)",n.font="Bold 32px Arial",n.fillText(t+1+"",0,32))}))}),[]),u.createElement("group",null,u.createElement(qr,{maxNum:e,points:t,onPointsUpdate:n,color:a,size:2,pointsProps:{onClick:e=>{e.stopPropagation();const n=e.intersections;if(n.length>0&&t){let e=0,l=n[0].distanceToRay;for(let t=0;t<n.length;t++){const a=n[t];l&&a&&a.distanceToRay&&l>a.distanceToRay&&(l=n[t].distanceToRay,e=t)}let s=new Le,c=n[e];t&&e&&c&&c.index&&(s.setX(t[4*c.index]),s.setY(t[4*c.index+1]),s.setZ(t[4*c.index+2]),a=s,r&&!o&&i&&i(a))}var a}}}),l.map(((e,t)=>u.createElement("group",{position:[e.x,e.y,e.z],key:t,onClick:()=>{return e=t,void(o&&r&&s&&s(e));var e}},u.createElement("mesh",null,u.createElement("sphereGeometry",{args:[.08,32,32]}),u.createElement("meshBasicMaterial",{color:16777215})),u.createElement("sprite",{"position-z":.1,scale:[.5,.05,1],center:[0,0]},u.createElement("spriteMaterial",{sizeAttenuation:!1,depthTest:!1},u.createElement("canvasTexture",{attach:"map",args:[c[t]]})))))))}const Xo=E((e=>({header:{marginBottom:"0.5rem"},container:{marginTop:"0rem",fontSize:"14px"}})));var Ko=m.exports.memo((function({source:e=[],target:t=[],isLocal:n,onChange:a}){const{t:r}=v(),o=(n,r,o)=>{let l=0;if(null!=o)l=o;else{const e=document.getElementById("DD"+n.toString()+"-"+r.toString()),t=document.getElementById("MM"+n.toString()+"-"+r.toString()),a=document.getElementById("SS"+n.toString()+"-"+r.toString());e&&t&&a&&(i=parseFloat(e.value),s=parseFloat(t.value),c=parseFloat(a.value),l=(isNaN(i)?0:i)+(isNaN(s)?0:s)/60+(isNaN(c)?0:c)/3600,console.log("gps coordinate:",l))}var i,s,c;a&&a(e,fe(t,(e=>{e[n][r]=l})))},l=r=>{(n||0!=r)&&a&&a(fe(e,(e=>{e.splice(r,1)})),fe(t,(e=>{e.splice(r,1)})))},i=Xo();let s=[];for(let c=0;c<Math.min(e.length,t.length);c++)s.push(u.createElement(re,{container:!0,spacing:1,className:i.container},u.createElement(re,{item:!0,md:!0,style:{marginLeft:"1.5rem",marginTop:"0rem"}},u.createElement(R,{variant:"subtitle1"},c+1)),u.createElement(re,{item:!0,md:!0},u.createElement(It,{value:e[c].x.toFixed(2),disabled:!0})),u.createElement(re,{item:!0,md:!0},u.createElement(It,{value:e[c].y.toFixed(2),disabled:!0})),u.createElement(re,{item:!0,md:!0},n?u.createElement(It,{type:"number",defaultValue:t[c][0].toFixed(2),onChange:e=>{o(c,0,Number(e.target.value))}}):u.createElement(u.Fragment,null,u.createElement(It,{id:"DD"+c.toString()+"-0",type:"number",margin:"dense",endAdornment:u.createElement(ce,{position:"end"},"°"),onChange:e=>{o(c,0,void 0)}}),u.createElement(It,{id:"MM"+c.toString()+"-0",type:"number",margin:"dense",endAdornment:u.createElement(ce,{position:"end"},"′"),onChange:e=>{o(c,0,void 0)}}),u.createElement(It,{id:"SS"+c.toString()+"-0",type:"number",margin:"dense",endAdornment:u.createElement(ce,{position:"end"},"″"),onChange:e=>{o(c,0,void 0)}}))),u.createElement(re,{item:!0,md:!0},n?u.createElement(It,{type:"number",defaultValue:t[c][1].toFixed(2),onChange:e=>{o(c,1,Number(e.target.value))}}):u.createElement(u.Fragment,null,u.createElement(It,{id:"DD"+c.toString()+"-1",type:"number",margin:"dense",endAdornment:u.createElement(ce,{position:"end"},"°"),onChange:e=>{o(c,1,void 0)}}),u.createElement(It,{id:"MM"+c.toString()+"-1",type:"number",margin:"dense",endAdornment:u.createElement(ce,{position:"end"},"′"),onChange:e=>{o(c,1,void 0)}}),u.createElement(It,{id:"SS"+c.toString()+"-1",type:"number",margin:"dense",endAdornment:u.createElement(ce,{position:"end"},"″"),onChange:e=>{o(c,1,void 0)}}))),u.createElement(re,{item:!0,md:!0,container:!0,justifyContent:"center",style:{marginTop:"0rem"}},u.createElement(Nt,{size:"small",onClick:()=>l(c)},u.createElement(Pt,{fontSize:"small"})))));return u.createElement(G,{className:i.container,style:{paddingBottom:"0.5rem"}},u.createElement(re,{container:!0,spacing:1,className:s.length>0?i.header:""},u.createElement(re,{item:!0,md:!0,style:{marginLeft:"1rem"}},r("index")),u.createElement(re,{item:!0,md:!0,style:{marginLeft:"2.5rem"}},r("xLidar")),u.createElement(re,{item:!0,md:!0},r("yLidar")),u.createElement(re,{item:!0,md:!0},r(n?"xCar":"LatCar")),u.createElement(re,{item:!0,md:!0},r(n?"yCar":"LonCar")),u.createElement(re,{item:!0,md:!0},r("action"))),s.length>0?u.createElement(Rt,null):null,s)}));var Zo=u.forwardRef((function({points:e,lidarIndex:t,coordinate:n,setCalibEnable:a},r){const[o,l]=m.exports.useState([]),[s,c]=m.exports.useState([]),p=JSON.parse(JSON.stringify(jo));p.polarGrid.visible=!1,p.grid.visible=!0,m.exports.useImperativeHandle(r,(()=>({calibrate:async()=>{if(void 0===t||o.length<2)return(new O).identity();let e=o.map((e=>[e.x,e.y])),a=[...s],r=[0,0];if("Global"==n){for(let e=1;e<a.length;e++)a[e]=await ya(a[0][0],a[0][1],a[e][0],a[e][1]);r=a[0],e=e.slice(1),a=a.slice(1)}return await async function({source:e,target:t,anchor:n,key:a}){const r={method:"calibrate_heading",params:{source:e,target:t,anchor:n,key:a},jsonrpc:2,id:0};return ka((await ea.post("api/",r)).data.result)}({source:e,target:a,anchor:r,key:t})}}))),m.exports.useEffect((()=>{"Global"==n&&o.length<=0&&(l([new Le(0,0,0)]),c([[0,0]]));let e="Local"==n?2:3;if(void 0===t||o.length<e)a(!1);else if("Local"==n)a(!0);else{let e=!0;for(let t=0;t<s.length;t++)if(null==s[t][0]||null==s[t][1]){e=!1;break}a(e)}}),[t,o,s]),m.exports.useEffect((()=>{"Local"==n?(l([]),c([])):(l([new Le(0,0,0)]),c([[0,0]]))}),[n]);const d=so(),f=co();return u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab"},u.createElement(Je,{raycaster:{params:{Points:{threshold:1}}}},u.createElement(Bo,{config:p}),u.createElement(Yo,i({},{points:e,color:"height",pick:d,remove:f,pointsPicked:o,onAdd:e=>{c("Local"==n?t=>[...t,[e.x,e.y]]:e=>[...e,[void 0,void 0]]),l((t=>[...t,e]))},onRemove:e=>{l(fe((t=>{t.splice(e,1)}))),c(fe((t=>{t.splice(e,1)})))}})))),u.createElement("div",{className:"form-panel"},u.createElement(Ko,{source:o,target:s,isLocal:"Local"==n,onChange:m.exports.useCallback(((e,t)=>{l(e),c(t)}),[l,c])})))}));var Jo=u.forwardRef((function({points:e,imageUrl:t,images:n,cameraName:a,timestamp:r,paused:o,setCalibEnable:l},s){const[c,p]=m.exports.useState([]),[d,f]=m.exports.useState([]),[g,h]=m.exports.useState(0),[E,v]=m.exports.useState([]),[x,b]=m.exports.useState([]),[y,w]=m.exports.useState([]),[C,S]=m.exports.useState([]),k=so(),M=co();m.exports.useImperativeHandle(s,(()=>({calibrate:async()=>{let e=[],t=[];for(var n=0;n<y.length;n++)e=[...e,...E[n]],t=[...t,...x[n]];if(console.log(e,t,a),a)return await async function({pointsLidar:e,pointsCamera:t,cameraName:n}){const a={method:"calibrate_lidar_camera",params:{pointsLidar:e.map((e=>[e.x,e.y,e.z])),pointsCamera:t.map((e=>[e.x,e.y])),cameraName:n},jsonrpc:2,id:0};return ka((await ea.post("api/",a)).data.result)}({pointsLidar:e,pointsCamera:t,cameraName:a})}}))),m.exports.useEffect((()=>{if(o){if(e&&n&&a){const r=new Blob([n[a].buffer],{type:"application/octet-stream"});var t=URL.createObjectURL(r);p([]),f([]),v((e=>[[],...e||[]])),b((e=>[[],...e||[]])),w((t=>[e,...t||[]])),S((e=>[t,...e||[]])),h(0)}}else for(var r=0;r<y.length;)E[r].length<=0&&x[r].length<=0?(y.splice(r,1),C.splice(r,1),w(y),S(C),E.splice(r,1),x.splice(r,1),v(E),b(x)):r++}),[o]),m.exports.useEffect((()=>{if(s){for(var e=0;e<y.length;e++)if(E[e].length!=x[e].length)return void l(!1);let t=[],n=[];for(e=0;e<y.length;e++)t=[...t,...E[e]],n=[...n,...x[e]];t.length>=4?l(!0):l(!1)}else l(a)}),[s,a,c,d]);let I=u.createElement(eo,{enabled:k&&o,menuItems:{previousFrame:()=>{g<y.length-1&&(p(E[g+1]),f(x[g+1]),h(g+1))},nextFrame:()=>{g>0&&(p(E[g-1]),f(x[g-1]),h(g-1))},clearPoints:()=>{p([]),f([]),E[g]=[],x[g]=[],v(E),b(x)}},onStart:void 0});return u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},u.createElement("div",{style:{width:"50%",borderRight:"2px solid",borderRightColor:"#ffffff"}},u.createElement(Je,{raycaster:{params:{Points:{threshold:1}}}},u.createElement(zr,null),u.createElement(Yo,i({},{maxNum:1e6,points:o?y[g]:e,onPointsUpdate:()=>{_t.debug(`rendered pointcloud of ${r} at ${performance.now()}`)},color:"height",pick:k&&o,remove:M,pointsPicked:o?c:[],onAdd:e=>{p([...c,e]),E[g]=[...c,e],v(E)},onRemove:e=>{c.splice(e,1),E[g].splice(e,1),p(c),v(E)}})))),u.createElement("div",{style:{flexGrow:1}},u.createElement(Je,null,u.createElement(zr,{type:Ar.IMAGE,height:1.2}),u.createElement(Tr,i({src:o?C[g]:t,onTextureLoad:()=>{_t.debug(`rendered image of ${r} at ${performance.now()}`)}},{pointsPicked:o?d:[],onChange:e=>{f(e),x[g]=e,b(x)},enabled:k&&o,removing:M}))),I))}));const Qo=E((e=>({container:{paddingBottom:"0.5rem",padding:"2rem",marginTop:"-1rem",marginLeft:"1rem",marginRight:"1rem",borderRadius:"0.5rem"}})));var el;!function(e){e[e.BEGIN=0]="BEGIN",e[e.CALIB_LIDAR_CAMERA=1]="CALIB_LIDAR_CAMERA",e[e.FINETUNE=2]="FINETUNE",e[e.CHECK=3]="CHECK"}(el||(el={}));const tl=["stepNameSelectCamera","stepNameCalibLidarAndCamera","stepNameFinetune","stepNameCheck"],nl=["helpMsgSelectCamera","helpMsgCalibLidarAndCamera","helpMsgFinetune","helpMsgCheck"];var al=m.exports.memo((function({activeStep:e,setActiveStep:t,children:n,onNext:a,t:r=(e=>e||""),calibEnable:o}){const[l,s]=m.exports.useState({}),[c,p]=m.exports.useState(!1),d=e=>{s(fe((t=>{for(let n=0;n<tl.length;n++)t[n]=n<e}))),e<tl.length&&t(e)};m.exports.useEffect((()=>{d(e)}),[e]);const f=Qo();return u.createElement(G,{className:f.container},u.createElement(xt,{nonLinear:!0,activeStep:e},tl.map(((t,n)=>u.createElement(bt,{key:t,completed:l[n]},u.createElement(yt,i({onClick:()=>d(n)},(t=>e===t&&c?{icon:u.createElement(B,{size:"1.5rem"})}:{})(n)),r(t)))))),u.createElement(S,{px:"2rem",display:"flex",alignItems:"center",style:{whiteSpace:"pre-wrap",marginTop:"1rem"}},u.createElement(R,{variant:"body1"},r(nl[e])),u.createElement("span",null," "),n),u.createElement(S,{px:"1rem",display:"flex"},0===e||u.createElement(h,{color:"primary",onClick:()=>{d(e-1)}},r("previous")),u.createElement(S,{flexGrow:1}),u.createElement(S,null,e>=tl.length||u.createElement(h,{color:"primary",onClick:()=>{d(e+1)}},r("skip")),u.createElement(h,{variant:"contained",color:"primary",disabled:!o,onClick:e+1<tl.length?async()=>{p(!0),a&&await a(),d(e+1),p(!1)}:()=>{d(0)},onKeyDown:e=>{e.preventDefault()},onKeyUp:e=>{e.preventDefault()}},e+1<tl.length?r("next"):r("calibFinish")))))}));function rl(e){const t=e.slice();return t[0]=e[0]/180*Math.PI,t[1]=e[1]/180*Math.PI,t[2]=e[2]/180*Math.PI,t}var ol=u.forwardRef((function({points:e,imageUrl:t,cameraName:n,timestamp:a,setCalibEnable:r},o){const[l,s]=m.exports.useState();m.exports.useEffect((()=>{aa().then((e=>{console.log(e);const t={};for(let n of e.camera)t[n.name]=n;s(t)}))}),[]);const[c,p]=m.exports.useState([0,0,0,"XYZ"]),[d,f]=m.exports.useState([0,0,0]),[g,h]=m.exports.useState([0,0,0,"XYZ"]),[E,v]=m.exports.useState([0,0,0]);m.exports.useEffect((()=>{if(l&&n){wa(l[n].extrinsic_parameters).then((e=>{const t=new Le,n=new Ye,a=new Le;e.decompose(t,n,a);const r=new Xe;r.setFromQuaternion(n),console.log(t),f(t.toArray()),p(r.toArray())}))}}),[l,n]),m.exports.useEffect((()=>{r(n)}),[n]);const[x,b,y,w]=m.exports.useMemo((()=>{var e;return void 0===n||void 0===l?[600,600,320,240]:null==(e=l[n])?void 0:e.intrinsic_parameters.slice(0,4)}),[l,n]),{texture:C,width:S,height:k}=Dr(t,(()=>{_t.debug(`rendered image of ${a} at ${performance.now()}`)}));m.exports.useImperativeHandle(o,(()=>({calibrate:async()=>{let e=new O;const t=new Xe;if(t.fromArray(rl(g)),e.makeRotationFromEuler(t),e.setPosition(...E),void 0===n)throw new Error("No target lidar index!");const a=await async function({transform:e,cameraName:t}){const n={method:"finetune_camera",params:{transform:e.transpose().toArray(),cameraName:t},jsonrpc:2,id:0};return ka((await ea.post("api/",n)).data.result)}({cameraName:n,transform:e});{const e=new Le,t=new Ye,n=new Le;a.decompose(e,t,n);const r=new Xe;r.setFromQuaternion(t),f(e.toArray()),p(r.toArray())}return v([0,0,0]),h([0,0,0,"XYZ"]),a}})));const M=so();return u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab"}),u.createElement("div",{style:{position:"absolute",width:"100vw",height:"45rem"}},u.createElement(Je,{camera:{fov:60,position:[0,0,0]},onCreated:({camera:e})=>{console.log(e),e.rotateX(Math.PI)}},u.createElement("group",{position:E,rotation:rl(g)},u.createElement(qr,{size:2,maxNum:1e6,points:e,pointsProps:{position:d,rotation:c},onPointsUpdate:()=>{_t.debug(`rendered pointcloud of ${a} at ${performance.now()}`)},color:"depth"})),u.createElement("mesh",{position:[(S/2-y)/x,(k/2-w)/b,1],"rotation-x":Math.PI,scale:[S/x,k/b,1]},u.createElement("planeBufferGeometry",{args:[1,1]}),C?u.createElement("meshBasicMaterial",{map:C,side:at,opacity:M?0:1,blending:Lt}):null))),u.createElement(G,{className:"finetune-panel"},u.createElement(Ho,i({},{translation:E,setTranslation:v,rotation:g,setRotation:h}))))}));var ll=u.forwardRef((function({points:e,imageUrl:t,cameraName:n,timestamp:a,setCalibEnable:r},o){const[l,i]=m.exports.useState();m.exports.useEffect((()=>{aa().then((e=>{console.log(e);const t={};for(let n of e.camera)t[n.name]=n;i(t)}))}),[]);const[s,c]=m.exports.useState();m.exports.useEffect((()=>{if(l&&n){const e=l[n],t=new Le(e.extrinsic_parameters[0],e.extrinsic_parameters[1],e.extrinsic_parameters[2]),a=new Le(1,1,1),r=new Ye,o=new Xe(.01745329251994*e.extrinsic_parameters[3],.01745329251994*e.extrinsic_parameters[4],.01745329251994*e.extrinsic_parameters[5],"XYZ");r.setFromEuler(o),r.set(r.y,r.x,r.z,r.w);const i=new O;i.compose(t,r,a),c(i)}}),[l,n]),m.exports.useEffect((()=>{r(!0)}),[]);const[p,d,f,g]=m.exports.useMemo((()=>{var e;return void 0===n||void 0===l?[600,600,320,240]:null==(e=l[n])?void 0:e.intrinsic_parameters.slice(0,4)}),[n,l]);return u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab"},u.createElement(Je,null,u.createElement("axesHelper",null),u.createElement(zr,{type:Ar.NORMAL}),u.createElement("gridHelper",{args:[100,20,2236962,2236962],visible:!0,"rotation-x":Math.PI/2}),u.createElement(jr,{maxNum:1e6,pointsize:3,transparent:!1,points:e,imageUrl:t,cameraIntrinsic:{cx:f,cy:g,fx:p,fy:d},pointsProps:s}))))}));const il=E((e=>({container:{paddingBottom:"0.5rem",padding:"2rem",marginTop:"-1rem",marginLeft:"1rem",marginRight:"1rem",borderRadius:"0.5rem"}})));var sl;!function(e){e[e.BEGIN=0]="BEGIN",e[e.CALIB_CAMERA=1]="CALIB_CAMERA",e[e.CHECK=2]="CHECK"}(sl||(sl={}));const cl=["stepNameSelectCamera","stepNameCalibCamera","stepNameCheck"],ml=["helpMsgSelectCamera","helpMsgCalibCamera","helpMsgCalibCameraCheck"];var ul=m.exports.memo((function({activeStep:e,setActiveStep:t,children:n,onNext:a,t:r=(e=>e||""),calibEnable:o,belowComponent:l}){const[s,c]=m.exports.useState({}),[p,d]=m.exports.useState(!1),f=e=>{c(fe((t=>{for(let n=0;n<cl.length;n++)t[n]=n<e}))),e<cl.length&&t(e)};m.exports.useEffect((()=>{f(e)}),[e]);const g=il();return u.createElement(G,{className:g.container},u.createElement(xt,{nonLinear:!0,activeStep:e},cl.map(((t,n)=>u.createElement(bt,{key:t,completed:s[n]},u.createElement(yt,i({onClick:()=>f(n)},(t=>e===t&&p?{icon:u.createElement(B,{size:"1.5rem"})}:{})(n)),r(t)))))),u.createElement(S,{px:"2rem",display:"flex",alignItems:"center",style:{whiteSpace:"pre-wrap",marginTop:"1rem"}},u.createElement(R,{variant:"body1"},r(ml[e])),u.createElement("span",null," "),n),l,u.createElement(S,{px:"1rem",display:"flex"},0===e||u.createElement(h,{color:"primary",onClick:()=>{f(e-1)}},r("previous")),u.createElement(S,{flexGrow:1}),u.createElement(S,null,e>=cl.length||u.createElement(h,{color:"primary",onClick:()=>{f(e+1)}},r("skip")),u.createElement(h,{variant:"contained",color:"primary",disabled:!o,onClick:e+1<cl.length?async()=>{d(!0),a&&await a(),f(e+1),d(!1)}:()=>{f(0)},onKeyDown:e=>{e.preventDefault()},onKeyUp:e=>{e.preventDefault()}},e+1<cl.length?r("next"):r("calibFinish")))))}));const pl=E((e=>({header:{marginBottom:"0.3rem",marginTop:"0rem"},container:{padding:"0.5rem",marginTop:"0rem"}})));var dl=m.exports.memo((function({source:e=[],images:t=[],onChange:n,onDelete:a}){const{t:r}=v(),o=n=>{a&&a(n,fe(t,(e=>{e.splice(n,1)})),fe(e,(e=>{e.splice(n,1)})))},l=pl();let i=[];for(let s=0;s<e.length;s++)i.push(u.createElement(re,{container:!0,spacing:0,alignItems:"center",style:{marginTop:"0rem"}},u.createElement(re,{item:!0,md:!0,justifyContent:"center"},u.createElement(R,{style:{marginLeft:"10px"},variant:"subtitle1"},("0"+(s+1)).slice(-2))),u.createElement(re,{item:!0,md:!0},u.createElement("img",{src:t[s],width:"40",height:"30",onClick:e=>{n&&n(s)}})),u.createElement(re,{item:!0,md:!0},u.createElement(wt,{checked:e[s],color:"primary",style:{pointerEvents:"none"}})),u.createElement(re,{item:!0,md:!0,container:!0,justifyContent:"center",style:{marginTop:"0rem"}},u.createElement(Nt,{size:"small",onClick:()=>o(s)},u.createElement(Pt,{fontSize:"small"})))));return u.createElement(G,{className:l.container},u.createElement(re,{container:!0,spacing:0,className:i.length>0?l.header:"",style:{marginTop:"0rem"}},u.createElement(re,{item:!0,xs:3},r("index")),u.createElement(re,{item:!0,xs:3},r("calibPreview")),u.createElement(re,{item:!0,xs:4},r("calibStatus")),u.createElement(re,{item:!0,xs:2},r("action"))),i.length>0?u.createElement(Rt,null):null,i)}));const fl={chessboardRow:9,chessboardCol:6,chessboardSize:30};var gl=u.forwardRef((function({imageUrl:e,images:t,cameraName:n,paused:a,setCalibEnable:r,setDoDistort:o,config:l=fl},s){const[c,p]=m.exports.useState(!1),[d,f]=m.exports.useState(0),[g,h]=m.exports.useState([]),[E,v]=m.exports.useState([]),[x,b]=m.exports.useState([]);return m.exports.useEffect((()=>{o(!1)}),[]),m.exports.useImperativeHandle(s,(()=>({calibrate:async()=>{if(n)return await async function({pointsCamera:e,cameraName:t,config:n}){const a={method:"calibrate_camera",params:{pointsCamera:e,cameraName:t,config:n},jsonrpc:2,id:0};return(await ea.post("api/",a)).data.result}({pointsCamera:E,cameraName:n,config:l})}}))),m.exports.useEffect((()=>{a?t&&n&&async function({imageData:e,cameraName:t,config:n}){const a={method:"find_corners",params:{imageData:Ca(e.buffer),cameraName:t,config:n},jsonrpc:2,id:0};let r=(await ea.post("api/",a)).data.result;return{images:Sa(r.images),corners:r.corners,result:r.result}}({imageData:t[n],cameraName:n,config:l}).then((e=>{const t=new Blob([e.images.buffer],{type:"application/octet-stream"});var n=URL.createObjectURL(t);b((e=>[n,...e])),v((t=>[e.corners,...t])),h((t=>[e.result,...t])),f(0),p(!0)})):p(!1)}),[a]),m.exports.useEffect((()=>{if(s){for(let e=0;e<g.length;e++)if(0==g[e])return void r(!1);g.length>=10?r(!0):r(!1)}else r(n)}),[s,n,g]),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},u.createElement(Je,null,u.createElement(zr,{type:Ar.IMAGE,height:1.2}),u.createElement(Tr,i({src:a?c?x[d]:void 0:e,onTextureLoad:()=>{}},{pointsPicked:[],onChange:()=>{},enabled:!1,removing:!1})))),u.createElement("div",{className:"frameform-panel"},s&&u.createElement(dl,{source:g,images:x,onChange:e=>{f(e)},onDelete:(e,t,n)=>{b(t),h(n),E.splice(e,1),v(E),d>=t.length&&f(t.length-1)}})))}));var hl=u.forwardRef((function({imageUrl:e,setCalibEnable:t,setDoDistort:n},a){const r=so();return m.exports.useEffect((()=>{t(!0)}),[]),m.exports.useEffect((()=>{n(r)}),[r]),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},u.createElement(Je,null,u.createElement(zr,{type:Ar.IMAGE,height:1.2}),u.createElement(Tr,i({src:e,onTextureLoad:()=>{}},{pointsPicked:[],onChange:()=>{},enabled:!1,removing:!1})))))}));const El=E((e=>({container:{paddingBottom:"0.5rem",padding:"2rem",marginTop:"-1rem",marginLeft:"1rem",marginRight:"1rem",borderRadius:"0.5rem"}})));var vl;!function(e){e[e.BEGIN=0]="BEGIN",e[e.CALIB=1]="CALIB",e[e.CHECK=2]="CHECK"}(vl||(vl={}));const xl=["stepNameLidarInsBegin","stepNameLidarInsCalib","stepNameLidarInsCheck"],bl=["helpMsgLidarInsBegin","helpMsgLidarInsCalib","helpMsgLidarInsCheck"];var yl=m.exports.memo((function({activeStep:e,setActiveStep:t,children:n,onNext:a,t:r=(e=>e||""),calibEnable:o,statusString:l}){const[s,c]=m.exports.useState({}),[p,d]=m.exports.useState(!1),f=e=>{c(fe((t=>{for(let n=0;n<xl.length;n++)t[n]=n<e}))),e<xl.length&&t(e)};m.exports.useEffect((()=>{f(e)}),[e]);const g=El();return u.createElement(G,{className:g.container},u.createElement(xt,{nonLinear:!0,activeStep:e},xl.map(((t,n)=>u.createElement(bt,{key:t,completed:s[n]},u.createElement(yt,i({onClick:()=>f(n)},(t=>e===t&&p?{icon:u.createElement(B,{size:"1.5rem"})}:{})(n)),r(t)))))),u.createElement(S,{px:"2rem",display:"flex",alignItems:"center",style:{whiteSpace:"pre-wrap",marginTop:"1rem"}},u.createElement(R,{variant:"body1"},r(bl[e])),u.createElement("span",null," "),n),u.createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:"2rem",whiteSpace:"pre-wrap"}},u.createElement(R,{variant:"body1"},l)),u.createElement(S,{px:"1rem",display:"flex"},0===e||u.createElement(h,{color:"primary",onClick:()=>{f(e-1)}},r("previous")),u.createElement(S,{flexGrow:1}),u.createElement(S,null,e>=xl.length||u.createElement(h,{color:"primary",onClick:()=>{e+1<xl.length?f(e+1):f(0)}},r("skip")),u.createElement(h,{variant:"contained",color:"primary",disabled:!o,onClick:e+1<xl.length?async()=>{d(!0),a&&await a(),f(e+1),d(!1)}:async()=>{d(!0),a&&await a(),f(0),d(!1)},onKeyDown:e=>{e.preventDefault()},onKeyUp:e=>{e.preventDefault()}},e+1<xl.length?r("next"):r("calibFinish")))))}));function wl({points:e,pose:t,staticTransform:n,finetuneTransform:a}){const[r,o]=m.exports.useState(),[l,i]=m.exports.useState(void 0);return m.exports.useEffect((()=>{t&&wa(t).then((e=>{o(e)}))}),[t]),m.exports.useEffect((()=>{if(r){let e=r.clone();n&&(e=e.multiply(n)),a&&(e=e.multiply(a));const t=new Le,o=new Ye,l=new Le;e.decompose(t,o,l);const s=new Xe;s.setFromQuaternion(o),i({position:t.toArray(),rotation:s.toArray()})}}),[r,n,a]),u.createElement(qr,{maxNum:1e6,points:e,color:"height",size:1.5,visible:null!=l,pointsProps:l})}var Cl=u.forwardRef((function({setCalibEnable:e,setStatusString:t,t:n=(e=>e||""),isFinetune:a},r){const o=JSON.parse(JSON.stringify(jo));o.polarGrid.visible=!1,o.grid.visible=!0,o.camera.type=Ar.ORTHOGRAPHIC,m.exports.useImperativeHandle(r,(()=>({calibrate:async()=>{if(w(),a){let e=new O;return e.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),d&&(e=e.multiply(d)),g&&(e=e.multiply(g)),await async function({transform:e}){const t={method:"set_lidar_ins_transform",params:{transform:e.transpose().toArray()},jsonrpc:2,id:0};return(await ea.post("api/",t)).data.result}({transform:e})}return await async function(){return(await ea.post("api/",{method:"calibrate_lidar_ins",jsonrpc:2,id:0})).data.result}()}})));const[l,s]=m.exports.useState([]),[c,p]=m.exports.useState([]),[d,f]=m.exports.useState(),[g,h]=m.exports.useState(),[E,v]=m.exports.useState([0,0,0,"XYZ"]),[x,b]=m.exports.useState([0,0,0]),{run:y,cancel:w}=U((()=>async function(){const e=await ea.get("v1/get-position-points",{responseType:"arraybuffer"});let t=Yn.decode(new Uint8Array(e.data)),n=new Float32Array(t.points&&t.points.length>0?t.points.buffer.slice(t.points.byteOffset,t.points.byteOffset+t.points.byteLength):[]),a=[0,0,0,0,0,0],r=!1;return t.pose&&(a=[t.pose.x,t.pose.y,t.pose.z,t.pose.heading,t.pose.pitch,t.pose.roll],r=1==t.pose.status),{points:n,position:a,result:r,is_reset:!1}}()),{pollingInterval:100,onSuccess:e=>{e.result&&l.length<20&&(s((t=>[...t,e.points])),p((t=>[...t,e.position])))},onError:()=>{s([]),p([])},manual:!0});U((()=>async function(){return ka((await ea.post("api/",{method:"get_lidar_ins_transform",jsonrpc:2,id:0})).data.result)}()),{pollingInterval:200,onSuccess:e=>{f(e)},manual:!1});const{data:C}=U((()=>async function(){return(await ea.post("api/",{method:"get_lidar_ins_calibration",jsonrpc:2,id:0})).data.result}()),{pollingInterval:200,manual:!1});return m.exports.useEffect((()=>{a?w():(s([]),p([]),v([0,0,0,"XYZ"]),b([0,0,0]),async function(){(await ea.post("api/",{method:"restart_lidar_ins_calibration",jsonrpc:2,id:0})).data}(),y())}),[a]),m.exports.useEffect((()=>{if(E&&x){let e=new O;const t=new Xe,n=E.slice();n[0]=n[0]*Math.PI/180,n[1]=n[1]*Math.PI/180,n[2]=n[2]*Math.PI/180,t.fromArray(n),e.makeRotationFromEuler(t),e.setPosition(...x),h(e)}}),[E,x]),m.exports.useEffect((()=>{if(a?e(!!C&&C.finish):l.length>=20?e(!0):e(!1),a){let e=C?C.percent:0;t(n("optProgress")+e.toFixed(1).toString()+" %")}else t(n("calibProgress")+(l.length/20*100).toFixed(1).toString()+" %")}),[l,a,C]),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},u.createElement(Je,{orthographic:!0,style:{position:"absolute"}},u.createElement(Bo,{config:o}),l.map(((e,t)=>u.createElement(wl,{points:e,pose:c[t],staticTransform:d,finetuneTransform:g}))))),a&&u.createElement(G,{className:"finetune-panel"},u.createElement(Ho,i({},{translation:x,rotation:E,setTranslation:b,setRotation:v}))))}));var Sl=u.forwardRef((function({setCalibEnable:e,setStatusString:t,t:n=(e=>e||"")},a){const[r,o]=m.exports.useState(),l=JSON.parse(JSON.stringify(jo));l.polarGrid.visible=!1,l.grid.visible=!0,l.camera.type=Ar.UP,Ke(Ze((async()=>{sa().then((e=>{o(e)})).catch((()=>{o(void 0)}))})),200);const{data:i}=U((()=>ba(!1)),{pollingInterval:100,manual:!1}),s=i;return m.exports.useEffect((()=>{if(r){let a=!1,o=r.ins.valid,l=Object.keys(r.lidar);for(let e=0;e<l.length;e++)if(r.lidar[l[e]].valid){a=!0;break}a&&o?(t(n("LidarInsConnect")),e(!0)):(t(n(a&&!o?"InsDisconnect":!a&&o?"LidarDisconnect":"LidarInsDisconnect")),e(!1))}else t(n("notConnected")),e(!1)}),[r]),m.exports.useImperativeHandle(a,(()=>({calibrate:async()=>{}}))),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},u.createElement(Je,null,u.createElement(Bo,{config:l}),u.createElement(qr,{maxNum:1e6,color:"height",size:1.5,points:null==s?void 0:s.points})),u.createElement("div",{style:{color:"white",position:"fixed",bottom:0,right:0}},`Lat: ${null==r?void 0:r.ins.latitude}, Lon: ${null==r?void 0:r.ins.longitude}`)))}));const kl=E((e=>({container:{paddingBottom:"0.5rem",padding:"2rem",marginTop:"-1rem",marginLeft:"1rem",marginRight:"1rem",borderRadius:"0.5rem"}})));var Ml;!function(e){e[e.BEGIN=0]="BEGIN",e[e.CALIB=1]="CALIB",e[e.CHECK=2]="CHECK"}(Ml||(Ml={}));const Il=["stepNameLidarImuBegin","stepNameLidarImuCalib","stepNameLidarImuCheck"],Nl=["helpMsgLidarImuBegin","helpMsgLidarImuCalib","helpMsgLidarImuCheck"];var Pl=m.exports.memo((function({activeStep:e,setActiveStep:t,children:n,onNext:a,t:r=(e=>e||""),calibEnable:o,statusString:l}){const[s,c]=m.exports.useState({}),[p,d]=m.exports.useState(!1),f=e=>{c(fe((t=>{for(let n=0;n<Il.length;n++)t[n]=n<e}))),e<Il.length&&t(e)};m.exports.useEffect((()=>{f(e)}),[e]);const g=kl();return u.createElement(G,{className:g.container},u.createElement(xt,{nonLinear:!0,activeStep:e},Il.map(((t,n)=>u.createElement(bt,{key:t,completed:s[n]},u.createElement(yt,i({onClick:()=>f(n)},(t=>e===t&&p?{icon:u.createElement(B,{size:"1.5rem"})}:{})(n)),r(t)))))),u.createElement(S,{px:"2rem",display:"flex",alignItems:"center",style:{whiteSpace:"pre-wrap",marginTop:"1rem"}},u.createElement(R,{variant:"body1"},r(Nl[e])),u.createElement("span",null," "),n),u.createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:"2rem",whiteSpace:"pre-wrap"}},u.createElement(R,{variant:"body1"},l)),u.createElement(S,{px:"1rem",display:"flex"},0===e||u.createElement(h,{color:"primary",onClick:()=>{f(e-1)}},r("previous")),u.createElement(S,{flexGrow:1}),u.createElement(S,null,e>=Il.length||u.createElement(h,{color:"primary",onClick:()=>{e+1<Il.length?f(e+1):f(0)}},r("skip")),u.createElement(h,{variant:"contained",color:"primary",disabled:!o,onClick:e+1<Il.length?async()=>{d(!0),a&&await a(),f(e+1),d(!1)}:async()=>{d(!0),a&&await a(),f(0),d(!1)},onKeyDown:e=>{e.preventDefault()},onKeyUp:e=>{e.preventDefault()}},e+1<Il.length?r("next"):r("calibFinish")))))}));function Rl({points:e,pose:t}){const[n,a]=m.exports.useState(),[r,o]=m.exports.useState(void 0);return m.exports.useEffect((()=>{t&&wa(t).then((e=>{a(e)}))}),[t]),m.exports.useEffect((()=>{if(n){let e=n.clone();const t=new Le,a=new Ye,r=new Le;e.decompose(t,a,r);const l=new Xe;l.setFromQuaternion(a),o({position:t.toArray(),rotation:l.toArray()})}}),[n]),u.createElement(qr,{maxNum:1e6,points:e,color:"height",size:1.5,visible:null!=r,pointsProps:r})}var _l=u.forwardRef((function({setCalibEnable:e,setStatusString:t,t:n=(e=>e||"")},a){const r=JSON.parse(JSON.stringify(jo));r.polarGrid.visible=!1,r.grid.visible=!0,r.camera.type=Ar.ORTHOGRAPHIC,m.exports.useImperativeHandle(a,(()=>({calibrate:async()=>await async function(){return(await ea.post("api/",{method:"calibrate_lidar_imu",jsonrpc:2,id:0})).data.result}()})));const[o,l]=m.exports.useState([]),[i,s]=m.exports.useState([]);return U((()=>async function(){const e=await ea.get("v1/get-imu-position-points",{responseType:"arraybuffer"});let t=Yn.decode(new Uint8Array(e.data)),n=new Float32Array(t.points&&t.points.length>0?t.points.buffer.slice(t.points.byteOffset,t.points.byteOffset+t.points.byteLength):[]),a=[0,0,0,0,0,0],r=!1,o=!1;return t.pose&&(a=[t.pose.x,t.pose.y,t.pose.z,t.pose.heading,t.pose.pitch,t.pose.roll],r=1==t.pose.status,o=2==t.pose.status),{points:n,position:a,result:r,is_reset:o}}()),{pollingInterval:30,onSuccess:e=>{e.is_reset&&o.length<200?Ra().then((()=>{l([]),s([])})):e.result&&o.length<200&&(l((t=>[...t,e.points])),s((t=>[...t,e.position])))},onError:()=>{l([]),s([])},manual:!1}),m.exports.useEffect((()=>{Ra().then((()=>{l([]),s([])}))}),[]),m.exports.useEffect((()=>{o.length>=200?e(!0):e(!1),t(n("calibProgress")+(o.length/200*100).toFixed(1).toString()+" %")}),[o]),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},u.createElement(Je,{orthographic:!0,style:{position:"absolute"}},u.createElement(Bo,{config:r}),o.map(((e,t)=>u.createElement(Rl,{points:e,pose:i[t]}))))))}));var Ll=u.forwardRef((function({setCalibEnable:e,setStatusString:t,t:n=(e=>e||"")},a){const r=JSON.parse(JSON.stringify(jo));r.polarGrid.visible=!1,r.grid.visible=!0,r.camera.type=Ar.ORTHOGRAPHIC;const[o,l]=m.exports.useState([]),[i,s]=m.exports.useState([]);return m.exports.useImperativeHandle(a,(()=>({calibrate:async()=>await async function(){return(await ea.post("api/",{method:"set_lidar_imu_extrinsics",jsonrpc:2,id:0})).data.result}()}))),m.exports.useEffect((()=>{(async function(){return(await ea.post("api/",{method:"lidar_imu_get_lidar_poses",jsonrpc:2,id:0})).data.result})().then((e=>{let t=Object.keys(e);for(let n=0;n<t.length;n++){let a=t[n];o[n]=new Le(e[a][3],e[a][7],e[a][11])}l([...o])})),async function(){return(await ea.post("api/",{method:"lidar_imu_get_imu_poses",jsonrpc:2,id:0})).data.result}().then((e=>{let t=Object.keys(e);for(let n=0;n<t.length;n++){let a=t[n];i[n]=new Le(e[a][3],e[a][7],e[a][11])}s([...i])})),e(!0),t("")}),[]),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},u.createElement(Je,{orthographic:!0,style:{position:"absolute"}},u.createElement(Bo,{config:r}),u.createElement(Wr,{trajectory:o,lineColor:65382}),u.createElement(Wr,{trajectory:i,lineColor:16711782}))))}));var Al,zl=u.forwardRef((function({setCalibEnable:e,setStatusString:t,t:n=(e=>e||"")},a){const[r,o]=m.exports.useState(),l=JSON.parse(JSON.stringify(jo));l.polarGrid.visible=!1,l.grid.visible=!0,l.camera.type=Ar.UP,Ke(Ze((async()=>{sa().then((e=>{o(e)})).catch((()=>{o(void 0)}))})),200);const{data:i}=U((()=>ba(!1)),{pollingInterval:100,manual:!1}),s=i;return m.exports.useEffect((()=>{if(r){let a=!1,o=r.ins.valid,l=Object.keys(r.lidar);for(let e=0;e<l.length;e++)if(r.lidar[l[e]].valid){a=!0;break}a&&o?(t(n("LidarInsConnect")),e(!0)):(t(n(a&&!o?"InsDisconnect":!a&&o?"LidarDisconnect":"LidarInsDisconnect")),e(!1))}else t(n("notConnected")),e(!1)}),[r]),m.exports.useImperativeHandle(a,(()=>({calibrate:async()=>{}}))),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},u.createElement(Je,null,u.createElement(Bo,{config:l}),u.createElement(qr,{maxNum:1e6,color:"height",size:1.5,points:null==s?void 0:s.points})),u.createElement("div",{style:{color:"white",position:"fixed",bottom:0,right:0}},`Lat: ${null==r?void 0:r.ins.latitude}, Lon: ${null==r?void 0:r.ins.longitude}`)))}));!function(e){e[e.BEGIN=0]="BEGIN",e[e.FINETUNE=1]="FINETUNE",e[e.RECALIB=2]="RECALIB"}(Al||(Al={}));const Fl=["stepNameSelectRadar","stepNameFinetune"],Ol=["helpMsgSelectRadar","helpMsgFinetune"],Dl=E((e=>({container:{paddingBottom:"0.5rem",padding:"2rem",marginTop:"-1rem",marginLeft:"1rem",marginRight:"1rem",borderRadius:"0.5rem"}})));var Tl=m.exports.memo((function({activeStep:e,setActiveStep:t,children:n,onNext:a,t:r=(e=>e||""),calibEnable:o}){const[l,s]=m.exports.useState({}),[c,p]=m.exports.useState(!1),d=e=>{s(fe((t=>{for(let n=0;n<Fl.length;n++)t[n]=n<e}))),t(e)};m.exports.useEffect((()=>{d(e)}),[e]);const f=Dl();return u.createElement(G,{className:f.container},u.createElement(xt,{nonLinear:!0,activeStep:e},Fl.map(((t,n)=>u.createElement(bt,{key:t,completed:l[n]},u.createElement(yt,i({onClick:()=>d(n)},(t=>e===t&&c?{icon:u.createElement(B,{size:"1.5rem"})}:{})(n)),r(t)))))),u.createElement(S,{px:"2rem",display:"flex",alignItems:"center",style:{whiteSpace:"pre-wrap",marginTop:"1rem"}},u.createElement(R,{variant:"body1"},r(Ol[e])),u.createElement("span",null," "),n),u.createElement(S,{px:"1rem",display:"flex"},0===e?void 0:u.createElement(h,{color:"primary",onClick:()=>{d(e-1)}},r("previous")),u.createElement(S,{flexGrow:1}),u.createElement(S,null,e>=Fl.length||u.createElement(h,{color:"primary",onClick:()=>{d(e+1)}},r("skip")),u.createElement(h,{variant:"contained",color:"primary",disabled:!o,onClick:e<Fl.length?async()=>{p(!0),a&&await a(),d(e+1),p(!1)}:()=>{d(0)},onKeyDown:e=>{e.preventDefault()},onKeyUp:e=>{e.preventDefault()}},e==Fl.length-1?r("calibFinish"):e<Fl.length?r("next"):r("resetCalibration")))))}));function jl({radarArray:e,radarIndex:t,setRadarIndex:n,setRadarPointcloud:a,activeStep:r,setActiveStep:o}){return u.createElement(ie,{variant:"standard",value:void 0===t?"":t,onChange:e=>{""===e.target.value?(n(void 0),a(void 0)):(n(e.target.value),r===Al.BEGIN&&o(r+1))},onFocus:e=>{e.target.blur()}},u.createElement(I,{value:"",key:""},u.createElement("em",null,"None")),e.map(((e,t)=>{const n=`${e.name}`;return u.createElement(I,{value:t,key:t},n)})))}function Bl(e){const{children:t,open:n,value:a}=e;return u.createElement(St,{open:n,enterTouchDelay:0,placement:"top",title:a},t)}function Ul({label:e,value:t,onChange:n,min:a,max:r,step:o}){const l=m.exports.useRef();return u.createElement(u.Fragment,null,u.createElement(R,{style:{width:"2.8rem",cursor:"pointer"},onClick:()=>{l.current.getElementsByClassName("MuiSlider-thumb")[0].focus()}},e),u.createElement("div",{style:{flexGrow:1.5}},u.createElement(st,{ref:l,components:{ValueLabel:Bl},size:"small",valueLabelDisplay:"auto",ValueLabelComponent:Bl,"aria-label":"x",value:t,onChange:n,min:a,max:r,step:o})))}function Gl({rotation:e,translation:t,setRotation:n,setTranslation:a}){return u.createElement(u.Fragment,null,["X","Y","Z"].map(((e,n)=>u.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:"0.1rem"}},u.createElement(Ul,i({},{label:e,value:t[n],onChange:(e,t)=>{a(fe((e=>{e[n]=t})))},min:-5,max:5,step:.01}))))),["Roll","Pitch","Yaw"].map(((t,a)=>u.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:"0.1rem"}},u.createElement(Ul,i({},{label:t,value:e[a],onChange:(e,t)=>{n(fe((e=>{e[a]=t})))},min:-30,max:30,step:.05}))))))}Bl.propTypes={children:Ct.element.isRequired,open:Ct.bool.isRequired,value:Ct.number.isRequired};function Vl(e){const t=e.slice();return t[0]=e[0]/180*Math.PI,t[1]=e[1]/180*Math.PI,t[2]=e[2]/180*Math.PI,t}var Hl=u.forwardRef((function({points:e,radarPoints:t,radarIndex:n,setCalibEnable:a},r){const[o,l]=m.exports.useState([0,0,0,"XYZ"]),[s,c]=m.exports.useState([0,0,0]),[p,d]=m.exports.useState(),[f,g]=m.exports.useState();m.exports.useEffect((()=>{aa().then((e=>g(e)))}),[]),m.exports.useEffect((()=>{a(null!=n)}),[n]);const h=JSON.parse(JSON.stringify(jo));h.polarGrid.visible=!1,h.grid.visible=!0,h.grid.divisions=50,h.camera.type=Ar.ORTHOGRAPHIC,m.exports.useImperativeHandle(r,(()=>({calibrate:async()=>{let e=new O;if(void 0===n)throw new Error("No target lidar index!");if(null!=f&&null!=n){let t=ro(f.radar[n].extrinsic_parameters),a=ro(s.concat(o.slice(0,3)));e.multiplyMatrices(a,t),f.radar[n].extrinsic_parameters=function(e){const t=e.clone(),n=new Le,a=new Ye,r=new Le,o=new Xe(0,0,0,"XYZ");t.decompose(n,a,r),o.setFromQuaternion(a);const l=o.toArray().slice(0,3);let i;return l[0]*=180/Math.PI,l[1]*=180/Math.PI,l[2]*=180/Math.PI,i=n.toArray().concat(l),i}(e),g(i({},f)),ra(f);let r=f.radar[n].extrinsic_parameters.slice(3,6);r.push("XYZ"),d({position:f.radar[n].extrinsic_parameters.slice(0,3),rotation:r})}return c([0,0,0]),l([0,0,0,"XYZ"]),e}}))),m.exports.useEffect((()=>{d({position:s,rotation:Vl(o)})}),[s,o]);let E=m.exports.useMemo((()=>u.createElement(Je,{orthographic:!0,style:{position:"absolute"}},u.createElement(Bo,{config:h}),u.createElement(qr,{points:e,color:"height",size:1.5}),u.createElement("group",i({},p),null==t?void 0:t.map((e=>u.createElement(Mr,{object:e,planeVisible:!0,visible:!0,showArrow:!1,colorType:"objectType"})))))),[t,e,p,h]);return u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab"},E),u.createElement("div",{className:"finetune-panel"},u.createElement(Ie,{defaultExpanded:!0,style:{marginBottom:"1px"}},u.createElement(kt,{expandIcon:u.createElement(Mt,null),id:"finetune-panel0-header"}),u.createElement(Ne,{style:{paddingTop:"0px"}},u.createElement("div",null,u.createElement(Gl,i({},{translation:s,rotation:o,setTranslation:c,setRotation:l})))))))}));var ql=u.forwardRef((function({points:e,radarPoints:t,radarIndex:n,setCalibEnable:a},r){const o=JSON.parse(JSON.stringify(jo));return o.polarGrid.visible=!1,o.grid.visible=!0,m.exports.useEffect((()=>{a(void 0!==n)}),[n]),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab"},u.createElement(Je,{raycaster:{params:{Points:{threshold:1}}}},u.createElement(Bo,{config:o}),u.createElement(qr,{points:e,color:"height",size:1.5}),t&&t.map((e=>u.createElement(u.Fragment,null,u.createElement(Mr,{object:e,planeVisible:!0,visible:!0,showArrow:!1,colorType:"objectType"})))))))}));const $l=E((e=>({container:{paddingBottom:"0.5rem",padding:"2rem",marginTop:"-1rem",marginLeft:"1rem",marginRight:"1rem",borderRadius:"0.5rem"}})));var Wl;!function(e){e[e.BEGIN=0]="BEGIN",e[e.CALIB_CAMERA=1]="CALIB_CAMERA",e[e.CHECK=2]="CHECK"}(Wl||(Wl={}));const Yl=["stepNameSelectCamera","stepNameCalibCamera","stepNameCheck"],Xl=["helpMsgSelectPanoramaCamera","helpMsgCalibPanoramaCamera","helpMsgCalibPanoramaCameraCheck"];m.exports.memo((function({activeStep:e,setActiveStep:t,children:n,onNext:a,t:r=(e=>e||""),calibEnable:o,belowComponent:l}){const[s,c]=m.exports.useState({}),[p,d]=m.exports.useState(!1),f=e=>{c(fe((t=>{for(let n=0;n<Yl.length;n++)t[n]=n<e}))),e<Yl.length&&t(e)};m.exports.useEffect((()=>{f(e)}),[e]);const g=$l();return u.createElement(G,{className:g.container},u.createElement(xt,{nonLinear:!0,activeStep:e},Yl.map(((t,n)=>u.createElement(bt,{key:t,completed:s[n]},u.createElement(yt,i({onClick:()=>f(n)},(t=>e===t&&p?{icon:u.createElement(B,{size:"1.5rem"})}:{})(n)),r(t)))))),u.createElement(S,{px:"2rem",display:"flex",alignItems:"center",style:{whiteSpace:"pre-wrap",marginTop:"1rem"}},u.createElement(R,{variant:"body1"},r(Xl[e])),u.createElement("span",null," "),n),l,u.createElement(S,{px:"1rem",display:"flex"},0===e||u.createElement(h,{color:"primary",onClick:()=>{f(e-1)}},r("previous")),u.createElement(S,{flexGrow:1}),u.createElement(S,null,e>=Yl.length||u.createElement(h,{color:"primary",onClick:()=>{e+1>=Yl.length?f(0):f(e+1)}},r("skip")),u.createElement(h,{variant:"contained",color:"primary",disabled:!o,onClick:e+1<Yl.length?async()=>{d(!0),a&&await a(),f(e+1),d(!1)}:async()=>{d(!0),a&&await a(),f(0),d(!1)},onKeyDown:e=>{e.preventDefault()},onKeyUp:e=>{e.preventDefault()}},e+1<Yl.length?r("next"):r("calibFinish")))))})),u.forwardRef((function({images:e,cameraName:t,paused:n,setCalibEnable:a,slideCameraIndex:r,setSlideCameraIndex:o},l){const[s,c]=m.exports.useState({}),[p,d]=m.exports.useState(!1),[f,g]=m.exports.useState(void 0),[h,E]=m.exports.useState(void 0),[v,x]=m.exports.useState(void 0),[b,y]=m.exports.useState([]),[w,C]=m.exports.useState([]),S=so(),k=co();return m.exports.useImperativeHandle(l,(()=>({calibrate:async()=>{}}))),m.exports.useEffect((()=>{if(c(e),l&&e&&t.length>=2&&r<t.length&&s.hasOwnProperty(t[r-1])&&s.hasOwnProperty(t[r])){const e=new Blob([s[t[r-1]].buffer],{type:"application/octet-stream"});var n=URL.createObjectURL(e);const o=new Blob([s[t[r]].buffer],{type:"application/octet-stream"});var a=URL.createObjectURL(o);E(n),x(a)}}),[e]),m.exports.useEffect((()=>{if(l&&n&&t.length>=2&&r<t.length&&s.hasOwnProperty(t[r-1])&&s.hasOwnProperty(t[r])){const e=t[r-1],n=t[r],a=Math.floor(t.length/2),l=r>a?"right":"left";d(!0),async function(e,t,n,a,r,o,l,i){const s={method:"get_homography",params:{cameras:e,name0:t,name1:n,image0:Ca(a.buffer),image1:Ca(r.buffer),kpoint0:o.map((e=>[e.x,e.y])),kpoint1:l.map((e=>[e.x,e.y])),order:i},jsonrpc:2,id:0};let c=(await ea.post("api/",s)).data.result;return{images:Sa(c.images),homography:c.homography,result:c.result}}(t,e,n,s[e],s[n],b,w,l).then((e=>{if(e.result){const n=new Blob([e.images.buffer],{type:"application/octet-stream"});var t=URL.createObjectURL(n);g(t),o(r+1)}})).finally((()=>{d(!1)}))}}),[n]),m.exports.useEffect((()=>{l?t.length>=2&&r>=t.length?a(!0):a(!1):t.length>=2&&t.length<=3?a(!0):a(!1)}),[l,t,r]),u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},p?u.createElement(Da,null):n?u.createElement(Je,null,u.createElement(zr,{type:3,height:1}),u.createElement(Tr,i({src:f,onTextureLoad:()=>{}},{pointsPicked:[],onChange:()=>{},enabled:!1,removing:!1}))):l?t.length>=2&&r<t.length&&u.createElement(u.Fragment,null,u.createElement("div",{style:{width:"50%",borderRight:"2px solid",borderRightColor:"#ffffff"}},u.createElement(Je,null,u.createElement(zr,{type:3,height:1.2}),u.createElement(Tr,i({src:h,onTextureLoad:()=>{}},{pointsPicked:b,onChange:e=>{y(e),console.log(e)},enabled:S,removing:k})))),u.createElement("div",{style:{flexGrow:1}},u.createElement(Je,null,u.createElement(zr,{type:3,height:1.2}),u.createElement(Tr,i({src:v,onTextureLoad:()=>{}},{pointsPicked:w,onChange:e=>{C(e)},enabled:S,removing:k}))))):u.createElement("div",{style:{top:"40%",left:50-15*t.length+"%",position:"absolute"}},t.map(((n,a)=>{const r=t[a];if(e.hasOwnProperty(r))return u.createElement(xo,{name:r,imageData:e[r],numCamera:t.length})}))))})),u.forwardRef((function({setCalibEnable:e},t){const[n,a]=m.exports.useState(!0),[r,o]=m.exports.useState(void 0);return U((()=>async function(){const e=await ea.get("v1/get-panorama",{responseType:"arraybuffer"});let t=Yn.decode(new Uint8Array(e.data)),n={};for(let a of t.image||[])n[a.cameraName]=new Uint8Array(a.image.buffer.slice(a.image.byteOffset,a.image.byteOffset+a.image.byteLength));return n.panorama}()),{pollingInterval:100,onSuccess:e=>{const t=new Blob([e.buffer],{type:"application/octet-stream"});var n=URL.createObjectURL(t);o(n),a(!1)},manual:!1}),m.exports.useImperativeHandle(t,(()=>({calibrate:async()=>{await async function(){return await ea.get("v1/set-panorama-config")}()}}))),m.exports.useEffect((()=>{e(!0)}),[]),u.createElement(u.Fragment,null,u.createElement("div",{className:"calibration-tab",style:{display:"flex"}},n?u.createElement(Da,null):u.createElement(Je,null,u.createElement(zr,{type:Ar.IMAGE,height:1}),u.createElement(Tr,i({src:r,onTextureLoad:()=>{}},{pointsPicked:[],onChange:()=>{},enabled:!1,removing:!1})))))}));const Kl={calibrate_lidar:{name:"calibrate_lidar",component:function(){const{t:e}=v(),[t,n]=m.exports.useState([]);m.exports.useEffect((()=>{aa().then((e=>n(e.lidar)))}),[]);const[a,r]=m.exports.useState([]);m.exports.useEffect((()=>{let e=!1;window.onkeyup=t=>{" "===t.key&&(e=!e)};const t=function(e,t){let n=!1;const a=async()=>{if(n)return;const r=performance.now();await e();const o=performance.now()-r;setTimeout(a,t-o)};return a(),()=>{n=!0}}((async()=>{if(!e)try{const e=await async function(){const e=await ea.get("v1/lidar-pointcloud-map",{responseType:"arraybuffer"});if(!Kn)throw new Error("LidarPointcloudMap has not been parsed!");let t=Kn.decode(new Uint8Array(e.data)),n=[];for(let a of t.lp||[])n[Number(a.lidarName)]=new Float32Array(a.points.buffer.slice(a.points.byteOffset,a.points.byteOffset+a.points.byteLength));return n}();r(e)}catch(t){console.log(t)}}),100);return()=>{window.onkeyup=null,t()}}),[]);const[o,l]=m.exports.useState(!1),[s,c]=m.exports.useState("Local"),[p,d]=m.exports.useState(),[f,g]=m.exports.useState([]),[h,E]=m.exports.useState(0),x=m.exports.useRef(null);let b=null,y=null,w=u.createElement(Do,{lidarArray:t,lidarIndex:p,setLidarIndex:d,activeStep:h,setActiveStep:E}),C=u.createElement(To,{lidarArray:t,lidarIndex:f,setLidarIndex:g,activeStep:h,setActiveStep:E});return h===_o.BEGIN?(b=w,y=u.createElement(Uo,{points:a[p],lidarIndex:p,setCalibEnable:l,disable:!0})):h===_o.CALIB_GROUND?(b=null,y=u.createElement(Uo,{ref:x,points:a[p],lidarIndex:p,setCalibEnable:l,disable:!1})):h===_o.CALIB_POSITION?(b=u.createElement(u.Fragment,null,u.createElement(R,{variant:"body1"},e("useCoordinate")),u.createElement(ie,{variant:"standard",value:s,onChange:e=>{c(e.target.value)},onFocus:e=>{e.target.blur()}},u.createElement(I,{value:"Local"},e("local")),u.createElement(I,{value:"Global"},e("global"))),u.createElement(R,{variant:"body1"},e("Coordinate"))),y=u.createElement(Zo,{ref:x,points:a[p],lidarIndex:p,coordinate:s,setCalibEnable:l})):h!==_o.FINETUNE&&h!==_o.RECALIB||(b=u.createElement(u.Fragment,null,e("target"),": ",w,e("reference"),": ",C),y=u.createElement(Wo,{ref:x,pointsArray:a,targetLidarIndex:p,referenceLidarIndex:f,setCalibEnable:l})),u.createElement(u.Fragment,null,u.createElement("div",{style:{position:"relative",width:"100vw",marginTop:"-0.2rem"}},u.createElement(Oo,i({},{activeStep:h,setActiveStep:E,onNext:async()=>{var e;let t;l(!1),t=await(null==(e=x.current)?void 0:e.calibrate()),l(!0),r(fe((e=>{console.log(p,e,t),void 0!==p&&e[p]&&t&&(e[p]=ao(e[p],t))})))},t:e,calibEnable:o}),b)),y)}},calibrate_lidar_camera:{name:"calibrate_lidar_camera",component:function({}){const{t:e}=v(),[t,n]=m.exports.useState(!1),[a,r]=m.exports.useState(),[o,l]=At({}),[s,{toggle:c}]=zt(!1);Ft("space",(e=>{c()}));const[p,{inc:d}]=Ot(0);Ke(Ze((async()=>{if(!s){const e=await ba();let t;if(a){const n=new Blob([e.images[a].buffer],{type:"application/octet-stream"});t=URL.createObjectURL(n)}l(i({timestamp:p,imageUrl:t},e)),d()}})),100),m.exports.useEffect((()=>{if(a&&o.images&&o.images.hasOwnProperty(a)){const e=new Blob([o.images[a].buffer],{type:"application/octet-stream"}),t=URL.createObjectURL(e);l(i({imageUrl:t},o))}}),[a]);const[f,g]=m.exports.useState(0);let h=null;const E=m.exports.useRef();return f===el.BEGIN?h=u.createElement(Jo,{points:o.points,timestamp:o.timestamp,imageUrl:o.imageUrl,images:o.images,cameraName:a,paused:!1,setCalibEnable:n}):f===el.CALIB_LIDAR_CAMERA?h=u.createElement(Jo,{ref:E,points:o.points,timestamp:o.timestamp,imageUrl:o.imageUrl,images:o.images,cameraName:a,paused:s,setCalibEnable:n}):f===el.FINETUNE?h=u.createElement(ol,{ref:E,timestamp:o.timestamp,points:o.points,imageUrl:o.imageUrl,cameraName:a,setCalibEnable:n}):(E.current=null,h=u.createElement(ll,{points:o.points,imageUrl:o.imageUrl,cameraName:a,setCalibEnable:n})),u.createElement(u.Fragment,null,u.createElement(al,i({},{activeStep:f,setActiveStep:g,onNext:async()=>{E.current&&(n(!1),await E.current.calibrate(),n(!0))},t:e,calibEnable:t}),f===el.BEGIN&&u.createElement(ie,{variant:"standard",value:a||"",onChange:e=>{r(e.target.value),f===el.BEGIN&&g(f+1)}},Object.keys(o.images||{}).sort().map(((e,t)=>u.createElement(I,{value:e,key:e},e))))),h)}},calibrate_camera:{name:"calibrate_camera",component:function({}){const{t:e}=v(),[t,n]=m.exports.useState(!1),[a,r]=m.exports.useState(),[o,l]=At({}),[s,c]=m.exports.useState(fl),[p,{toggle:d}]=zt(!1),[f,g]=m.exports.useState(!1);Ft("space",(e=>{d()})),Ke(Ze((async()=>{if(!p){const e=await async function(e){const t=await ea.post("v1/source-data",{do_distort:e},{responseType:"arraybuffer"});let n=Yn.decode(new Uint8Array(t.data)),a=new Float32Array([]),r={};for(let o of n.image||[])r[o.cameraName]=new Uint8Array(o.image.buffer.slice(o.image.byteOffset,o.image.byteOffset+o.image.byteLength));return{points:a,objects:[],freespace:void 0,images:r}}(f);let t;if(a){const n=new Blob([e.images[a].buffer],{type:"application/octet-stream"});t=URL.createObjectURL(n)}l(i({imageUrl:t},e))}})),100),m.exports.useEffect((()=>{if(a&&o.images&&o.images.hasOwnProperty(a)){const e=new Blob([o.images[a].buffer],{type:"application/octet-stream"}),t=URL.createObjectURL(e);l(i({imageUrl:t},o))}}),[a]);const[h,E]=m.exports.useState(0);let x=null;const b=m.exports.useRef();h===sl.BEGIN?x=u.createElement(gl,{imageUrl:o.imageUrl,images:o.images,cameraName:a,paused:!1,setCalibEnable:n,setDoDistort:g,config:s}):h===sl.CALIB_CAMERA?x=u.createElement(gl,{ref:b,imageUrl:o.imageUrl,images:o.images,cameraName:a,paused:p,setCalibEnable:n,setDoDistort:g,config:s}):(b.current=null,x=u.createElement(hl,{ref:b,imageUrl:o.imageUrl,setCalibEnable:n,setDoDistort:g}));const y=h===sl.CALIB_CAMERA&&u.createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:"2rem",whiteSpace:"pre-wrap"}},u.createElement(R,null,e("boardRow")),u.createElement("span",null," "),u.createElement(It,{style:{maxWidth:"35px"},inputProps:{min:0,style:{textAlign:"center"}},type:"number",value:null==s?void 0:s.chessboardRow.toFixed(0),onChange:e=>{s&&(s.chessboardRow=Number(e.target.value),c(i({},s)))}}),u.createElement("span",null," "),u.createElement(R,null,e("boardCol")),u.createElement("span",null," "),u.createElement(It,{style:{maxWidth:"35px"},inputProps:{min:0,style:{textAlign:"center"}},type:"number",value:null==s?void 0:s.chessboardCol.toFixed(0),onChange:e=>{s&&(s.chessboardCol=Number(e.target.value),c(i({},s)))}}),u.createElement("span",null," "),u.createElement(R,null,e("boardSize")),u.createElement("span",null," "),u.createElement(It,{style:{maxWidth:"60px"},inputProps:{min:0,style:{textAlign:"center"}},type:"number",value:null==s?void 0:s.chessboardSize.toFixed(0),endAdornment:u.createElement(ce,{position:"end"},"mm"),onChange:e=>{s&&(s.chessboardSize=Number(e.target.value),c(i({},s)))}}));return u.createElement(u.Fragment,null,u.createElement(ul,i({},{activeStep:h,setActiveStep:E,onNext:async()=>{b.current&&(n(!1),await b.current.calibrate(),n(!0))},t:e,calibEnable:t,belowComponent:y}),h===sl.BEGIN&&u.createElement(ie,{variant:"standard",value:a||"",onChange:e=>{r(e.target.value),h===sl.BEGIN&&E(h+1)}},Object.keys(o.images||{}).sort().map(((e,t)=>u.createElement(I,{value:e,key:e},e))))),x)}},calibrate_lidar_ins:{name:"calibrate_lidar_ins",component:function({}){const{t:e}=v(),[t,n]=m.exports.useState(!1),[a,r]=m.exports.useState("");m.exports.useEffect((()=>{ma()}),[]);const[o,l]=m.exports.useState(0);let s=null;const c=m.exports.useRef();return s=o===vl.BEGIN?u.createElement(Sl,{ref:c,setCalibEnable:n,setStatusString:r,t:e}):o===vl.CALIB?u.createElement(Cl,{ref:c,setCalibEnable:n,setStatusString:r,t:e,isFinetune:!1}):u.createElement(Cl,{ref:c,setCalibEnable:n,setStatusString:r,t:e,isFinetune:!0}),u.createElement(u.Fragment,null,u.createElement(yl,i({},{activeStep:o,setActiveStep:l,onNext:async()=>{c.current&&(n(!1),await c.current.calibrate(),n(!0))},t:e,calibEnable:t,statusString:a})),s)}},calibrate_lidar_radar:{name:"calibrate_lidar_radar",component:function(e=100){const{t:t}=v(),[n,a]=m.exports.useState(),[r,o]=m.exports.useState(),{data:l,error:s,loading:c,run:p,cancel:d}=U((()=>ba(!1)),{pollingInterval:e,manual:!0}),[f,g]=m.exports.useState([]);m.exports.useEffect((()=>{aa().then((e=>g(e.radar)))}),[]);const[h,E]=m.exports.useState(!1);window.onkeyup=e=>{" "===e.key&&E(!h)},m.exports.useEffect((()=>{h?d():p()}),[h]);const[x,b]=m.exports.useState(!1),[y,w]=m.exports.useState(),[C,S]=m.exports.useState(0),k=m.exports.useRef(null);m.exports.useEffect((()=>{const e=null==l?void 0:l.points,t=null==l?void 0:l.radar;let n=[],r=t?Object.keys(t):void 0;if(null!=t)for(let a of r||[])n.push(t[a]);a(e),null!=y&&o(n[y])}),[l,y]);let M=null,I=null,N=u.createElement(jl,{radarArray:f,radarIndex:y,setRadarIndex:w,setRadarPointcloud:o,activeStep:C,setActiveStep:S});return C===Al.BEGIN?(M=N,I=u.createElement(ql,{ref:k,points:n,radarPoints:r,radarIndex:y,setCalibEnable:b})):C!==Al.FINETUNE&&C!==Al.RECALIB||(M=u.createElement(u.Fragment,null,t("target"),": ",N),I=u.createElement(Hl,{ref:k,points:n,radarPoints:r,radarIndex:y,setCalibEnable:b})),u.createElement(u.Fragment,null,u.createElement("div",{style:{position:"relative",width:"100vw",marginTop:"-0.2rem"}},u.createElement(Tl,i({},{activeStep:C,setActiveStep:S,onNext:async()=>{var e;let t;b(!1),t=await(null==(e=k.current)?void 0:e.calibrate()),b(!0),o(fe((e=>{console.log(y,e,t)})))},t:t,calibEnable:x}),M)),I)}},calibrate_lidar_imu:{name:"calibrate_lidar_imu",component:function({}){const{t:e}=v(),[t,n]=m.exports.useState(!1),[a,r]=m.exports.useState("");m.exports.useEffect((()=>{ma()}),[]);const[o,l]=m.exports.useState(0);let s=null;const c=m.exports.useRef();return s=o===Ml.BEGIN?u.createElement(zl,{ref:c,setCalibEnable:n,setStatusString:r,t:e}):o===Ml.CALIB?u.createElement(_l,{ref:c,setCalibEnable:n,setStatusString:r,t:e}):u.createElement(Ll,{ref:c,setCalibEnable:n,setStatusString:r,t:e}),u.createElement(u.Fragment,null,u.createElement(Pl,i({},{activeStep:o,setActiveStep:l,onNext:async()=>{c.current&&(n(!1),await c.current.calibrate(),n(!0))},t:e,calibEnable:t,statusString:a})),s)}}},Zl=Dt(h)({height:"10rem",fontSize:"1.5rem",textTransform:"none",color:"black",backgroundColor:"#E0E0E0","&:hover":{backgroundColor:"#D5D5D5"}}),Jl=Dt("div")({maxWidth:"1200px",marginTop:"1rem",position:"absolute",left:0,right:0,marginLeft:"auto",marginRight:"auto"});function Ql({values:e,handleChange:t,t:n=(e=>e)}){return Object.entries(e).map((([a,r],o)=>u.createElement(Z,{maxWidth:"md"},u.createElement(Ie,{style:{marginTop:"1px"},key:o},u.createElement(kt,{expandIcon:u.createElement(Mt,null),id:"selectConfig"},u.createElement(R,{variant:"subtitle2",className:"subtitle-no-mt"},n(a))),u.createElement(Ne,{style:{paddingTop:"0px"}},"boolean"!=typeof Object.values(r)[0]?u.createElement(Ql,{values:r,handleChange:t,t:n}):u.createElement(Z,{maxWidth:"md",style:{marginLeft:"0rem"}},u.createElement(re,{container:!0,spacing:0},Object.entries(r).map((([r,o],l)=>u.createElement(re,{item:!0,xs:"auto",key:l},u.createElement(W,{control:u.createElement(Y,{checked:e[a][r],name:a+"."+r,onChange:t}),label:n(r)})))))))))))}function ei({setIsLoaded:e}){const t=ke((e=>e.avfuns)),n=Me();m.exports.useEffect((()=>{e(!1),n(Er()),e(!0)}),[]),m.exports.useEffect((()=>{"object"==typeof t&&c(t)}),[t]);const{t:a}=v(),r=ae({initialValues:dr.avfuns,onSubmit:e=>{console.log(e)}}),{values:o,handleChange:l,errors:i,touched:s,setValues:c}=r,[p,d]=jn();return u.createElement("div",null,u.createElement(Z,{maxWidth:"md"},u.createElement(Ql,{values:o,handleChange:l,t:a}),u.createElement(S,{display:"flex"},u.createElement(S,{flexGrow:1}),u.createElement(h,{onClick:async()=>{try{e(!1);const t=await async function(e){const t={method:"set_web_store",params:{store:e},jsonrpc:2,id:0};return(await ea.post("api/",t)).data.result}(o);e(!0),console.log(t),d(a("configUpdated"),2e3)}catch(t){console.log(t)}},color:"primary",variant:"contained"},a("update"))),p))}const ti=E((e=>({editor:{height:"50rem"}})));function ni({setIsLoaded:e}){const{t:t}=v(),n=m.exports.useRef(null),a=m.exports.useRef(null);m.exports.useEffect((()=>{const e=new Gt(a.current,{mode:"code"});return n.current=e,()=>{e.destroy()}}),[]),m.exports.useEffect((()=>{r()}),[]);const r=async()=>{e(!1),n.current.set(await aa()),e(!0),l(t("configReset"),2e3)},[o,l]=jn(),[i,s]=Tn({content:t("needReboot"),onConfirm:async()=>{l(t("doReboot"));let e=`http://${(await _a(!0)).hostname}`;const n=window.location.host.split(":")[1];e+=null==n?"":`:${n}`,window.location.href=e},onCancel:async()=>{await _a(!1),await r()},t:t}),c=ti();return u.createElement("div",null,u.createElement(Z,{maxWidth:"md"},u.createElement("div",{ref:a,className:c.editor}),u.createElement(S,{display:"flex"},u.createElement(h,{variant:"contained",color:"primary",onClick:()=>{window.open(`http://${Vn}:${Gn}`)}},t("OpenTerminal")),u.createElement(S,{flexGrow:1}),u.createElement(h,{onClick:r,color:"primary",variant:"contained"},t("reset")),u.createElement(h,{onClick:async()=>{e(!1);const a=await ra(n.current.get());e(!0);const r=a.status;l(t("configUpdated"),2e3),"Reboot"===r&&s()},color:"primary",variant:"contained"},t("update"))),i,o))}const ai=E((e=>({backdrop:{zIndex:e.zIndex.appBar-1,color:"#fff"}})));const ri=u.memo((({config:e=Ki,setConfig:t,t:n=(e=>e),className:a})=>{const r=m.exports.useRef();return m.exports.useEffect((()=>{const a=new et.exports.Pane({container:r.current});let o;return a.registerPlugin(tt),a.on("change",(r=>{t(i({},e));for(let t=0;t<a.children.length;t++){let r=a.children[t];r.title==n("map")&&(r.children[4].hidden="intensity"!=e.map.color)}})),o=a.addFolder({title:n("map"),expanded:!1}),o.addInput(e.map,"visible",{label:n("visible")}),o.addInput(e.map,"frustumCulled",{label:n("frustumCulled")}),o.addInput(e.map,"pose",{label:n("mapEdge")}),o.addInput(e.map,"color",{label:n("color"),options:Object.fromEntries(["height","intensity","gray","rgb"].map((e=>[n(e),e])))}),o.addInput(e.map,"maxIntensity",{min:.1,max:10,step:.05,label:n("maxIntensity")}),o.addInput(e.map,"size",{min:1,max:5,step:.5,label:n("size")}),o.addInput(e.map,"step",{min:1,max:20,step:1,label:n("step")}),o.addInput(e.map,"zRange",{min:-200,max:200,step:.1,label:n("zRange")}),()=>{a.dispose()}}),[n]),u.createElement("div",{className:a,ref:r})}));function oi({maxNum:e=1e6,points:t,color:n,onPointsUpdate:a,size:r=1,frustumCulled:o=!1,visible:l=!0,pointsProps:s}){const c=Ue((()=>new qe(new Float32Array(4*e),4)),[e]);return m.exports.useEffect((()=>{t&&l?(c.set(t),c.count=t.length/4,c.needsUpdate=!0):(c.count=0,c.needsUpdate=!0),a&&a()}),[t,l]),u.createElement("points",i({frustumCulled:o},s),u.createElement("bufferGeometry",{attributes:{position:c}}),u.createElement("pointsMaterial",i({},{size:r,sizeAttenuation:!1,color:n})))}function li({maxNum:e,points:t,imageData:n,config:a,boardConfig:r,insExtrinic:o,visible:l}){const[i,s]=m.exports.useState();return m.exports.useEffect((()=>{const e={};for(let t of r.camera)e[t.name]=t;s(e)}),[r]),u.createElement(u.Fragment,null,n&&i&&Object.keys(n).sort().map((r=>{if(i.hasOwnProperty(r))return u.createElement(ii,{key:r,maxNum:e,cameraName:r,points:t,imageData:n[r],cameraConfig:i,insExtrinic:o,visible:l,config:a})})))}function ii({maxNum:e,cameraName:t="",points:n,imageData:a,cameraConfig:r,insExtrinic:o,visible:l,config:c}){const p=m.exports.useRef({lock:!1}),[d,f]=m.exports.useState();m.exports.useEffect((()=>{if(!a)return;if(p.current.lock)return;p.current.lock=!0;const e=new Blob([a.buffer],{type:"application/octet-stream"});f(URL.createObjectURL(e))}),[a]);const[g,h]=m.exports.useState();m.exports.useEffect((()=>{if(r&&t){const e=r[t],n=new Le(e.extrinsic_parameters[0],e.extrinsic_parameters[1],e.extrinsic_parameters[2]),a=new Le(1,1,1),l=new Ye,i=new Xe(.01745329251994*e.extrinsic_parameters[3],.01745329251994*e.extrinsic_parameters[4],.01745329251994*e.extrinsic_parameters[5],"XYZ");l.setFromEuler(i),l.set(l.y,l.x,l.z,l.w);const s=new O;s.compose(n,l,a),h(s.multiply(o.clone().invert()))}}),[r,t]);const[E,v,x,b]=m.exports.useMemo((()=>{var e;return void 0===t||void 0===r?[600,600,320,240]:null==(e=r[t])?void 0:e.intrinsic_parameters.slice(0,4)}),[t,r]);return u.createElement(jr,s(i({maxNum:e},c),{pointsize:3,transparent:!0,points:n,imageUrl:d,onLoad:()=>{d&&URL.revokeObjectURL(d),p.current.lock=!1},cameraIntrinsic:{cx:x,cy:b,fx:E,fy:v},pointsProps:g,visible:l}))}function si({id:e,points:t,images:n,color:a,size:r=3,config:o,boardConfig:l,insExtrinic:c,isSelect:p,visible:d,vertexPose:f}){const[g,h]=m.exports.useState();return m.exports.useEffect((()=>{if(f){const e=new Le,t=new Ye,n=new Le;f.decompose(e,t,n);const a=new Xe;if(a.setFromQuaternion(t),g){let t=g.rotation,n=g.position,r=Math.abs(t[0]-a.x)+Math.abs(t[1]-a.y)+Math.abs(t[2]-a.z),o=Math.abs(n[0]-e.x)+Math.abs(n[1]-e.y)+Math.abs(n[2]-e.z);if(r<1e-6&&o<1e-6)return}h({position:e.toArray(),rotation:a.toArray()})}}),[f]),u.createElement(u.Fragment,null,p?u.createElement(oi,s(i({maxNum:t?t.length/4:0,points:t},o),{color:a,size:r,frustumCulled:o.frustumCulled,visible:o.visible&&d||p,pointsProps:g})):"rgb"==o.color?u.createElement("group",i({},g),l&&c&&u.createElement(li,{maxNum:t?t.length/4:0,points:t,imageData:n,config:o,boardConfig:l,insExtrinic:c,visible:o.visible&&d||p})):"intensity"==o.color?u.createElement($r,s(i({maxNum:t?t.length/4:0,points:t},o),{frustumCulled:o.frustumCulled,visible:o.visible&&d||p,pointsProps:g})):u.createElement(qr,s(i({maxNum:t?t.length/4:0,points:t},o),{frustumCulled:o.frustumCulled,visible:o.visible&&d||p,pointsProps:g})))}function ci({poses:e=[],color:t}){const n=m.exports.useRef();return m.exports.useEffect((()=>{const e=n.current;e&&(e.frustumCulled=!1)}),[]),m.exports.useEffect((()=>{const t=n.current;t&&e&&t.geometry.setFromPoints(e)}),[e]),u.createElement("points",{ref:n},u.createElement("pointsMaterial",{color:t,size:1}))}function mi({imageData:e,onLoad:t}){const n=Object.keys(e).length,a=document.getElementsByClassName("MuiToolbar-root")[0],r=a?a.offsetHeight:0,o=Math.max(100,Math.min(280,(window.innerHeight-r)/n));return u.createElement("div",{className:"container"},Object.keys(e).sort().map(((a,r)=>u.createElement("div",{style:{position:"absolute",left:0,top:o*r}},u.createElement(ui,{key:a,name:a,imageData:e[a],onLoad:t,numCamera:n})))))}function ui({name:e="",imageData:t,onLoad:n,numCamera:a=1}){const r=m.exports.useRef(null),[o,l]=m.exports.useState(void 0),[i,s,c]=Bn();m.exports.useEffect((()=>{if(t){const e=new Blob([t.buffer],{type:"application/octet-stream"});l(URL.createObjectURL(e))}}),[t]),m.exports.useEffect((()=>{r.current&&o&&(r.current.onload=()=>{if(URL.revokeObjectURL(o),r.current){const e=document.getElementsByClassName("MuiToolbar-root")[0],t=e?e.offsetHeight:0,n=Math.max(100,Math.min(280,(window.innerHeight-t)/a)),o=r.current.naturalWidth/r.current.naturalHeight*n;E(o),x(n)}})}),[r.current]);const[p,d]=m.exports.useState(!1),[f,g]=m.exports.useState(1),[h,E]=m.exports.useState(0),[v,x]=m.exports.useState(0),[b,y]=m.exports.useState(!1);return u.createElement(u.Fragment,null,i,u.createElement(lt,null,u.createElement("img",{draggable:"false",style:{width:(p?2:1)*h*f,height:(p?2:1)*v*f,position:"fixed"},className:b?"maxIndex":void 0,src:o,ref:r,onMouseMove:t=>{s(t,e,{anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}}),y(!0)},onWheel:e=>{g(Math.min(3,Math.max(.5,f+-.001*e.deltaY)))},onMouseLeave:e=>{c(),y(!1)},onDoubleClick:e=>{p||Math.abs(f-1)>1e-4?(g(1),d(!1)):d(!p)}})))}function pi({id:e,config:t,isSelect:n}){const[a,r]=m.exports.useState(),[o,l]=m.exports.useState({});return m.exports.useEffect((()=>{e!=a&&n&&(Ia(e,"i").then((e=>{l(e.images)})),r(e))}),[e]),m.exports.useEffect((()=>{!n||null!=o&&e==a||(Ia(e,"i").then((e=>{l(e.images)})),r(e))}),[n]),u.createElement(u.Fragment,null,n&&o&&u.createElement(mi,{imageData:o}))}const di=u.memo((({config:e,boardConfig:t,vertexes:n,mapFrame:a,selectedVertex:r,selectedVertexColor:o})=>{const[l,i]=m.exports.useState();return m.exports.useEffect((()=>{t&&wa(t.ins.extrinsic_parameters).then((e=>{i(e)}))}),[t]),u.createElement(u.Fragment,null,n&&Object.keys(n).map(((i,s)=>{var c,m;let p=parseInt(i)%e.map.step==0;const d=r.findIndex((e=>e===i)),f=0==o[d]?16711680:o[d];return u.createElement(si,{key:"PointView"+i,id:i,points:null==(c=a[i])?void 0:c.points,images:null==(m=a[i])?void 0:m.images,color:-1!=d?f:void 0,size:0==o[d]?1:3,config:e.map,boardConfig:t,insExtrinic:l,isSelect:-1!=d,visible:p,vertexPose:ka(n[i])})})),n&&r.map(((e,t)=>{if(n.hasOwnProperty(e))return u.createElement(ci,{key:t,poses:[new Le(n[e][3],n[e][7],n[e][11])],color:0!=o[t]?o[t]:16711680})})))})),fi=u.memo((({config:e,vertexes:t,selectedVertex:n,selectedVertexColor:a})=>u.createElement(u.Fragment,null,t&&Object.keys(t).map(((t,r)=>{let o=n.findIndex((e=>e===t));const l=2==o&&0!=a[o];return u.createElement(pi,{key:r,id:t,config:e.map,isSelect:l})})))));var gi=u.memo(u.forwardRef((function({state:e,setState:t,onFinish:n},a){const{camera:r}=Fe(),[o,l]=m.exports.useState([]),i=m.exports.useRef(),s=m.exports.useRef();return m.exports.useEffect((()=>{const e=i.current;e&&e.geometry.setFromPoints(o)}),[o]),m.exports.useEffect((()=>{const t=s.current;if("drawing"==e&&t){t.applyMatrix4(r.matrixWorld);const e=new Le(0,0,-1);e.applyQuaternion(r.quaternion).add(r.position),t.position.set(e.x,e.y,e.z)}}),[e]),m.exports.useEffect((()=>{const e=i.current;e&&(e.renderOrder=999,e.material.depthTest=!1,e.material.depthWrite=!1,e.frustumCulled=!1)}),[]),m.exports.useImperativeHandle(a,(()=>({onContextClick:()=>{if(0!=o.length||"idle"!=e){if("idle"==e)return n([...o],r),void l([]);o.length<=2?(n(void 0,r),l([])):l([...o,o[0]]),t("idle")}}}))),u.createElement(u.Fragment,null,u.createElement("line",{ref:i},u.createElement("lineBasicMaterial",{color:16777215,linewidth:2})),"drawing"==e&&u.createElement("mesh",{ref:s,onClick:t=>{"drawing"==e&&l([...o,t.intersections[0].point])},onPointerMove:t=>{if("drawing"==e&&o.length>0){const e=i.current;null==e||e.geometry.setFromPoints([...o,t.intersections[0].point,o[0]])}},visible:!1},u.createElement("planeBufferGeometry",{args:[1e4,1e4]})))})));const hi=u.memo((({vertexes:e,edges:t,enable:n,selectEdge:a,onVertexClick:r,onEdgeClick:o})=>{const[l,s]=m.exports.useState([]),{camera:c}=Fe();m.exports.useEffect((()=>{const t=Object.keys(e);let n=[];for(let a=0;a<t.length;a++)n[a]=new Le(e[t[a]][3],e[t[a]][7],e[t[a]][11]);s(n)}),[e]);const p=(e,t)=>{const n=e.clone().project(c);return n.x=(n.x+1)/2*t.target.offsetWidth,n.y=-(n.y-1)/2*t.target.offsetHeight,n.z=0,n};return u.createElement(u.Fragment,null,u.createElement("group",null,Object.keys(t).length>0&&Object.keys(t).map(((n,r)=>{const o=t[n][0].toString(),l=t[n][1].toString();if(null==e[o]||null==e[l])return;const i=new Le(e[o][3],e[o][7],e[o][11]),s=new Le(e[l][3],e[l][7],e[l][11]);return u.createElement(Ei,{key:r,id:n,edge:[i,s],color:a==n?16711680:65382})}))),u.createElement("group",i({},{onClick:e=>{n&&(e.stopPropagation(),(e=>{let t=-1,n=1e4;for(let a=0;a<e.intersections.length;a++){let r=e.intersections[a].distanceToRay,o=e.intersections[a].index;r&&null!=o&&r<n&&(n=r,t=o)}r(t,e.button,e)})(e))},onPointerMissed:a=>{if(!n)return;a.stopPropagation();let i=100;if("click"==a.type){let e=-1;const t=[];for(let n=0;n<l.length;n++)t[n]=p(l[n],a);for(let n=0;n<t.length;n++){const r=t[n].x-a.clientX,o=t[n].y-a.clientY,l=Math.sqrt(r*r+o*o);l<i&&(i=l,e=n)}-1!=e&&r(e,a.button,a)}else if("contextmenu"==a.type){let n="";const r=Object.keys(t);for(let o=0;o<r.length;o++){const l=t[r[o]][0].toString(),s=t[r[o]][1].toString(),c=new Le(a.clientX,a.clientY,0);if(null==e[l]||null==e[s])continue;const m=p(new Le(e[l][3],e[l][7],e[l][11]),a),u=p(new Le(e[s][3],e[s][7],e[s][11]),a),d=oo(c.x,c.y,m.x,m.y,u.x,u.y);d<i&&(i=d,n=r[o])}""!=n&&o(n,a)}}}),u.createElement(ci,{poses:l,color:65280})))}));function Ei({id:e,edge:t=[],color:n}){const a=m.exports.useRef();return m.exports.useEffect((()=>{const e=a.current;e&&(e.frustumCulled=!1)}),[]),m.exports.useEffect((()=>{const e=a.current;e&&t&&e.geometry.setFromPoints(t)}),[t]),u.createElement("line",{ref:a,name:e},u.createElement("lineBasicMaterial",{color:n,linewidth:3}))}function vi({onFinish:e,onEvent:t}){const{t:n}=v(),[a,r]=m.exports.useState(!1),o=a=>{a&&(t("ShowMessage",{message:n("ClosingMap"),severity:"info",duration:1e4}),va("").then((()=>{t("RefreshMap",!0),t("ShowMessage",{message:n("finishClosingMap"),severity:"success",duration:2e3})}))),r(!1),e()};return u.createElement(u.Fragment,null,u.createElement(I,{onClick:()=>{r(!0)}},u.createElement(ut,null,u.createElement(Vt,{fontSize:"small"})),u.createElement(dt,null,n("MapClose"))),u.createElement(_,{open:a,onClose:o},u.createElement(ct,null,n("confirmCloseMap")),u.createElement(L,null,u.createElement(Ht,null,n("warnCloseMap"))),u.createElement(A,null,u.createElement(h,{onClick:()=>o(!1),color:"primary"},n("no")),u.createElement(h,{onClick:()=>o(!0),color:"primary"},n("yes")))))}function xi({onFinish:e}){const{t:t}=v(),n=Et();return u.createElement(I,{onClick:()=>{n("/preview",{replace:!0})}},u.createElement(ut,null,u.createElement(qt,{fontSize:"small"})),u.createElement(dt,null,t("MapExit")))}function bi({config:e,onFinish:t}){const{t:n}=v(),[a,r]=m.exports.useState(!1);return u.createElement(u.Fragment,null,a&&u.createElement(Da,null),u.createElement(I,{onClick:()=>{e&&(r(!0),async function(e,t,n){return(await ea.post("v1/set-export-map-config",{z_min:e,z_max:t,color:n})).data}(e.map.zRange.min/10,e.map.zRange.max/10,e.map.color).then((()=>{r(!1),window.open(ea.defaults.baseURL+"v1/map-export-pcd")})).finally((()=>{t()})))}},u.createElement(ut,null,u.createElement($t,{fontSize:"small"})),u.createElement(dt,null,n("MapExport"))))}const yi=E((e=>Ce({container:{display:"flex",flexWrap:"wrap",minWidth:300,maxWidth:500,maxHeight:500}})));function wi({onFinish:e,onEvent:t}){const{t:n}=v(),a=yi(),[r,o]=m.exports.useState(!1),[l,i]=m.exports.useState(!1),[s,c]=m.exports.useState(void 0),[p,d]=m.exports.useState(void 0),[f,g]=m.exports.useState({});m.exports.useEffect((()=>{aa().then((e=>{d(e)}))}),[]);const E=n=>{n&&s?(i(!0),xa(f[s][0]).then((()=>{t("RefreshMap")})).finally((()=>{i(!1),e()}))):e(),o(!1)};return u.createElement("div",null,p&&p.slam&&"localization"==p.slam.mode&&u.createElement(u.Fragment,null,l&&u.createElement(Da,null),u.createElement(I,{onClick:()=>{ha().then((e=>{"object"==typeof e&&g(e)})),o(!0)}},u.createElement(ut,null,u.createElement(Wt,{fontSize:"small"})),u.createElement(dt,null,n("MapMerge"))),u.createElement(_,{open:r,onClose:()=>E(!1)},u.createElement(ct,null,n("selectFile")),u.createElement(L,{id:"map_file_div"},u.createElement("div",{className:a.container},Object.keys(f).map((n=>{let a=f[n][0].split("/");return u.createElement(mt,{key:n,button:!0,onClick:()=>c(n),onDoubleClick:()=>{return c(a=n),i(!0),xa(f[a][0]).then((()=>{t("RefreshMap")})).finally((()=>{i(!1),e()})),void o(!1);var a},selected:s==n,id:s==n?"select_file_item":void 0},u.createElement(ut,null,u.createElement(pt,null)),u.createElement(dt,{primary:a[a.length-1]}))})))),u.createElement(A,null,u.createElement(h,{onClick:()=>E(!1),color:"primary"},n("no")),u.createElement(h,{onClick:()=>E(!0),color:"primary"},n("yes"))))))}const Ci=u.forwardRef((function(e,t){return u.createElement(it,i({elevation:6,ref:t,variant:"filled"},e))}));function Si(){const[e,t]=m.exports.useState(!1),[n,a]=m.exports.useState("success"),[r,o]=m.exports.useState(""),[l,i]=m.exports.useState();return[u.createElement(z,{open:e,autoHideDuration:l,onClose:()=>{t(!1)},anchorOrigin:{vertical:"top",horizontal:"center"}},u.createElement(Ci,{onClose:()=>{t(!1)},severity:n,sx:{width:"100%"}},r)),(e,n,r=2e3)=>{t(!0),o(e),a(n),i(r)},()=>{t(!1)}]}const ki=E((e=>Ce({container:{display:"flex",flexWrap:"wrap",minWidth:300,maxWidth:500,maxHeight:500}})));function Mi({onFinish:e,onEvent:t}){const{t:n}=v(),a=ki(),[r,o]=m.exports.useState(!1),[l,i]=m.exports.useState(!1),[s,c,p]=Si(),[d,f]=m.exports.useState(void 0),[g,E]=m.exports.useState({}),x=a=>{a&&d?(i(!0),c(n("OpeningMaps"),"info",1e4),t("ClearMap"),va(g[d][0]).then((()=>{t("RefreshMap")})).finally((()=>{i(!1),p(),setTimeout((()=>{e()}),100)}))):e(),o(!1)};return u.createElement("div",null,l&&u.createElement(Da,null),s,u.createElement(I,{onClick:()=>{ha().then((e=>{"object"==typeof e&&E(e)})),o(!0)}},u.createElement(ut,null,u.createElement(ft,{fontSize:"small"})),u.createElement(dt,null,n("MapOpen"))),u.createElement(_,{open:r,onClose:()=>x(!1)},u.createElement(ct,null,n("selectFile")),u.createElement(L,{id:"map_file_div"},u.createElement("div",{className:a.container},Object.keys(g).map((a=>{let r=g[a][0].split("/");return u.createElement(mt,{key:a,button:!0,onClick:()=>f(a),onDoubleClick:()=>{return f(r=a),t("ClearMap"),i(!0),c(n("OpeningMaps"),"info",1e4),va(g[r][0]).then((()=>{t("RefreshMap")})).finally((()=>{i(!1),p(),setTimeout((()=>{e()}),100)})),void o(!1);var r},selected:d==a,id:d==a?"select_file_item":void 0},u.createElement(ut,null,u.createElement(pt,null)),u.createElement(dt,{primary:r[r.length-1]}))})))),u.createElement(A,null,u.createElement(h,{onClick:()=>x(!1),color:"primary"},n("no")),u.createElement(h,{onClick:()=>x(!0),color:"primary"},n("yes")))))}function Ii({onFinish:e}){const{t:t}=v(),[n,a]=m.exports.useState(!1),[r,o]=m.exports.useState(function(e){const t=e.getMonth()+1,n=e.getDate(),a=e.getHours(),r=e.getMinutes(),o=e.getSeconds();return[e.getFullYear(),(t>9?"":"0")+t,(n>9?"":"0")+n].join("-")+"-"+[(a>9?"":"0")+a,(r>9?"":"0")+r,(o>9?"":"0")+o].join("-")}(new Date)),[l,i]=m.exports.useState(!1),s=t=>{t?la(r).then((e=>{"ok"==e&&i(!0)})):e(),a(!1)};return u.createElement(u.Fragment,null,u.createElement(_,{open:n,onClose:()=>s(!1)},u.createElement(ct,null,t("MapSave")),u.createElement(L,null,u.createElement(Ht,{style:{minWidth:"400px"}},t("MapInputSaveName")),u.createElement(se,{autoFocus:!0,margin:"normal",id:"name",defaultValue:r,onChange:e=>{o(e.target.value)},fullWidth:!0,variant:"standard"})),u.createElement(A,null,u.createElement(h,{onClick:()=>s(!1)},t("no")),u.createElement(h,{onClick:()=>s(!0)},t("yes")))),l&&u.createElement(No,{setShowMapSaving:i,setPause:()=>{e(),a(!1)}}),u.createElement(I,{onClick:()=>{a(!0)}},u.createElement(ut,null,u.createElement(Yt,{fontSize:"small"})),u.createElement(dt,null,t("MapSave"))))}var Ni=u.memo(u.forwardRef((function({onEvent:e,config:t,vertex:n,edge:a,meta:r,selectVertex:o,selectColor:l,selectPoints:i,selectPointIndex:s},c){const{t:p}=v(),[d,f]=m.exports.useState(null),g=()=>{f(null)},E=Xt((()=>{g()}));return m.exports.useImperativeHandle(c,(()=>({onClear:()=>{}}))),u.createElement(u.Fragment,null,u.createElement(h,{onClick:e=>{f(e.currentTarget)},color:"inherit"},p("File")),u.createElement(M,{anchorEl:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},open:Boolean(d),onClose:g},u.createElement(Qe,null,u.createElement(Mi,{onFinish:E,onEvent:e}),u.createElement(wi,{onFinish:E,onEvent:e}),u.createElement(Ii,{onFinish:E}),u.createElement(bi,{config:t,onFinish:E}),u.createElement(vi,{onFinish:E,onEvent:e}),u.createElement(Rt,null),u.createElement(xi,{onFinish:E}))))})));function Pi({onEvent:e,onFinish:t}){const{t:n}=v();return u.createElement(I,{onClick:()=>{e("OptimizeMap",!1),t()}},u.createElement(ut,null,u.createElement(Kt,{fontSize:"small"})),u.createElement(dt,null,n("MapOptimization")))}var Ri=u.forwardRef((function({translation:e,rotation:t,setTranslation:n,setRotation:a},r){const[o,l]=m.exports.useState({x:0,y:0,z:0,R:0,P:0,Y:0}),[i,s]=m.exports.useState();m.exports.useImperativeHandle(r,(()=>({onClear:()=>{null==i||i.importPreset({x:0,y:0,z:0,R:0,P:0,Y:0})}})));const c=m.exports.useRef();return m.exports.useEffect((()=>{const e=new et.exports.Pane({container:c.current});return e.on("change",(e=>{n([o.x,o.y,o.z]),a([o.R,o.P,o.Y,"XYZ"])})),e.addInput(o,"x",{min:-50,max:50,step:.01}),e.addInput(o,"y",{min:-50,max:50,step:.01}),e.addInput(o,"z",{min:-50,max:50,step:.01}),e.addInput(o,"R",{min:-180,max:180,step:.1}),e.addInput(o,"P",{min:-180,max:180,step:.1}),e.addInput(o,"Y",{min:-360,max:360,step:.1}),s(e),()=>{e.dispose()}}),[]),u.createElement("div",{ref:c})}));function _i(e){const t=e.slice();return t[0]=e[0]/180*Math.PI,t[1]=e[1]/180*Math.PI,t[2]=e[2]/180*Math.PI,t}function Li({onEvent:e,onFinish:t,selectVertex:n,selectColor:a}){const{t:r}=v(),o=m.exports.useRef(),[l,c]=m.exports.useState(!1),[p,d]=m.exports.useState(!1),[f,g]=m.exports.useState(),[E,x]=m.exports.useState(),[b,y]=m.exports.useState(),[w,C]=m.exports.useState([0,0,0,"XYZ"]),[k,M]=m.exports.useState([0,0,0]),[N,P]=m.exports.useState((new O).identity());m.exports.useEffect((()=>{if(b&&b.hasOwnProperty(n[0])&&b.hasOwnProperty(n[1])){if(0==a[0]||0==a[1])return;const e=ka(b[n[0]]).invert().multiply(ka(b[n[1]]));Ia(n[0],"p").then((e=>{g(e.points)})),Ia(n[1],"p").then((e=>{x(e.points)})),P(e)}}),[b,n,a]);const R=()=>{let e=new O;const t=new Xe,n=w.slice();return n[0]=n[0]*Math.PI/180,n[1]=n[1]*Math.PI/180,n[2]=n[2]*Math.PI/180,t.fromArray(n),e.makeRotationFromEuler(t),e.setPosition(...k),e.multiply(N)},L=()=>{t(),c(!1),y({}),g(void 0),x(void 0),C([0,0,0,"XYZ"]),M([0,0,0]),P((new O).identity())},z=t=>{if(0!=a[0]&&0!=a[1])if(t&&b&&b.hasOwnProperty(n[0])&&b.hasOwnProperty(n[1])){const t=R();(async function(e,t,n){const a={method:"map_add_edge",params:{prev:parseInt(e),next:parseInt(t),relative:n.transpose().toArray()},jsonrpc:2,id:0};return(await ea.post("api/",a)).data.result})(n[0],n[1],t).then((()=>{e("ClearSelection"),e("OptimizeMap",!1)})).finally((()=>{L()}))}else L();else L()},F=()=>{if(b&&b.hasOwnProperty(n[0])&&b.hasOwnProperty(n[1])){if(0==a[0]||0==a[1])return;d(!0);const e=R();(async function(e,t,n){const a={method:"map_keyframe_align",params:{source:e,target:t,guess:n.transpose().toArray()},jsonrpc:2,id:0};return ka((await ea.post("api/",a)).data.result)})(n[1],n[0],e).then((e=>{P(e),C([0,0,0,"XYZ"]),M([0,0,0]),o.current.onClear()})).finally((()=>{d(!1)}))}};return u.createElement("div",null,u.createElement(I,{onClick:()=>{c(!0),Ma().then((e=>{y(e)}))}},u.createElement(ut,null,u.createElement(Zt,{fontSize:"small"})),u.createElement(dt,null,r("MapManualLoop"))),u.createElement(_,{maxWidth:"lg",open:l},p&&u.createElement(Da,null),u.createElement("div",{className:"align-scene"},u.createElement(Je,{orthographic:!0},u.createElement("gridHelper",{args:[100,10,1118481,1118481],visible:!0,"rotation-x":Math.PI/2}),u.createElement(zr,{type:4,position:[0,0,0]}),b&&b.hasOwnProperty(n[0])&&b.hasOwnProperty(n[1])&&u.createElement(u.Fragment,null,u.createElement(si,{id:n[0],points:f,color:16711935,size:3,config:{},isSelect:!0,visible:!0,vertexPose:(new O).identity(),insExtrinic:(new O).identity()}),u.createElement("group",i({},{position:k,rotation:_i(w)}),u.createElement(si,{id:n[1],points:E,color:16776960,size:3,config:{},isSelect:!0,visible:!0,vertexPose:N,insExtrinic:(new O).identity()}))))),u.createElement("div",{className:"editor-finetune-panel"},u.createElement(Ri,s(i({},{translation:k,rotation:w,setTranslation:M,setRotation:C}),{ref:o}))),u.createElement(A,{style:{padding:"4px",backgroundColor:"#111"}},u.createElement(h,{onClick:()=>F(),color:"primary",variant:"contained"},r("AutoAlign")),u.createElement(h,{onClick:()=>(()=>{if(b&&b.hasOwnProperty(n[0])&&b.hasOwnProperty(n[1])){const e=ka(b[n[0]]).invert().multiply(ka(b[n[1]]));P(e),C([0,0,0,"XYZ"]),M([0,0,0]),o.current.onClear()}})(),color:"primary",variant:"contained"},r("Reset")),u.createElement(S,{flexGrow:1}),u.createElement(h,{onClick:()=>z(!1),color:"primary",variant:"contained"},r("no")),u.createElement(h,{onClick:()=>z(!0),color:"primary",variant:"contained"},r("yes")))))}function Ai({onEvent:e,onFinish:t,selectVertex:n,selectPointIndex:a}){const{t:r}=v(),[o,l]=m.exports.useState(!1),i=async a=>{l(!1),t(),e("ShowMessage",{message:r("DeletingMap"),severity:"info",duration:1e4});const o=n.filter(((e,t,n)=>n.indexOf(e)===t));for(let e=0;e<o.length;e++)await Na(o[e]);e("ClearSelection"),e(a?"OptimizeMap":"RefreshMap",!1),e("ShowMessage",{message:r("finishDeletingMap"),severity:"success",duration:2e3})};return u.createElement(u.Fragment,null,u.createElement(I,{onClick:()=>{if(!(n.length<=0&&Object.keys(a).length<=0))return Object.keys(a).length>0?(e("ShowMessage",{message:r("DeletingMap"),severity:"info",duration:6e4}),e("ShowLoading",!0),void async function(e){const t={method:"map-del-points",params:{index:e},jsonrpc:2,id:0};return(await ea.post("api/",t)).data.result}(a).then((()=>{e("DeleteFramePoints")})).finally((()=>{e("ShowMessage",{message:r("finishDeletingMap"),severity:"success",duration:2e3}),e("ShowLoading",!1),t()}))):void l(!0);t()}},u.createElement(ut,null,u.createElement(Jt,{fontSize:"small"})),u.createElement(dt,null,r("SelectionDelete"))),u.createElement(_,{open:o,onClose:()=>{l(!1),t()}},u.createElement(ct,null,r("confirmDeleteSelect")),u.createElement(L,{style:{minWidth:"350px",minHeight:"60px"}},u.createElement(Ht,null,r("needOptimize"))),u.createElement(A,null,u.createElement(h,{onClick:()=>i(!1),color:"primary"},r("False")),u.createElement(h,{onClick:()=>i(!0),color:"primary"},r("True")))))}var zi=u.memo(u.forwardRef((function({onEvent:e,config:t,vertex:n,edge:a,meta:r,selectVertex:o,selectColor:l,selectPoints:i,selectPointIndex:s},c){const{t:p}=v(),[d,f]=m.exports.useState(null),g=()=>{f(null)};return m.exports.useImperativeHandle(c,(()=>({onClear:()=>{}}))),u.createElement(u.Fragment,null,u.createElement(h,{onClick:e=>{f(e.currentTarget)},color:"inherit"},p("Edit")),u.createElement(M,{anchorEl:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},open:Boolean(d),onClose:g},u.createElement(Qe,null,u.createElement(Li,{onEvent:e,onFinish:g,selectVertex:o,selectColor:l}),u.createElement(Pi,{onEvent:e,onFinish:g}),u.createElement(Ai,{onEvent:e,onFinish:g,selectVertex:o,selectPointIndex:s}))))})));function Fi({meta:e,onEvent:t,onClose:n}){const{t:a}=v(),[r,o]=m.exports.useState(0),[l,i]=m.exports.useState(0);m.exports.useEffect((()=>{e&&(o(Object.keys(e.vertex).length),i(Object.keys(e.edge).length))}),[e]);return u.createElement(lt,null,u.createElement("div",{style:{position:"fixed",left:"0%",top:"8%",backgroundColor:"#1976d2",borderRadius:"5px"}},u.createElement(ct,{style:{padding:"0px",width:"300px"}},u.createElement(S,{display:"flex",alignItems:"center",height:"32px"},u.createElement(S,{flexGrow:1,style:{marginLeft:"6px",marginTop:"6px"}},a("MapGraphInfo")),u.createElement(S,null,u.createElement(Nt,{onClick:n,style:{paddingRight:"8px",fontSize:"24px"}},u.createElement(Vt,{fontSize:"inherit"})))),u.createElement(L,{dividers:!0,style:{backgroundColor:"#aaaaaa",padding:"8px",marginLeft:"8px",marginRight:"8px",marginBottom:"8px"}},u.createElement(R,{variant:"body1",style:{marginBottom:"4px",color:"black"}},a("MapStatistics")),u.createElement(Rt,{style:{marginBottom:"8px"}}),u.createElement(S,{display:"flex",alignItems:"center"},u.createElement(S,{flexGrow:1},u.createElement(R,{variant:"body2",style:{marginBottom:"4px",color:"black"}},a("MapVertexNum"))),u.createElement(S,null,u.createElement(R,{variant:"body2",style:{marginBottom:"4px",color:"blue"}},r))),u.createElement(S,{display:"flex",alignItems:"center"},u.createElement(S,{flexGrow:1},u.createElement(R,{variant:"body2",style:{marginBottom:"4px",color:"black"}},a("MapEdgeNum"))),u.createElement(S,null,u.createElement(R,{variant:"body2",style:{marginBottom:"4px",color:"blue"}},l))),u.createElement(Rt,{style:{marginBottom:"8px"}}),u.createElement(R,{variant:"body1",style:{marginBottom:"4px",color:"black"}},a("FixedVertex")),u.createElement(Rt,{style:{marginBottom:"8px"}}),e&&Object.entries(e.vertex).map((([e,{stamps:n,fix:r,edge_num:o}])=>{if(r)return u.createElement(S,{display:"flex",style:{marginTop:"4px"}},u.createElement(S,{flexGrow:1,alignItems:"center"},u.createElement(R,{variant:"body2",style:{marginTop:"4px",color:"black"}},a("id")+": "+e)),u.createElement(S,null,u.createElement(h,{size:"small",variant:"contained",onClick:()=>{(e=>{Pa(e,!1).then((()=>{t("RefreshMap")}))})(e)}},a("UnFix"))))}))))))}function Oi({onClick:e}){const{t:t}=v();return u.createElement(I,{onClick:e},u.createElement(ut,null,u.createElement(Qt,{fontSize:"small"})),u.createElement(dt,null,t("MapGraphInfo")))}function Di({onEvent:e,onFinish:t}){const{t:n}=v();return u.createElement(I,{onClick:()=>{e("RefreshMap",!0),t()}},u.createElement(ut,null,u.createElement(en,{fontSize:"small"})),u.createElement(dt,null,n("RefreashMap")))}function Ti({onEvent:e,onFinish:t}){const{t:n}=v();return u.createElement(I,{onClick:()=>{e("ClearSelection"),t()}},u.createElement(ut,null,u.createElement(tn,{fontSize:"small"})),u.createElement(dt,null,n("MapClearSelection")))}function ji({onEvent:e,onFinish:t,vertex:n,selectVertex:a,selectPointIndex:r}){const{t:o}=v();return u.createElement(I,{onClick:()=>{if(n&&0==Object.keys(r).length){const t=Object.keys(n).filter((function(e,t){return-1==a.indexOf(e)}));e("SetSelectVertex",{selection:t,color:new Array(t.length).fill(0)})}else e("ShowMessage",{message:o("NotSupportReversePoints"),severity:"warning",duration:5e3});t()}},u.createElement(ut,null,u.createElement(nn,{fontSize:"small"})),u.createElement(dt,null,o("ReverseSelection")))}Dt(I)({paddingLeft:"4px",paddingRight:"4px",display:"flex",justifyContent:"space-between"}),Dt(R)({paddingLeft:"8px",paddingRight:"8px",textAlign:"left"}),Dt(an)({display:"flex"});const Bi=m.exports.forwardRef(((e,t)=>{var n=e,{leftIcon:a,label:r,MenuItemProps:o,className:l}=n,m=c(n,["leftIcon","label","MenuItemProps","className"]);return u.createElement(I,i(s(i({},o),{ref:t}),m),u.createElement(ut,null,a),u.createElement(dt,null,r))}));Bi.displayName="IconMenuItem";const Ui=u.forwardRef((function(e,t){const n=e,{parentMenuOpen:a,label:r,leftIcon:o=null,children:l,className:p,tabIndex:d,ContainerProps:f={},MenuProps:g}=n,h=c(n,["parentMenuOpen","label","leftIcon","children","className","tabIndex","ContainerProps","MenuProps"]),E=f,{ref:v}=E,x=c(E,["ref"]),b=m.exports.useRef(null);m.exports.useImperativeHandle(t,(()=>null==b?void 0:b.current));const y=m.exports.useRef(null);m.exports.useImperativeHandle(v,(()=>y.current));const w=m.exports.useRef(null),[C,S]=m.exports.useState(!1),k=()=>{const e=null==y?void 0:y.current.ownerDocument.activeElement;for(const t of null==w?void 0:w.current.children)if(t===e)return!0;return!1},M=C&&a;let I;return e.disabled||(I=void 0!==d?d:-1),u.createElement("div",s(i({},x),{ref:y,onFocus:e=>{e.target===y.current&&S(!0),x.onFocus&&x.onFocus(e)},tabIndex:I,onMouseEnter:e=>{S(!0),x.onMouseEnter&&x.onMouseEnter(e)},onMouseLeave:e=>{S(!1),x.onMouseLeave&&x.onMouseLeave(e)},onKeyDown:e=>{if("Escape"===e.key)return;k()&&e.stopPropagation();const t=y.current.ownerDocument.activeElement;if("ArrowLeft"===e.key&&k()&&y.current.focus(),"ArrowRight"===e.key&&e.target===y.current&&e.target===t){(null==w?void 0:w.current.children[0]).focus()}}}),u.createElement(Bi,{MenuItemProps:h,className:p,ref:b,leftIcon:o,label:r}),u.createElement(rn,i({style:{pointerEvents:"none"},anchorEl:b.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},open:M,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{S(!1)}},g),u.createElement("div",{ref:w,style:{pointerEvents:"auto"}},l)))}));function Gi({onFinish:e}){const{t:t}=v(),[n,a]=m.exports.useState(!1),r=()=>{a(!1),e()};return u.createElement(u.Fragment,null,u.createElement(I,{onClick:()=>{a(!0)}},u.createElement(ut,null,u.createElement(cn,{fontSize:"small"})),u.createElement(dt,null,t("MapAbout"))),u.createElement(_,{open:n,onClose:r},u.createElement(ct,null,t("aboutTitle")),u.createElement(L,{style:{minWidth:"500px",minHeight:"100px"}},u.createElement(R,{variant:"h6"},"Version: 26c741d"),u.createElement(R,{variant:"h6",style:{marginTop:"1rem"}},"LiangWang (wliang@tsari.tsinghua.edu.cn)"),u.createElement("a",{href:"https://ipu-cloud.tsinghua-auto.cn/"},"Report Bugs")),u.createElement(A,null,u.createElement(h,{onClick:()=>r(),color:"primary"},t("yes")))))}Ui.displayName="NestedMenuItem";const Vi={menuFile:Ni,menuGraph:zi,menuView:u.memo(u.forwardRef((function({onEvent:e,config:t,vertex:n,edge:a,meta:r,selectVertex:o,selectColor:l,selectPoints:i,selectPointIndex:s},c){const{t:p}=v(),[d,f]=m.exports.useState(null),[g,E]=m.exports.useState(!1),x=()=>{f(null)},[b,y]=function({config:e,onEvent:t,onFinish:n,vertex:a}){const{t:r}=v(),[o,l]=m.exports.useState(!1),[i,s]=m.exports.useState(!1);return[u.createElement(Ui,{parentMenuOpen:!0,leftIcon:u.createElement(on,{fontSize:"small"}),label:r("MapSelection")},u.createElement(I,{onClick:()=>{l(!0),t("ClearSelection"),t("StartROI"),n()},disabled:o||i},u.createElement(ut,null,u.createElement(ln,{fontSize:"small"})),u.createElement(dt,null,r("VertexSelection"))),u.createElement(I,{onClick:()=>{s(!0),t("ClearSelection"),t("StartROI"),n()},disabled:o||i},u.createElement(ut,null,u.createElement(sn,{fontSize:"small"})),u.createElement(dt,null,r("PointsSelection")))),(n,r,c)=>{if(o){const e=[],n=[];if(l(!1),r&&a){const t=[];for(let e=0;e<r.length-1;e++)t[e]=r[e].clone().project(c);const o=Object.keys(a);for(let r=0;r<o.length;r++){const l=a[o[r]];lo(new Le(l[3],l[7],l[11]).clone().project(c),t)&&(e.push(o[r]),n.push(0))}}t("SetSelectVertex",{selection:e,color:n})}if(i){let o=0;for(const e of Object.keys(n)){const t=n[e];t&&(o+=t.points.length)}const l=new Float32Array(o),i={};let m=0;if(s(!1),r&&a){const o=[];for(let e=0;e<r.length-1;e++)o[e]=r[e].clone().project(c);const s=Object.keys(a);for(let t=0;t<s.length;t++){if(parseInt(s[t])%e.map.step!=0)continue;const r=[],u=n[s[t]];if(null==u)continue;const p=u.points,d=ka(a[s[t]]);for(let t=0;t<p.length;t+=4){const n=new Le(p[t],p[t+1],p[t+2]);(n.applyMatrix4(d),n.z<e.map.zRange.min/10||n.z>e.map.zRange.max/10)||lo(n.clone().project(c),o)&&(r.push(t/4),l[m]=n.x,l[m+1]=n.y,l[m+2]=n.z,l[m+3]=p[t+3],m+=4)}r.length>0&&(i[s[t]]=r)}t("SetSelectPoint",{points:l.slice(0,m),index:i})}}}]}({config:t,onEvent:e,onFinish:x,vertex:n});return m.exports.useImperativeHandle(c,(()=>({onHanleRoi:(e,t,n)=>{y(e,t,n)},onClear:()=>{y({},void 0,void 0)}}))),u.createElement(u.Fragment,null,u.createElement(h,{onClick:e=>{f(e.currentTarget)},color:"inherit"},p("View")),u.createElement(M,{anchorEl:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},open:Boolean(d),onClose:x},u.createElement(Qe,null,u.createElement(Di,{onEvent:e,onFinish:x}),b,u.createElement(ji,{onEvent:e,onFinish:x,vertex:n,selectVertex:o,selectPointIndex:s}),u.createElement(Ti,{onEvent:e,onFinish:x}),u.createElement(Oi,{onClick:()=>{E(!0),x()}}))),g&&u.createElement(Fi,{meta:r,onEvent:e,onClose:()=>{E(!1)}}))}))),menuHelp:u.memo(u.forwardRef((function({onEvent:e,config:t,vertex:n,edge:a,meta:r,selectVertex:o,selectColor:l,selectPoints:i,selectPointIndex:s},c){const{t:p}=v(),[d,f]=m.exports.useState(null),g=()=>{f(null)};return m.exports.useImperativeHandle(c,(()=>({onClear:()=>{}}))),u.createElement(u.Fragment,null,u.createElement(h,{onClick:e=>{f(e.currentTarget)},color:"inherit"},p("Help")),u.createElement(M,{anchorEl:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},open:Boolean(d),onClose:g},u.createElement(Qe,null,u.createElement(Gi,{onFinish:g}))))})))};var Hi=u.memo(u.forwardRef((function({onEvent:e},t){v();const n=m.exports.useRef(),a=m.exports.useRef(),r=m.exports.useRef(),o=m.exports.useRef(),l=[n,a,r,o],[i,s]=m.exports.useState(Ki),[c,p]=m.exports.useState(),[d,f]=m.exports.useState(),[g,h]=m.exports.useState(),[E,x]=m.exports.useState([]),[b,y]=m.exports.useState([]),[w,C]=m.exports.useState(),[S,k]=m.exports.useState({});return m.exports.useImperativeHandle(t,(()=>({onSelectVertex:(e,t)=>{x(e),y(t)},onSelectPoints:(e,t)=>{C(e),k(t)},onConfig:e=>{s(e)},onMapChanged:(e,t,n)=>{p(e),f(t),h(n)},onHanleRoi:(e,t,n)=>{var a;null==(a=r.current)||a.onHanleRoi(e,t,n)},onClear:()=>{var e;for(let t=0;t<l.length;t++)null==(e=l[t].current)||e.onClear()}}))),u.createElement(u.Fragment,null,Object.entries(Vi).map(((t,n)=>{const[a,r]=t;return u.createElement(r,{onEvent:e,config:i,vertex:c,edge:d,meta:g,selectVertex:E,selectColor:b,selectPoints:w,selectPointIndex:S,ref:l[n]})})))})));var qi=u.memo(u.forwardRef((function({onEvent:e,vertex:t,vertexMeta:n,selectVertex:a,selectedVertexColor:r},o){const[l,i]=m.exports.useState({left:0,top:0}),[s,c]=m.exports.useState(!1),[p,d]=m.exports.useState(void 0),[f,g]=m.exports.useState({x:0,y:0,z:0});return m.exports.useImperativeHandle(o,(()=>({onShow:(e,n)=>{const a=t[e];d(e),g({x:a[3],y:a[7],z:a[11]}),(e=>{i({left:e.clientX,top:e.clientY}),c(!0)})(n)}}))),u.createElement(u.Fragment,null,u.createElement(M,{anchorReference:"anchorPosition",anchorPosition:l,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},open:s,onClose:()=>{c(!1)}},p&&n[p]&&u.createElement($i,{info:{id:p,pos:(h=f,"["+h.x.toFixed(2)+", "+h.y.toFixed(2)+", "+h.z.toFixed(2)+"]"),stamp:n[p].stamps.toString(),fix:n[p].fix},onEvent:(t,n)=>{if(p)if("Delete"==t)Na(p).then((()=>{e("ClearSelection"),e("OptimizeMap",!1)}));else if("LoopBegin"==t)a[0]=p,r[0]=16711935,e("SetSelectVertex",{selection:[...a],color:[...r]});else if("LoopEnd"==t)a[1]=p,r[1]=16776960,e("SetSelectVertex",{selection:[...a],color:[...r]});else if("fix"==t)return void Pa(p,n).then((()=>{e("RefreshMap")}));c(!1)}})));var h})));function $i({info:e,setConfig:t,onEvent:n}){const{t:a}=v(),r=m.exports.useRef();return m.exports.useEffect((()=>{const t=new et.exports.Pane({container:r.current});t.on("change",(e=>{"fix"==e.presetKey&&n("fix",e.value)}));const o=t.addFolder({title:a("Vertex"),expanded:!0});o.addMonitor(e,"id",{label:a("id")}),o.addMonitor(e,"pos",{label:a("pos")}),o.addMonitor(e,"stamp",{label:a("stamp")}),o.addInput(e,"fix",{label:a("fix")});let l=o.addButton({title:a("Delete")});return l.on("click",(()=>{n("Delete")})),l=o.addButton({title:a("LoopBegin")}),l.on("click",(()=>{n("LoopBegin")})),l=o.addButton({title:a("LoopEnd")}),l.on("click",(()=>{n("LoopEnd")})),()=>{t.dispose()}}),[a]),u.createElement("div",{className:"info-panel",ref:r})}var Wi=u.memo(u.forwardRef((function({onEvent:e},t){const[n,a]=m.exports.useState({left:0,top:0}),[r,o]=m.exports.useState(!1),[l,i]=m.exports.useState(void 0);return m.exports.useImperativeHandle(t,(()=>({onShow:(e,t)=>{i(e),(e=>{a({left:e.clientX,top:e.clientY}),o(!0)})(t)}}))),u.createElement(u.Fragment,null,u.createElement(M,{anchorReference:"anchorPosition",anchorPosition:n,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},open:r,onClose:()=>{i(void 0),o(!1)}},u.createElement(Yi,{info:{id:l||""},onEvent:t=>{o(!1),l&&"Delete"==t&&async function(e){return(await ea.post("v1/map-del-edge",{id:parseInt(e)})).data}(l).then((()=>{e("OptimizeMap")}))}})))})));function Yi({info:e,setConfig:t,onEvent:n}){const{t:a}=v(),r=m.exports.useRef();return m.exports.useEffect((()=>{const t=new et.exports.Pane({container:r.current});t.on("change",(e=>{}));const o=t.addFolder({title:a("Edge"),expanded:!0});o.addMonitor(e,"id",{label:a("id")});return o.addButton({title:a("Delete")}).on("click",(()=>{n("Delete")})),()=>{t.dispose()}}),[a]),u.createElement("div",{className:"info-panel",ref:r})}const Xi=u.memo((({points:e,color:t})=>u.createElement(oi,{maxNum:e?e.length/4:0,points:e,color:t,size:3,visible:!0}))),Ki={map:{visible:!0,frustumCulled:!1,pose:!0,color:"height",maxIntensity:.75,size:1.5,step:5,zRange:{min:-200,max:200}}};var Zi=u.forwardRef((function({},e){const{t:t}=v(),[n,a]=m.exports.useState(!1),[r,o,l]=Si(),[s,c]=m.exports.useState(!0),[p,d]=w("26c741d-editor-config",Ki),[f,g]=m.exports.useState(p.map.step),[h,E]=m.exports.useState(),x=m.exports.useRef(),b=m.exports.useRef(),y=m.exports.useRef(),C=m.exports.useRef(),[S,k]=m.exports.useState({}),[M,I]=m.exports.useState({}),[N,P]=m.exports.useState({vertex:{},edge:{}}),[R,_]=m.exports.useState({}),[L,A]=m.exports.useState([]),[z,F]=m.exports.useState([]),[O,D]=m.exports.useState(void 0),[T,j]=m.exports.useState(),[B,U]=m.exports.useState({}),[G,V]=m.exports.useState("idle"),H=so(),q=Xt((e=>{e&&Y(),ua().then((()=>{aa().then((e=>{E(e)})),setTimeout((()=>{Ma().then((e=>{e&&k(e)})),async function(){return(await ea.post("api/",{method:"get_map_edge",params:{},jsonrpc:2,id:0})).data.result}().then((e=>{e&&I(e)})),async function(){return(await ea.post("api/",{method:"get_map_meta",params:{},jsonrpc:2,id:0})).data.result}().then((e=>{e&&P(e)}))}),100)}))})),$=Xt((()=>{const e=Object.keys(R);for(let t=0;t<e.length;t++)S.hasOwnProperty(e[t])||(R[e[t]]=void 0)})),W=Xt((async(e,n)=>{$();const r=[];for(let t=0;t<e.length;t++)null==R[e[t]]&&S.hasOwnProperty(e[t])&&r.push(e[t]);const l=r.length>=10;l&&a(!0),l&&o(t("loadingMaps"),"info",1e4);for(let t=0;t<r.length;t++){const e=await Ia(r[t],"pi");R[r[t]]={points:e.points,images:e.images}}return l&&a(!1),l&&o(t("finishLoadingMaps"),"success",2e3),_(i({},R)),n!=f&&g(n),R})),Y=Xt((()=>{k({}),I({}),P({vertex:{},edge:{}}),X()})),X=Xt((()=>{var e;K([],[]),Z(void 0,{}),D(void 0),V("idle"),c(!0),null==(e=x.current)||e.onClear()})),K=Xt(((e,t)=>{var n;W(e,p.map.step),A(e),F(t),null==(n=x.current)||n.onSelectVertex(e,t)})),Z=Xt(((e,t)=>{var n;j(e),U(t),null==(n=x.current)||n.onSelectPoints(e,t)})),J=Xt((()=>{for(const e of Object.keys(B)){const t=R[e];null!=t&&(t.points=t.points.filter(((t,n,a)=>{const r=Math.floor(n/4);return-1==no(B[e],r)})))}_(i({},R)),X()})),Q=Xt(((e,t)=>{"ClearMap"==e?Y():"RefreshMap"==e?q(t||!1):"OptimizeMap"==e?async function(){return(await ea.get("v1/map-optimize")).data}().then((()=>{q(t)})):"StartROI"==e?(V("drawing"),c(!1)):"ShowMessage"==e?null!=t?o(t.message,t.severity,t.duration):l():"ShowLoading"==e?a(t):"ClearSelection"==e?X():"SetSelectVertex"==e?K(t.selection,t.color):"SetSelectPoint"==e?Z(t.points,t.index):"DeleteFramePoints"==e&&J()})),ee=Xt(((e,t,n)=>{var a;const r=Object.keys(S)[e];0!=z[0]&&0!=z[1]||(z[0]=16711935,L[0]="",z[1]=16776960,L[1]=""),T&&Z(void 0,{}),L[2]=r,z[2]=16711680,K(L.slice(0,3),z.slice(0,3)),null==(a=b.current)||a.onShow(r,n)})),te=Xt(((e,t)=>{var n;D(e),null==(n=y.current)||n.onShow(e,t)})),ne=Xt(((e,t)=>{var n;null==(n=x.current)||n.onHanleRoi(R,e,t),c(!0)})),ae=Xt(((e,t)=>{const n=[];for(let a=0;a<e.length;a++)parseInt(e[a])%t==0&&n.push(e[a]);return n})),re=Xt((e=>{var t;null==(t=C.current)||t.onContextClick()}));return m.exports.useEffect((()=>(q(!1),document.body.oncontextmenu=re,()=>{document.body.oncontextmenu=null})),[]),m.exports.useEffect((()=>{if(n)return;const e=Object.keys(S);if(e.length<=0)return void _({});const t=ae(e,p.map.step);W(t,p.map.step)}),[S,p.map.step]),m.exports.useEffect((()=>{if(f!=p.map.step){const e=ae(Object.keys(S),p.map.step);W(e,p.map.step)}}),[R]),m.exports.useEffect((()=>{var e;null==(e=x.current)||e.onConfig(p)}),[p,x.current]),m.exports.useEffect((()=>{var e;null==(e=x.current)||e.onMapChanged(S,M,N)}),[S,M,N,x.current]),m.exports.useImperativeHandle(e,(()=>({menuBar:()=>u.createElement(Hi,{onEvent:Q,ref:x})}))),u.createElement("div",{style:{position:"relative"}},n&&u.createElement(Da,null),r,u.createElement("div",{className:"scene"},u.createElement(Je,{raycaster:{params:{Points:{threshold:1},Line:void 0}}},u.createElement("gridHelper",{args:[5e3,500,1118481,1118481],visible:!0,"rotation-x":Math.PI/2}),u.createElement(zr,{position:[0,0,0],enable:s}),u.createElement(gi,{state:G,setState:V,onFinish:ne,ref:C}),u.createElement(u.Fragment,null,p.map.pose&&u.createElement(hi,{vertexes:S,edges:M,enable:H&&"idle"==G,selectEdge:O,onVertexClick:ee,onEdgeClick:te}),u.createElement(di,{config:p,boardConfig:h,vertexes:S,mapFrame:R,selectedVertex:L,selectedVertexColor:z}),u.createElement(Xi,{points:T,color:16711680})))),u.createElement(ri,i({className:"config-panel"},{config:p,setConfig:d,t:t})),";",u.createElement(fi,{config:p,vertexes:S,selectedVertex:L,selectedVertexColor:z}),u.createElement(qi,{onEvent:Q,vertex:S,vertexMeta:N.vertex,selectVertex:L,selectedVertexColor:z,ref:b}),u.createElement(Wi,{onEvent:Q,ref:y}))}));function Ji(e){return new Promise((t=>setTimeout(t,e)))}const Qi=E((e=>({backdrop:{zIndex:e.zIndex.appBar+1},paper:{position:"absolute",width:340,backgroundColor:e.palette.background.paper,boxShadow:e.shadows[5],padding:e.spacing(2,4,3)},root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}})));function es(){return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}function ts(){const e=Qi(),t=Et(),[n,a]=u.useState(!1),[r,o]=u.useState(0),[l,i]=u.useState(!1),[s,c]=u.useState(!1),[p]=u.useState(es),{t:d}=v(),[f,g]=m.exports.useState(""),{data:E,run:x,cancel:b}=U(ta,{pollingInterval:1e3,loadingDelay:1e3,onSuccess:e=>{"error"!=e.licence&&(a(!0),o(e.time)),b()}}),y=u.createElement("div",{style:p,className:e.paper},u.createElement("div",{className:e.root},u.createElement(mn,{in:l},u.createElement(it,{action:u.createElement(Nt,{"aria-label":"close",color:"inherit",size:"small",onClick:()=>{i(!1)}},u.createElement(Vt,{fontSize:"inherit"}))},d("RegisterSuccess"))),u.createElement(mn,{in:s},u.createElement(it,{severity:"error",action:u.createElement(Nt,{"aria-label":"close",color:"inherit",size:"small",onClick:()=>{c(!1)}},u.createElement(Vt,{fontSize:"inherit"}))},d("RegisterError")))),u.createElement(re,{container:!0},u.createElement(re,{item:!0,xs:1}),u.createElement(re,{item:!0,xs:2},u.createElement(un,{color:n?"primary":"error",fontSize:"large"})),u.createElement(re,{item:!0,xs:8},u.createElement("h1",null,d(n?"Permit":"NoPermit")))),u.createElement("p",null,n?d("LicenceUage")+function(e,t){if(-1==e)return t("Permanent");var n=Math.floor(e/86400),a=Math.floor(e%86400/3600),r=Math.floor(e%3600/60),o=Math.floor(e%60);return(n>0?n+t("Day"):"")+(a>0?a+t("Hour"):"")+(r>0?r+t("Minute"):"")+(o>0?o+t("Second"):"")}(r,d):d("NoPermitDescription")),!n&&u.createElement(oe,{fullWidth:!0,variant:"outlined"},u.createElement(le,null,d("ValidNumber")),u.createElement(pn,{value:f,onChange:e=>{g(e.target.value)}}),u.createElement(h,{style:{marginTop:"1rem"},variant:"outlined",color:"primary",onClick:async()=>{"ok"==await async function(e){return(await ea.post("v1/licence-register",{licence:e})).data}(f)?(i(!0),Ji(2e3).then((()=>{t("/home",{replace:!0})}))):(c(!0),Ji(2e3).then((()=>{c(!1)})))}},d("Register"))));return u.createElement(j,{open:!0,className:e.backdrop},y)}const ns=E((e=>({root:{paddingLeft:"3rem",paddingRight:"-1rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"}}))),as={container:{marginTop:"1rem"}};function rs(){const e=ns(),{t:t}=v(),{data:n}=U(na,{pollingInterval:1e3,loadingDelay:1e3}),a=(e,t)=>{e?async function(e){(await ea.post("v1/remove-blacklist",{ip:e})).data}(t):async function(e){(await ea.post("v1/add-blacklist",{ip:e})).data}(t)};return u.createElement(Z,{maxWidth:"md",style:as.container},u.createElement(S,{mt:"1rem"}),u.createElement(G,{className:e.root,elevation:3},u.createElement(V,{size:"small"},u.createElement(H,null,u.createElement(q,null,u.createElement($,null,u.createElement(R,{variant:"h6"},t("ClientIP"))),u.createElement($,null,u.createElement(R,{variant:"h6"},t("LastConnectTime"))),u.createElement($,null,u.createElement(R,{variant:"h6"},t("RequestCount"))),u.createElement($,null,u.createElement(R,{variant:"h6"},t("Action")))),n&&Object.entries(n.users).map((e=>{const[r,o]=e,l=new Date;return l.setTime(1e3*o.time),u.createElement(q,null,u.createElement($,null,u.createElement(R,{variant:"subtitle1"},n.client_ip==r?t("currentDevice"):r.substr(7))),u.createElement($,null,u.createElement(R,{variant:"subtitle1"},function(e){const t=e.getMonth()+1,n=e.getDate(),a=e.getHours(),r=e.getMinutes(),o=e.getSeconds();return[e.getFullYear(),(t>9?"":"0")+t,(n>9?"":"0")+n].join("-")+" "+[(a>9?"":"0")+a,(r>9?"":"0")+r,(o>9?"":"0")+o].join(":")}(l))),u.createElement($,null,u.createElement(R,{variant:"subtitle1"},o.requests)),u.createElement($,null,u.createElement(W,{control:u.createElement(Y,{onChange:()=>{a(o.disable,r)},checked:!o.disable}),label:o.disable?t("Deny"):t("Allow"),labelPlacement:"end"})))}))))))}const os="xAxis",ls="recharts-cartesian-grid",is=(e,t=.05,n=.25)=>{if(!e)return{zoomLeft:1,zoomRight:1};const{x:a,width:r}=e,o=r*n;let l=a/r;l<=t?l=0:l>=1-t&&(l=1);const i=l*o;return{zoomLeft:i,zoomRight:o-i}},ss=({chartAxisClipPadding:e=50,chartLoaded:t})=>{const n=m.exports.useRef(null),a=m.exports.useRef(null),r=m.exports.useRef(null),o=m.exports.useRef(null),l=m.exports.useRef(null),[c,u]=m.exports.useState([0,0]),[p,d]=m.exports.useState(null),f=m.exports.useCallback((e=>{var t,a;"object"==typeof e&&null!==e&&(a=["current"],!("object"!=typeof(t=e)||null===t||t instanceof Date||t instanceof Array)&&a.every((e=>e in t)))&&e.current instanceof HTMLElement&&(n.current=e.current)}),[]),g=m.exports.useCallback((t=>{var o,l,i,s,c;if(n.current&&r.current&&(null==(l=null==(o=null==a?void 0:a.current)?void 0:o.axis)?void 0:l.current)&&(null==(s=null==(i=null==a?void 0:a.current)?void 0:i.grid)?void 0:s.current)){const o=n.current.getBoundingClientRect(),l=r.current.getBoundingClientRect();console.log(o),a.current.axis.current.setAttribute("width",`${l.width+e}px`),a.current.axis.current.style.transform=`translateX(${l.x-o.x-e/2}px)`,a.current.grid.current.setAttribute("width",`${l.width}px`),a.current.grid.current.style.transform=`translateX(${l.x-o.x}px)`,null==(c=r.current)||c.setAttribute("clip-path","url(#chart-grid-clip)"),t.setAttribute("clip-path","url(#chart-xaxis-clip)")}}),[e]),h=m.exports.useCallback((e=>{if(console.log(e),n.current){const e=n.current.querySelector(`.${os}`);e&&g(e)}}),[g]),E=(({callback:e,element:t,delay:n=0},a=[])=>{const r=t&&t.current,o=m.exports.useRef(),l=m.exports.useRef(null),i=m.exports.useCallback((()=>{t&&t.current&&l.current&&l.current.observe(t.current)}),[t]),s=m.exports.useCallback((()=>{l&&l.current&&t&&t.current&&l.current.unobserve(t.current)}),[l,t]);return m.exports.useEffect((()=>(l&&l.current&&r&&l.current.unobserve(r),l.current=new ResizeObserver((t=>{clearTimeout(o.current),o.current=setTimeout((()=>{e(t)}),n)})),i(),()=>{s()})),[r,t,i,s,e,n,...a]),s})({element:n,callback:h,delay:100});m.exports.useEffect((()=>()=>E()));const v=m.exports.useCallback(((e,t)=>{var n,r;const c=t.target;if(null!==o.current&&((e,t)=>{if(null!==o.current&&(null==e?void 0:e.chartX)&&(null==e?void 0:e.chartY)&&l.current){const t=o.current.x-e.chartX,[n,a]=l.current,r=a+t;if(n-t>0)return void u((([,e])=>[0,e]));if(r>0)return void u((([e])=>[e,0]));u([Math.min(n-t,0),Math.min(a+t,0)])}})(e),c&&(null==(r=null==(n=null==a?void 0:a.current)?void 0:n.axis)?void 0:r.current)){const{width:e,left:n}=a.current.axis.current.getBoundingClientRect(),r=Math.min(Math.max(t.clientX-n,0),e);d((t=>(null==t?void 0:t.width)?s(i({},t),{x:r}):{x:r,width:e}))}}),[]),x=m.exports.useCallback(((e,t)=>{if(e){const{chartX:t,chartY:n}=e;"number"==typeof t&&"number"==typeof n&&(o.current={x:t,y:n},l.current=c)}}),[c]),b=m.exports.useCallback((()=>{o.current=null,l.current=null}),[]);m.exports.useEffect((()=>{if(t&&n.current){const e=n.current.querySelector(`.${ls}`),t=n.current.querySelector(`.${os}`);r.current=e,t&&g(t)}}),[t,g]);const y=m.exports.useCallback((()=>{u((e=>{const[t,n]=e,{zoomRight:a,zoomLeft:r}=is(p);return[Math.min(t+r,0),Math.min(n+a,0)]}))}),[p]),w=m.exports.useCallback((()=>{u((e=>{const[t,n]=e,{zoomRight:a,zoomLeft:r}=is(p);return[t-r,n-a]}))}),[p]);return m.exports.useEffect((()=>{const e=n.current,a=e=>{e.preventDefault();Math.sign(e.deltaY)<0?w():y()};return t&&e&&e.addEventListener("wheel",a,{passive:!1}),()=>{e&&e.removeEventListener("wheel",a)}}),[t,w,y]),{wrapperRef:n,clipPathRefs:a,gridRef:r,xPadding:c,mousePositionToGrid:p,onChartMouseDown:x,onChartMouseUp:b,setWrapperRef:f,onChartMouseMove:v,zoomOut:y,zoomIn:w}},cs={width:500,height:400,margin:{top:25,right:10,left:10,bottom:0}},ms={strokeDasharray:"3 3"},us=m.exports.forwardRef(((e,t)=>{const n=m.exports.useRef(null),a=m.exports.useRef(null);return m.exports.useImperativeHandle(t,(()=>({grid:n,axis:a}))),u.createElement(u.Fragment,null,u.createElement("clipPath",{id:"chart-xaxis-clip"},u.createElement("rect",{fill:"rgba(0,0,0,0)",height:"100%",ref:a})),u.createElement("clipPath",{id:"chart-grid-clip"},u.createElement("rect",{fill:"rgba(0,0,0,0)",height:"100%",ref:n})))})),ps=({data:e,lines:t,chartOptions:n,gridOptions:a,axis:r,tooltip:o,legend:l,title:c})=>{var p,d;const[f,g]=m.exports.useState(!1),{clipPathRefs:h,xPadding:E,onChartMouseDown:v,onChartMouseUp:x,setWrapperRef:b,onChartMouseMove:y}=ss({chartLoaded:f}),{onSeriesMouseOver:w,tooltipSorter:C}=(()=>{const[e,t]=m.exports.useState(null);return{onSeriesMouseOver:m.exports.useCallback((e=>{t(e)}),[]),tooltipSorter:m.exports.useCallback((t=>e===t.dataKey?0:1),[e])}})();return m.exports.useEffect((()=>{setTimeout((()=>{g(!0)}),100)}),[]),u.createElement(dn,{className:"noselect",width:"100%",height:"100%",debounce:100,ref:b},u.createElement(fn,s(i({},s(i({},cs),{margin:i(i({},cs.margin),null==n?void 0:n.margin)})),{data:e,onMouseMove:y,onMouseDown:v,onMouseUp:x}),c&&u.createElement("text",{x:300,y:15,fill:"white"},u.createElement("tspan",{fontSize:"14"},c)),u.createElement("defs",null,u.createElement(us,{ref:h})),u.createElement(gn,i({},s(i(i({},ms),a),{stroke:(null==a?void 0:a.hide)?"transparent":null==a?void 0:a.stroke}))),(null==(p=null==r?void 0:r.x)?void 0:p.hide)?null:u.createElement(hn,s(i({},null==r?void 0:r.x),{padding:{left:E[0],right:E[1]},className:"x-axis"})),(null==(d=null==r?void 0:r.y)?void 0:d.hide)?null:u.createElement(En,i({},null==r?void 0:r.y)),(null==o?void 0:o.hide)?null:u.createElement(vn,s(i({},o),{itemSorter:C})),(null==l?void 0:l.hide)?null:u.createElement(xn,i({},l)),t.map(((e,t)=>u.createElement(bn,s(i({key:`${e.key}-${t}`,id:e.key},e),{className:`${e.className||""}`,activeDot:{onMouseOver:()=>w(String(e.dataKey))},onMouseOver:()=>w(String(e.dataKey))}))))))},ds={maxNum:100,xDomain:["dataMin","dataMax"],yDomain:["auto","auto"]};var fs=u.memo((function({title:e,config:t,data:n,names:a,onContextMenu:r}){const o=["#82ca9d","#8884d8","#ff7300","#413ea0"],[l,i]=m.exports.useState({}),[s,c]=m.exports.useState([]);return m.exports.useEffect((()=>{if(a&&t){i({x:{dataKey:a[0][0],domain:t.xDomain,allowDataOverflow:!0,type:"number"},y:{type:"number",domain:t.yDomain,allowDataOverflow:!0}});let e=[];for(let t=0;t<a.length;t++)e.push({dataKey:a[t][1],strokeWidth:2,dot:{strokeWidth:1},stroke:o[t]});c(e)}}),[a,t]),u.createElement(u.Fragment,null,a&&u.createElement(lt,null,u.createElement("div",{style:{width:"600px",height:"300px"},onContextMenu:e=>{e.preventDefault(),r&&r()}},u.createElement(ps,{data:n,lines:s,axis:l,title:e,tooltip:{allowEscapeViewBox:{x:!0,y:!0}}}))))}));const gs=["Data"];var hs=u.memo((function({name:e,chartList:t,chart:n,setChart:a,chartConfig:r}){v();const[o,l]=m.exports.useState();return U((()=>Aa(e,"")),{pollingInterval:50,onSuccess:o=>{if(null!=o&&""!==o){l(o);let c=n.get(e);if(t&&t.length>0&&c&&r){let l={};"Index"==t[0][0]&&(l=0==c.length?s(i({},l),{Index:0}):s(i({},l),{Index:c[c.length-1].Index+1}));for(let e=0;e<t.length;e++)"Data"==t[e][1]&&(l=s(i({},l),{Data:o}));for(;c.length>r.maxNum;)c.shift();c=[...c,l],n.set(e,c),a(new Map(n))}}}}),u.createElement(u.Fragment,null,u.createElement(oe,{fullWidth:!0,variant:"standard"},u.createElement(pn,{readOnly:!0,value:o,size:"small"})))}));const Es=["Stamp","Gyro X","Gyro Y","Gyro Z","Accel X","Accel Y","Accel Z"];var vs=u.memo((function({name:e,chartList:t,chart:n,setChart:a,chartConfig:r}){v();const[o,l]=m.exports.useState();return U((()=>Aa(e,"Imu")),{pollingInterval:50,onSuccess:o=>{if(null!=o&&""!==o){l(o);let c=n.get(e);if(t&&t.length>0&&c&&r){let l={};const m=[];"Index"==t[0][0]?l=0==c.length?s(i({},l),{Index:0}):s(i({},l),{Index:c[c.length-1].Index+1}):m.push(t[0][0]);for(let e=0;e<t.length;e++)m.push(t[e][1]);for(let e=0;e<m.length;e++)"Stamp"==m[e]?l=s(i({},l),{Stamp:o.stamp}):"Gyro X"==m[e]?l=s(i({},l),{"Gyro X":o.gyro_x}):"Gyro Y"==m[e]?l=s(i({},l),{"Gyro Y":o.gyro_y}):"Gyro Z"==m[e]?l=s(i({},l),{"Gyro Z":o.gyro_z}):"Accel X"==m[e]?l=s(i({},l),{"Accel X":o.acc_x}):"Accel Y"==m[e]?l=s(i({},l),{"Accel Y":o.acc_y}):"Accel Z"==m[e]&&(l=s(i({},l),{"Accel Z":o.acc_z}));for(;c.length>r.maxNum;)c.shift();c=[...c,l],n.set(e,c),a(new Map(n))}}}}),u.createElement(u.Fragment,null,o&&u.createElement("div",{style:{width:"100%"}},u.createElement(oe,{fullWidth:!0,variant:"standard"},u.createElement(se,{fullWidth:!0,label:"Stamp",value:o.stamp,size:"small"})),u.createElement(re,{container:!0},u.createElement(re,{item:!0,md:!0},u.createElement(se,{label:"Gyro X",value:o.gyro_x,size:"small"})),u.createElement(re,{item:!0,md:!0},u.createElement(se,{label:"Gyro Y",value:o.gyro_y,size:"small"})),u.createElement(re,{item:!0,md:!0},u.createElement(se,{label:"Gyro Z",value:o.gyro_z,size:"small"}))),u.createElement(re,{container:!0},u.createElement(re,{item:!0,md:!0},u.createElement(se,{label:"Accel X",value:o.acc_x,size:"small"})),u.createElement(re,{item:!0,md:!0},u.createElement(se,{label:"Accel Y",value:o.acc_y,size:"small"})),u.createElement(re,{item:!0,md:!0},u.createElement(se,{label:"Accel Z",value:o.acc_z,size:"small"})))))}));const xs=["Stamp","Latitude","Longitude","Altitude"];var bs=u.memo((function({name:e,chartList:t,chart:n,setChart:a,chartConfig:r}){v();const[o,l]=m.exports.useState();return U((()=>Aa(e,"NavSatFix")),{pollingInterval:50,onSuccess:o=>{if(null!=o&&""!==o){l(o);let c=n.get(e);if(t&&t.length>0&&c&&r){let l={};const m=[];"Index"==t[0][0]?l=0==c.length?s(i({},l),{Index:0}):s(i({},l),{Index:c[c.length-1].Index+1}):m.push(t[0][0]);for(let e=0;e<t.length;e++)m.push(t[e][1]);for(let e=0;e<m.length;e++)"Stamp"==m[e]?l=s(i({},l),{Stamp:o.stamp}):"Latitude"==m[e]?l=s(i({},l),{Latitude:o.latitude}):"Longitude"==m[e]?l=s(i({},l),{Longitude:o.longitude}):"Altitude"==m[e]&&(l=s(i({},l),{Altitude:o.altitude}));for(;c.length>r.maxNum;)c.shift();c=[...c,l],n.set(e,c),a(new Map(n))}}}}),u.createElement(u.Fragment,null,o&&u.createElement("div",{style:{width:"100%"}},u.createElement(oe,{fullWidth:!0,variant:"standard"},u.createElement(se,{fullWidth:!0,label:"Stamp",value:o.stamp,size:"small"})),u.createElement(re,{container:!0},u.createElement(re,{item:!0,md:!0},u.createElement(se,{label:"Latitude",value:o.latitude,size:"small"})),u.createElement(re,{item:!0,md:!0},u.createElement(se,{label:"Longitude",value:o.longitude,size:"small"})),u.createElement(re,{item:!0,md:!0},u.createElement(se,{label:"Altitude",value:o.altitude,size:"small"})))))}));const ys={open:!1,axis_size:1,queue_size:1},ws=["Stamp","Position[0]","Position[1]","Position[2]","Rotation[0]","Rotation[1]","Rotation[2]"];var Cs=u.memo((function({name:e,config:t,chartList:n,chart:a,setChart:r,chartConfig:o}){v();const[l,c]=m.exports.useState([]);return U((()=>Aa(e,"Odom")),{pollingInterval:50,onSuccess:m=>{if(null!=m&&""!==m){let u=m;const p=new Le(u.position[0],u.position[1],u.position[2]),d=new Ye(u.orientation[0],u.orientation[1],u.orientation[2],u.orientation[3]),f=new Xe;for(f.setFromQuaternion(d);l.length>=t.queue_size;)l.shift();c([...l,{position:p.toArray(),rotation:f.toArray()}]);let g=a.get(e);if(n&&n.length>0&&g&&o){let t={};const l=[];"Index"==n[0][0]?t=0==g.length?s(i({},t),{Index:0}):s(i({},t),{Index:g[g.length-1].Index+1}):l.push(n[0][0]);for(let e=0;e<n.length;e++)l.push(n[e][1]);for(let e=0;e<l.length;e++)"Stamp"==l[e]?t=s(i({},t),{Stamp:u.stamp}):"Position[0]"==l[e]?t=s(i({},t),{"Position[0]":u.position[0]}):"Position[1]"==l[e]?t=s(i({},t),{"Position[1]":u.position[1]}):"Position[2]"==l[e]?t=s(i({},t),{"Position[2]":u.position[2]}):"Rotation[0]"==l[e]?t=s(i({},t),{"Rotation[0]":f.x}):"Rotation[1]"==l[e]?t=s(i({},t),{"Rotation[1]":f.y}):"Rotation[2]"==l[e]&&(t=s(i({},t),{"Rotation[2]":f.z}));for(;g.length>o.maxNum;)g.shift();g=[...g,t],a.set(e,g),r(new Map(a))}}}}),u.createElement(u.Fragment,null,l.map((e=>u.createElement("group",i({},e),u.createElement("axesHelper",{scale:new Le(t.axis_size,t.axis_size,t.axis_size),"material-linewidth":t.axis_size})))))}));const Ss=u.memo((({config:e,message:t,setConfig:n})=>{const{t:a}=v();return u.createElement(u.Fragment,null,u.createElement(_,{open:e.get(t).open,onClose:()=>(()=>{const a=e.get(t);a.open=!1,e.set(t,a),n(new Map(e))})()},u.createElement(ct,null,a("OdometryConfig")),u.createElement(L,null,u.createElement("div",{style:{display:"flex",flexWrap:"wrap",minWidth:"400px",maxWidth:"600px",maxHeight:"500px"}},u.createElement(le,{style:{marginLeft:"6px"}},a("OdometryQueue")),u.createElement(se,{inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:e.get(t).queue_size,onChange:a=>{(a=>{const r=e.get(t);r.queue_size=a,e.set(t,r),n(new Map(e))})(a.target.value)}}),u.createElement(le,{style:{marginLeft:"6px",marginTop:"1rem"}},a("OdometryAxisSize")),u.createElement(se,{inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:e.get(t).axis_size,onChange:a=>{(a=>{const r=e.get(t);r.axis_size=a,e.set(t,r),n(new Map(e))})(a.target.value)}})))))})),ks={open:!1,line_width:3,point_size:.2},Ms=["Stamp"];var Is=u.memo((function({name:e,config:t,chartList:n,chart:a,setChart:r,chartConfig:o}){v();const[l,c]=m.exports.useState([]),p=m.exports.useRef(),d=m.exports.useRef();return U((()=>Aa(e,"Path")),{pollingInterval:50,onSuccess:t=>{if(null!=t&&""!==t){let l=t,m=[];for(let e=0;e<l.pose_stamp.length;e++){const t=new Le(l.position[e][0],l.position[e][1],l.position[e][2]),n=new Ye(l.orientation[e][0],l.orientation[e][1],l.orientation[e][2],l.orientation[e][3]),a=new Xe;a.setFromQuaternion(n),m[e]={position:t.toArray(),rotation:a.toArray()}}c(m);let u=a.get(e);if(n&&n.length>0&&u&&o){let t={};const c=[];"Index"==n[0][0]?t=0==u.length?s(i({},t),{Index:0}):s(i({},t),{Index:u[u.length-1].Index+1}):c.push(n[0][0]);for(let e=0;e<n.length;e++)c.push(n[e][1]);for(let e=0;e<c.length;e++)"Stamp"==c[e]&&(t=s(i({},t),{Stamp:l.stamp}));for(;u.length>o.maxNum;)u.shift();u=[...u,t],a.set(e,u),r(new Map(a))}}}}),m.exports.useEffect((()=>{const e=p.current,t=d.current;if(e&&t&&l){let n=[];for(let e=0;e<l.length;e++)n.push(new Le(l[e].position[0],l[e].position[1],l[e].position[2]));null==e||e.geometry.setFromPoints(n),null==t||t.geometry.setFromPoints(n)}}),[l]),m.exports.useEffect((()=>{const e=p.current,t=d.current;e&&(e.frustumCulled=!1),t&&(t.frustumCulled=!1)}),[]),u.createElement(u.Fragment,null,u.createElement("line",{ref:p},u.createElement("lineBasicMaterial",{color:65382,linewidth:t.line_width})),u.createElement("points",{ref:d},u.createElement("pointsMaterial",{color:16711731,size:t.point_size})))}));const Ns=u.memo((({config:e,message:t,setConfig:n})=>{const{t:a}=v();return u.createElement(u.Fragment,null,u.createElement(_,{open:e.get(t).open,onClose:()=>(()=>{const a=e.get(t);a.open=!1,e.set(t,a),n(new Map(e))})()},u.createElement(ct,null,a("PathConfig")),u.createElement(L,null,u.createElement("div",{style:{display:"flex",flexWrap:"wrap",minWidth:"400px",maxWidth:"600px",maxHeight:"500px"}},u.createElement(le,{style:{marginLeft:"6px"}},a("LineWidth")),u.createElement(se,{inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:e.get(t).line_width,onChange:a=>{(a=>{const r=e.get(t);r.line_width=a,e.set(t,r),n(new Map(e))})(a.target.value)}}),u.createElement(le,{style:{marginLeft:"6px",marginTop:"1rem"}},a("PointSize")),u.createElement(se,{inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:e.get(t).point_size,onChange:a=>{(a=>{const r=e.get(t);r.point_size=a,e.set(t,r),n(new Map(e))})(a.target.value)}})))))}));function Ps({maxNum:e=1e6,points:t,onPointsUpdate:n,color:a="gray",size:r=1,frustumCulled:o=!1,visible:l=!0,zRange:c={min:-1e4,max:1e4},pointsProps:p}){const d=Ue((()=>new qe(new Float32Array(3*e),3)),[e]),f=Ue((()=>new qe(new Float32Array(3*e),3)),[e]);m.exports.useEffect((()=>{if(t&&l){let e=[];if("intensity"==t.type&&"intensity"==a)for(let n=0;n<t.attr.length;n++){let a=4*Math.min(1,Math.max(0,t.attr[n]/1))+1,r=Math.floor(a),o=a-r;1&r&&(o=1-o);let l,i,s,c=1-o;r<=1?(l=0,i=c,s=1):2==r?(l=0,i=1,s=c):3==r?(l=c,i=1,s=0):(l=1,i=c,s=0),e[3*n+0]=l,e[3*n+1]=i,e[3*n+2]=s}else if("rgb"==t.type&&"rgb"==a)for(let n=0,a=0;n<t.attr.length;n+=4,a+=3)e[a+0]=t.attr[n+2]/255/2,e[a+1]=t.attr[n+1]/255/2,e[a+2]=t.attr[n+0]/255/2;d.set(t.points),d.count=t.points.length/3,f.set(e),f.count=e.length/3,d.needsUpdate=!0,f.needsUpdate=!0}else d.count=0,f.count=0,d.needsUpdate=!0,f.needsUpdate=!0;n&&n()}),[t,l]);const g=m.exports.useRef(),h=Ue((()=>{const e=c.max>1e3?4:c.max/10,t=c.min<-1e3?-2:c.min/10;return{pointSize:{value:r},heightColor:{value:[e,t]}}}),[]);return m.exports.useEffect((()=>{const e=g.current;if(e&&e.uniforms){const t=c.max>1e3?4:c.max/10,n=c.min<-1e3?-2:c.min/10;e.uniforms.pointSize.value=r,e.uniforms.heightColor.value=[t,n]}}),[r,c.min,c.max]),u.createElement("points",i({frustumCulled:o},p),u.createElement("bufferGeometry",{attributes:{position:d,color:f}}),"gray"!==a&&"intensity"!==a&&"rgb"!==a?u.createElement("shaderMaterial",s(i({ref:g},{clippingPlanes:[new We(new Le(0,0,-1),c.max/10),new We(new Le(0,0,1),-c.min/10)],vertexShader:Gr,fragmentShader:"depth"===a?Vr:Hr,uniforms:h}),{clipping:!0,onUpdate:e=>{e.needsUpdate=!0}})):"gray"===a?u.createElement("pointsMaterial",i({key:"gray"},{size:r,sizeAttenuation:!1,color:210734991,clippingPlanes:[new We(new Le(0,0,-1),c.max/10),new We(new Le(0,0,1),-c.min/10)]})):u.createElement("pointsMaterial",i({key:"color"},{size:r,sizeAttenuation:!1,vertexColors:!0,clippingPlanes:[new We(new Le(0,0,-1),c.max/10),new We(new Le(0,0,1),-c.min/10)]})))}const Rs={open:!1,color:"height",size:1.5},_s=["Number"];var Ls=u.memo((function({name:e,config:t,chartList:n,chart:a,setChart:r,chartConfig:o}){v();const[l,c]=m.exports.useState();return U((()=>Aa(e,"PointCloud")),{pollingInterval:50,onSuccess:t=>{if(null!=t&&null!=t.points){c(t);let l=a.get(e);if(n&&n.length>0&&l&&o){let c={};const m=[];"Index"==n[0][0]?c=0==l.length?s(i({},c),{Index:0}):s(i({},c),{Index:l[l.length-1].Index+1}):m.push(n[0][0]);for(let e=0;e<n.length;e++)m.push(n[e][1]);for(let e=0;e<m.length;e++)"Stamp"==m[e]?c=s(i({},c),{Stamp:0}):"Number"==m[e]&&(c=s(i({},c),{Number:t.points.length/3}));for(;l.length>o.maxNum;)l.shift();l=[...l,c],a.set(e,l),r(new Map(a))}}}}),u.createElement(Ps,{maxNum:1e6,color:t.color,size:t.size,points:l})}));const As=u.memo((({config:e,message:t,setConfig:n})=>{const{t:a}=v();return u.createElement(u.Fragment,null,u.createElement(_,{open:e.get(t).open,onClose:()=>(()=>{const a=e.get(t);a.open=!1,e.set(t,a),n(new Map(e))})()},u.createElement(ct,null,a("SetCloudMessageConfig")),u.createElement(L,null,u.createElement("div",{style:{display:"flex",flexWrap:"wrap",minWidth:"400px",maxWidth:"600px",maxHeight:"500px"}},u.createElement(le,{style:{marginLeft:"6px"}},a("color")),u.createElement(ie,{fullWidth:!0,value:e.get(t).color,onChange:a=>{(a=>{const r=e.get(t);r.color=a,e.set(t,r),n(new Map(e))})(a.target.value)}},u.createElement(I,{value:"gray"},a("gray")),u.createElement(I,{value:"depth"},a("depth")),u.createElement(I,{value:"height"},a("height")),u.createElement(I,{value:"intensity"},a("intensity")),u.createElement(I,{value:"rgb"},a("rgb"))),u.createElement(le,{style:{marginLeft:"6px",marginTop:"1rem"}},a("size")),u.createElement(se,{inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:e.get(t).size,onChange:a=>{(a=>{const r=e.get(t);r.size=a,e.set(t,r),n(new Map(e))})(a.target.value)}})))))})),zs=[""];var Fs=u.memo((function({name:e,index:t}){v();const[n,a]=m.exports.useState(void 0);return U((()=>Aa(e,"CompressedImage")),{pollingInterval:50,onSuccess:e=>{null!=e&&""!==e&&a(e)}}),u.createElement(u.Fragment,null,n&&u.createElement("div",{style:{position:"absolute",right:"48%",top:60+220*t}},u.createElement(xo,{name:e,imageData:n,numCamera:4})))}));const Os=[""];var Ds=u.memo((function({name:e,index:t}){v();const[n,a]=m.exports.useState(void 0);return U((()=>Aa(e,"Image")),{pollingInterval:50,onSuccess:e=>{null!=e&&""!==e&&a(e)}}),u.createElement(u.Fragment,null,n&&u.createElement("div",{style:{position:"absolute",right:"48%",top:60+220*t}},u.createElement(xo,{name:e,imageData:n,numCamera:4})))}));const Ts=E((e=>Ce({container:{display:"flex",flexWrap:"wrap",minWidth:300,maxWidth:500,maxHeight:500}})));function js({}){var e,t;const{t:n}=v(),a=Ts(),[r,o]=m.exports.useState(),[l,s]=m.exports.useState(!1),[c,p]=m.exports.useState(!1),[d,f]=m.exports.useState(!1),[g,E]=m.exports.useState(),[x,b]=m.exports.useState(void 0),[y,w]=m.exports.useState(new Map),[C,k]=m.exports.useState(new Map),[M,N]=m.exports.useState(new Map),[P,R]=m.exports.useState(new Map),[z,F]=m.exports.useState(new Map),[O,D]=m.exports.useState(new Map),[T,j]=m.exports.useState(new Map),[B,G]=m.exports.useState(void 0),[V,H]=m.exports.useState(""),[q,$]=m.exports.useState(""),[W,Y]=m.exports.useState(ds),[X,K]=m.exports.useState([]),[Z,J]=m.exports.useState([]);U(La,{pollingInterval:2e3,onSuccess:e=>{E(e)},onError:()=>{E(void 0)}});const Q=e=>{if(p(!1),e&&g&&null!=x){let e;"Odometry"==g.types[x]?e=JSON.parse(JSON.stringify(ys)):"Path"==g.types[x]?e=JSON.parse(JSON.stringify(ks)):"PointCloud"==g.types[x]&&(e=JSON.parse(JSON.stringify(Rs)));let t=[];["Byte","Float","Int32","Int64","String"].includes(g.types[x])?t=gs:"Imu"==g.types[x]?t=Es:"NavSatFix"==g.types[x]?t=xs:"Odometry"==g.types[x]?t=ws:"Path"==g.types[x]?t=Ms:"PointCloud"==g.types[x]?t=_s:"CompressedImage"==g.types[x]?t=zs:"Image"==g.types[x]&&(t=Os),y.set(g.channels[x],g.types[x]),w(new Map(y)),M.set(g.channels[x],!0),N(new Map(M)),C.set(g.channels[x],e),k(new Map(C)),P.set(g.channels[x],t),R(new Map(P))}},ee=e=>{let t=z.get(e),n=[],a=T.get(e);null!=t&&null!=a||(t=[],a=JSON.parse(JSON.stringify(ds)));for(let r=0;r<t.length;r++)n[r]="X: "+t[r][0]+"  Y: "+t[r][1];K(t),J(n),Y(a)},te=()=>{H(""),$("")},ne=e=>{e&&B&&X.length>0&&(z.set(B,X),null==O.get(B)&&O.set(B,[]),T.set(B,JSON.parse(JSON.stringify(W))),F(new Map(z)),D(new Map(O)),j(new Map(T))),f(!1),G(void 0),K([]),J([]),te()};let ae=()=>{sa().then((e=>{"Paused"==(null==e?void 0:e.status)?s(!0):s(!1)})),aa().then((e=>{o(e)})).catch((()=>o(void 0)))};window.onkeyup=e=>{" "===e.key&&s(!l)},m.exports.useEffect((()=>(ae(),async function(){await ea.get("v1/start-message-subscribe")}(),()=>{!async function(){await ea.get("v1/stop-message-subscribe")}()})),[]);let oe=u.useMemo((()=>r&&"offline"==r.input.mode&&u.createElement(So,{className:"tviz-play",currentFile:r.input.data_path,pause:l,setPause:s,onPlay:ae})),[r,l,s]),ce=0;return u.createElement(u.Fragment,null,u.createElement("div",{style:{position:"relative"}},u.createElement("div",{className:"tviz-right"},u.createElement(Je,null,u.createElement("gridHelper",{args:[500,50,1118481,1118481],visible:!0,"rotation-x":Math.PI/2}),u.createElement(zr,{position:[0,0,0],enable:!0}),Array.from(y).map((([e,t])=>{if(0!=M.get(e))return"Odometry"==t?u.createElement(Cs,{key:e,name:e,config:C.get(e),chartList:z.get(e),chart:O,setChart:D,chartConfig:T.get(e)}):"Path"==t?u.createElement(Is,{key:e,name:e,config:C.get(e),chartList:z.get(e),chart:O,setChart:D,chartConfig:T.get(e)}):"PointCloud"==t?u.createElement(Ls,{key:e,name:e,config:C.get(e),chartList:z.get(e),chart:O,setChart:D,chartConfig:T.get(e)}):void 0}))))),u.createElement("div",{className:"tviz-left"},u.createElement(re,{item:!0,xs:12,md:6},u.createElement(yn,{dense:!1},Array.from(y).map((([e,t])=>{let n;if(["Byte","Float","Int32","Int64","String"].includes(t))n=u.createElement(hs,{name:e,chartList:z.get(e),chart:O,setChart:D,chartConfig:T.get(e)});else if("Imu"==t)n=u.createElement(vs,{name:e,chartList:z.get(e),chart:O,setChart:D,chartConfig:T.get(e)});else if("NavSatFix"==t)n=u.createElement(bs,{name:e,chartList:z.get(e),chart:O,setChart:D,chartConfig:T.get(e)});else if("Odometry"==t)n=u.createElement(Ss,{config:C,message:e,setConfig:k});else if("Path"==t)n=u.createElement(Ns,{config:C,message:e,setConfig:k});else if("PointCloud"==t)n=u.createElement(As,{config:C,message:e,setConfig:k});else if("CompressedImage"==t)n=u.createElement("div",null);else{if("Image"!=t)return;n=u.createElement("div",null)}return u.createElement("div",{key:e},u.createElement(mt,{style:{marginBottom:"-0.5rem"},secondaryAction:u.createElement(Nt,{edge:"end","aria-label":"delete",onClick:()=>(e=>{y.delete(e),M.delete(e),C.delete(e),P.delete(e),w(new Map(y)),N(new Map(M)),k(new Map(C)),R(new Map(P)),z.delete(e),O.delete(e),T.delete(e),F(new Map(z)),D(new Map(O)),j(new Map(T))})(e)},u.createElement(pe,{fontSize:"large",color:"primary"}))},u.createElement(dt,{primary:u.createElement("div",{style:{width:"60%"}},u.createElement(h,{onContextMenu:t=>{t.preventDefault(),M.get(e)&&(e=>{const t=C.get(e);g&&t&&(t.open=!0,C.set(e,t),k(new Map(C)))})(e)},onDoubleClick:()=>{null!=M.get(e)&&(M.set(e,!M.get(e)),N(new Map(M)))},variant:"contained",color:M.get(e)?"primary":"warning",style:{justifyContent:"flex-start"},fullWidth:!0,startIcon:u.createElement(sn,null)},"/"+e))})),M.get(e)&&u.createElement(mt,null,n),u.createElement(Rt,{style:{marginTop:"0rem"}}))}))))),u.createElement(_,{open:c,onClose:()=>Q(!1)},u.createElement(ct,null,n("AddMessage")),u.createElement(L,null,u.createElement("div",{className:a.container},g&&g.channels&&g.channels.map(((e,t)=>{if(!y.has(e))return u.createElement(mt,{key:t,button:!0,onClick:()=>b(t),selected:x==t},u.createElement(ut,null,u.createElement(sn,null)),u.createElement(dt,{primary:e,secondary:g.types[t]}))})))),u.createElement(A,null,u.createElement(h,{onClick:()=>{f(!0),Q(!1)},color:"primary",variant:"contained"},n("AddChart")),u.createElement(S,{flexGrow:1}),u.createElement(h,{onClick:()=>Q(!1),color:"primary",variant:"contained"},n("no")),u.createElement(h,{onClick:()=>Q(!0),color:"primary",variant:"contained"},n("yes")))),u.createElement(_,{open:d,onClose:()=>ne(!1)},u.createElement(ct,null,n("ChartConfig")),u.createElement(L,null,u.createElement("div",{style:{display:"flex",flexWrap:"wrap",minWidth:"500px",maxWidth:"500px",maxHeight:"500px"}},u.createElement(le,{style:{marginLeft:"6px"}},n("selectMessage")),u.createElement(ie,{fullWidth:!0,size:"small",value:B,onChange:e=>{G(e.target.value),ee(e.target.value),te()}},Array.from(y).map((([e,t])=>u.createElement(I,{value:e},e)))),u.createElement(le,{style:{marginLeft:"6px",marginTop:"1rem"}},n("charXData")),u.createElement(ie,{fullWidth:!0,size:"small",value:V,onChange:e=>{H(e.target.value)}},B&&(null==(e=P.get(B))?void 0:e.map((e=>u.createElement(I,{value:e},e)))),B&&u.createElement(I,{value:"Index"},"Index")),u.createElement(le,{style:{marginLeft:"6px",marginTop:"1rem"}},n("charYData")),u.createElement(ie,{fullWidth:!0,size:"small",value:q,onChange:e=>{$(e.target.value)}},B&&(null==(t=P.get(B))?void 0:t.map((e=>u.createElement(I,{value:e},e))))),u.createElement(le,{style:{marginLeft:"6px",marginTop:"1rem",marginBottom:"-0.5rem"}},n("charDataViz")),u.createElement("div",{style:{width:"100%",marginTop:"0.5rem"}},u.createElement(he,{multiple:!0,size:"small",options:[],value:Z,readOnly:!0,renderInput:e=>u.createElement(se,i({},e))})),u.createElement(le,{style:{marginLeft:"6px",marginTop:"1rem"}},n("chartWidth")),u.createElement(se,{size:"small",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:W.maxNum,onChange:e=>{W.maxNum=parseInt(e.target.value),Y(i({},W))}}),u.createElement(le,{style:{marginLeft:"6px",marginTop:"1rem",marginBottom:"-0.5rem"}},n("chartDomain")),u.createElement(re,{container:!0},u.createElement(re,{item:!0,md:!0},u.createElement(se,{size:"small",label:"x Min",value:W.xDomain[0],onChange:e=>{let t=parseFloat(e.target.value);W.xDomain[0]=isNaN(t)?e.target.value:t,Y(i({},W))}})),u.createElement(re,{item:!0,md:!0},u.createElement(se,{size:"small",label:"x Max",value:W.xDomain[1],onChange:e=>{let t=parseFloat(e.target.value);W.xDomain[1]=isNaN(t)?e.target.value:t,Y(i({},W))}})),u.createElement(re,{item:!0,md:!0},u.createElement(se,{size:"small",label:"y Min",value:W.yDomain[0],onChange:e=>{let t=parseFloat(e.target.value);W.yDomain[0]=isNaN(t)?e.target.value:t,Y(i({},W))}})),u.createElement(re,{item:!0,md:!0},u.createElement(se,{size:"small",label:"y Max",value:W.yDomain[1],onChange:e=>{let t=parseFloat(e.target.value);W.yDomain[1]=isNaN(t)?e.target.value:t,Y(i({},W))}}))))),u.createElement(A,null,u.createElement(h,{onClick:()=>{if(B&&""!==V&&""!==q){X.length>0&&X[0][0]!=V&&(X.splice(0,X.length),Z.splice(0,Z.length));const e=[V,q],t="X: "+V+"  Y: "+q;K([...X,e]),J([...Z,t]),O.get(B)&&O.set(B,[])}},color:"primary",variant:"contained"},n("AddAxisData")),u.createElement(S,{flexGrow:1}),u.createElement(h,{onClick:()=>ne(!1),color:"primary",variant:"contained"},n("no")),u.createElement(h,{onClick:()=>ne(!0),color:"primary",variant:"contained"},n("yes")))),Array.from(O).map((([e,t],n)=>u.createElement("div",{key:e,style:{position:"fixed",top:300*n+100,left:"0"}},u.createElement(fs,{title:e,config:T.get(e),data:t,names:z.get(e),onContextMenu:()=>{f(!0),G(e),ee(e),te()}})))),Array.from(y).map((([e,t])=>{if(0!=M.get(e))return"CompressedImage"==t?(ce+=1,u.createElement(Fs,{key:e,name:e,index:ce-1})):"Image"==t?(ce+=1,u.createElement(Ds,{key:e,name:e,index:ce-1})):void 0})),oe,u.createElement(pr,{onClick:()=>{b(void 0),p(!0)}},u.createElement(wn,null)))}const Bs={config:function(){var e,t;const{t:n}=v(),[a,r]=m.exports.useState(0),o=m.exports.useRef(null),l=m.exports.useRef(null),s=m.exports.useRef(null),c=m.exports.useRef(null),p=m.exports.useRef(null),d=m.exports.useRef(null),f=m.exports.useRef(null),g=m.exports.useRef(null),h=m.exports.useRef(null),[E,x]=m.exports.useState(!1),b=ke((e=>e.avfuns)),y=Me(),[w,C]=m.exports.useState(dr.avfuns.config);m.exports.useEffect((()=>{const e=Er();y(e)}),[]),m.exports.useEffect((()=>{"object"==typeof b&&C(b.config)}),[b]);const{data:S,error:k,loading:M,run:I,cancel:N}=U(aa,{pollingInterval:1e3,loadingDelay:1e3,manual:!0,onSuccess:()=>{N(),x(!1)}}),P=S;m.exports.useEffect((()=>{I()}),[]);const _=U(sa,{pollingInterval:1e3,loadingDelay:1e3}).data,L=async()=>{var e;try{if(!P)throw new Error("Empty config!");if(o.current&&(null==P?void 0:P.pipeline)){if(!o.current.isValid)throw new Error;P.pipeline=o.current.validationSchema.cast(o.current.values)}if(l.current&&(null==P?void 0:P.lidar)){if(!l.current.isValid)throw new Error;const e=l.current.validationSchema.cast(l.current.values);e&&(P.lidar=e)}if(c.current&&(null==P?void 0:P.radar)){if(!c.current.isValid)throw new Error;const e=c.current.validationSchema.cast(c.current.values);e&&(P.radar=e)}if(p.current&&(null==P?void 0:P.ins)){if(!p.current.isValid)throw new Error;const e=p.current.validationSchema.cast(p.current.values);e&&(P.ins=e)}if(s.current&&(null==P?void 0:P.camera)){if(!s.current.isValid)throw new Error;P.camera=s.current.validationSchema.cast(s.current.values),P.camera=[...P.camera];let e=P.camera;e.map((({output_width:t,output_height:n},a)=>{let r=parseInt(t),o=parseInt(n);Number.isNaN(r)||Number.isNaN(o)?(e[a]=i({},e[a]),delete e[a].output_width,delete e[a].output_height):(e[a].output_width=r,e[a].output_height=o),P.camera[a]=i({},e[a])}))}if(d.current&&(null==P?void 0:P.output)){if(!d.current.isValid)throw new Error;P.output=d.current.validationSchema.cast(d.current.values),P.output=i({},P.output)}if(f.current&&(null==P?void 0:P.slam)){if(!f.current.isValid)throw new Error;P.slam=f.current.validationSchema.cast(f.current.values),P.slam=i({},P.slam)}if(g.current&&(null==P?void 0:P.output)){if(!g.current.isValid)throw new Error;const e=g.current.validationSchema.cast(g.current.values);P.output.protocol=i({},e.protocol),P.output.localization=i({},e.localization)}if(h.current&&(null==(e=null==P?void 0:P.output)?void 0:e.point_cloud)){if(!h.current.isValid)throw new Error;const e=h.current.validationSchema.cast(h.current.values);e&&(P.output.point_cloud=e.lidar,P.ins.relay=e.ins)}x(!0);const t=await ra(P);x(!1);const a=t.status;D(n("configUpdated"),2e3),"Reboot"===a&&F()}catch(t){console.log(t),D(n("invalidConfig"),1e3)}},A=(e,t)=>{r(t),I()},[z,F]=Tn({content:n("needReboot"),onConfirm:async()=>{D(n("doReboot"));const e=await _a(!0);if(e.hostname){let t=`http://${e.hostname}`;const n=window.location.host.split(":")[1];t+=null==n?"":`:${n}`,window.location.href=t}},onCancel:async()=>{await _a(!1),await I()}}),[O,D]=jn();let T=null,j=0;if(M||k||E)T=u.createElement(Da,null);else{const r={device:w.device&&(null==P?void 0:P.board)&&(null==P?void 0:P.pipeline)&&u.createElement(u.Fragment,null,u.createElement(Xa,{ref:o,initialValues:null==P?void 0:P.pipeline,t:n})),lidar:w.lidar&&(null==P?void 0:P.lidar_all)&&(null==P?void 0:P.lidar)&&u.createElement(Za,{ref:l,lidarDefaultArray:null==P?void 0:P.lidar_all,initialValues:null==P?void 0:P.lidar,t:n,status:_}),camera:w.camera&&(null==P?void 0:P.camera)&&u.createElement(Qa,{ref:s,initialValues:null==P?void 0:P.camera,t:n,status:_}),radar:w.radar&&(null==P?void 0:P.radar_all)&&(null==P?void 0:P.radar)&&u.createElement(tr,{ref:c,radarDefaultArray:null==P?void 0:P.radar_all,initialValues:null==P?void 0:P.radar,t:n,status:_}),ins:w.ins&&(null==P?void 0:P.ins)&&u.createElement(ar,{ref:p,initialValues:null==P?void 0:P.ins,t:n}),detect:w.detect&&(null==P?void 0:P.output)&&u.createElement(or,{ref:d,initialValues:null==P?void 0:P.output,t:n}),slam:w.slam&&(null==P?void 0:P.slam)&&u.createElement(ir,{ref:f,initialValues:null==P?void 0:P.slam,config:P,t:n}),output:w.output&&(null==P?void 0:P.output)&&u.createElement(cr,{ref:g,initialValues:null==P?void 0:P.output,t:n}),advance:w.advance&&(null==(e=null==P?void 0:P.output)?void 0:e.point_cloud)&&u.createElement(ur,{ref:h,initialValues:{lidar:null==(t=null==P?void 0:P.output)?void 0:t.point_cloud,ins:P.ins.relay},t:n})};T=u.createElement("div",{style:{display:"flex",width:"100%"}},u.createElement(Ie,{style:{flex:"1",minHeight:window.innerHeight-64}},u.createElement(vr,{orientation:"vertical",variant:"scrollable",value:a,onChange:A},w.device&&u.createElement(xr,{label:u.createElement(R,{variant:"subtitle1"},n("device"))}),w.lidar&&u.createElement(xr,{label:u.createElement(R,{variant:"subtitle1"},n("lidar"))}),w.camera&&u.createElement(xr,{label:u.createElement(R,{variant:"subtitle1"},n("camera"))}),w.radar&&u.createElement(xr,{label:u.createElement(R,{variant:"subtitle1"},n("radar"))}),w.ins&&u.createElement(xr,{label:u.createElement(R,{variant:"subtitle1"},n("ins"))}),w.detect&&u.createElement(xr,{label:u.createElement(R,{variant:"subtitle1"},n("detect"))}),w.slam&&u.createElement(xr,{label:u.createElement(R,{variant:"subtitle1"},n("slam"))}),w.output&&u.createElement(xr,{label:u.createElement(R,{variant:"subtitle1"},n("output"))}),w.advance&&u.createElement(xr,{label:u.createElement(R,{variant:"subtitle1"},n("advance"))}))),u.createElement("div",{style:{flex:"8"}},u.createElement(Z,{maxWidth:"md",style:{marginLeft:"0rem"}},Object.entries(r).map((e=>{const[t,n]=e;if(n)return j++,u.createElement("div",{hidden:j-1!=a,style:{marginTop:"1rem"}},u.createElement(Ie,{defaultExpanded:!0,key:t,elevation:3},u.createElement(Ne,null,u.createElement("div",null,n))))})),u.createElement(pr,{onClick:L},u.createElement(Pe,null)),z,O)))}return T},preview:function({dev:e=!1,dt:t=10}){const{t:n}=v(),a=Et(),[r,o]=Ue((()=>[new to("data"),new to("display")]),[]),[l,c]=m.exports.useState(!1),[u,p]=m.exports.useState(!1),[d,f]=m.exports.useState(),[g,h]=m.exports.useState(),[E,x]=m.exports.useState(),[b,y]=m.exports.useState(),[C,S]=m.exports.useState([]),[k,M]=m.exports.useState(!1),[I,N]=yo();let P=()=>{x(void 0),y(void 0),sa().then((e=>{"Paused"==(null==e?void 0:e.status)?c(!0):c(!1)})),aa().then((e=>{wa(e.ins.extrinsic_parameters).then((e=>{h(e)})),G(e),H("Detect");for(let t=0;t<e.pipeline.length;t++)for(let n=0;n<e.pipeline[t].length;n++)if("SLAM"==e.pipeline[t][n]){H("SLAM");break}})).catch((()=>G(void 0)))};U((()=>ba(T.object.showOnImage,T.pointcloud.sampleStep)),{pollingInterval:t,manual:!1,onSuccess:async e=>{var t;if(u||(p(!0),R()),r.hit(),e&&e.pose){"drawing"==Z&&(e.pose.x=X[0],e.pose.y=X[1],e.pose.z=X[2],e.pose.roll=X[3],e.pose.pitch=X[4],e.pose.heading=X[5]);const t=new Le(e.pose.x,e.pose.y,e.pose.z),n=new Ye,a=new Le(1,1,1),r=new Xe(.01745329251994*e.pose.roll,.01745329251994*e.pose.pitch,.01745329251994*-e.pose.heading,"XYZ");n.setFromEuler(r),n.set(n.y,n.x,n.z,n.w);const o=new O;o.compose(t,n,a),g&&o.multiply(g);o.clone().invert().decompose(t,n,a),r.setFromQuaternion(n),y({position:t.toArray(),rotation:r.toArray()}),T.camera.type!=Ar.SELF&&(e.points=ao(e.points,o)),o.decompose(t,n,a),r.setFromQuaternion(n),x({position:t.toArray(),rotation:r.toArray()})}(null==(t=e.header)?void 0:t.timestamp)&&f(e)},onError:()=>{p(!1),x(void 0),y(void 0)}}),window.onkeyup=e=>{" "===e.key?c(!l):"f"===e.key&&"SLAM"==V?async function(){return(await ea.post("v1/revert-floor-constraint",{})).data}().then((e=>{N(n("enable"==e?"ActiveFloorContraint":"DeactiveFloorContraint"))})):"Escape"===e.key&&J("idle")};let R=()=>{P(),async function(){const e=(await ea.get("v1/roi")).data;return 0===e.length?{roi:[],inside:!0}:{roi:e[0].contour,inside:e[0].include}}().then((({roi:e,inside:t})=>{var n;L(e.map((e=>({x:e[0],y:e[1],z:0})))),0!=e.length?z(t?"in":"out"):(z(null),D("drawing"),null==(n=q.current)||n.start())}))};const[_,L]=m.exports.useState([]),[A,z]=m.exports.useState(null),[F,D]=m.exports.useState("idle"),[T,j]=w("26c741d-config",Kr),[B,G]=m.exports.useState(),[V,H]=m.exports.useState("Detect"),q=m.exports.useRef(),$=so();let W=m.exports.useMemo((()=>m.exports.createElement(Jr,{enabled:$&&"Detect"==V,roi:_,state:F,onChange:L,onStart:()=>{D("drawing"),z(null)},onEnd:e=>D(e),ref:q})),[$,_,F,q,V]),Y=m.exports.useMemo((()=>m.exports.createElement(Eo,{roi:_,inside:"in"===A,visible:"idle"===F&&null!==A})),[_,A,F]);const[X,K]=m.exports.useState([0,0,0,0,0,0,0]),[Z,J]=m.exports.useState("idle"),Q=m.exports.useRef();let ee,te=m.exports.useMemo((()=>m.exports.createElement(Qr,{enabled:"SLAM"==V,state:Z,setPose:K,onStart:()=>{J("drawing")},onEnd:(e,t)=>{J(e),N(n("setInitPoseOk")),t||async function(e){(await ea.post("v1/set-init-pose",{pose_range:e})).data}([X[0],X[1],X[2],-X[5],X[4],X[3]])},ref:Q})),[X,Z,Q,V]),ne={redraw:()=>{var e;null==(e=q.current)||e.start(),L([]),oa([],!0)},roiSegIn:()=>{z("in"),oa(_.map((e=>[e.x,e.y])),!0)},roiSegOut:()=>{z("out"),oa(_.map((e=>[e.x,e.y])),!1)}};ee=B&&"mapping"==B.slam.mode?{restartMapping:()=>{(async function(){return await ea.get("v1/restart-mapping")})().then((()=>{P()}))},saveMap:()=>{la().then((e=>{"ok"==e&&(c(!0),M(!0))}))}}:{},ee.mapEditor=()=>{a("/editor",{replace:!0})};let ae=()=>{var e;N(n("startEstimationInitPose")),null==(e=Q.current)||e.start()},re=m.exports.useMemo((()=>"intensity"==T.pointcloud.color?m.exports.createElement($r,s(i({maxNum:1e6,points:null==d?void 0:d.points},T&&T.pointcloud),{onPointsUpdate:()=>o.hit()})):m.exports.createElement(qr,s(i({maxNum:1e6,points:null==d?void 0:d.points},T&&T.pointcloud),{onPointsUpdate:()=>o.hit()}))),[d,T]);m.exports.useEffect((()=>{const e=null==d?void 0:d.radar;let t=[];null!=e&&(t=Object.values(e).flat()),S(t)}),[d]);let oe=m.exports.useMemo((()=>m.exports.createElement(m.exports.Fragment,null,C.map((e=>m.exports.createElement(Mr,{object:e,planeVisible:!0,visible:T.radar.visible,showArrow:!1,colorType:"objectType"}))))),[d,T]),le=m.exports.useMemo((()=>m.exports.createElement(Zr,{frameData:d,rangeDrawer:te,config:T,props:E,invProps:b,pointView:re,showMessage:N},W,Y,oe)),[d,T,W,te,Y]),ie=m.exports.useMemo((()=>m.exports.createElement(mo,i({className:"config-panel"},{config:T,setConfig:j,t:n}))),[T,n]),se=m.exports.useMemo((()=>(null==d?void 0:d.images)&&m.exports.createElement(vo,{imageData:null==d?void 0:d.images})),[d]),ce=m.exports.useMemo((()=>"Detect"==V?m.exports.createElement(eo,{enabled:$&&"idle"===F,menuItems:ne,onStart:$&&"drawing"===F?()=>{var e;return null==(e=q.current)?void 0:e.stop()}:void 0}):m.exports.createElement(eo,{enabled:$,menuItems:ee})),[$,F,q,V]),me=m.exports.useMemo((()=>B&&"offline"==B.input.mode&&m.exports.createElement(So,{className:"play",currentFile:B.input.data_path,pause:l,setPause:c,onPlay:P})),[B,l,c]),ue=m.exports.useMemo((()=>I),[I,N]),pe=m.exports.useMemo((()=>{var e,t,n,a,o,l,i;return m.exports.createElement("div",null,m.exports.createElement("div",{style:{color:"white",position:"fixed",fontSize:"14px",bottom:0,right:0}},B&&"offline"==B.input.mode&&`${function(e){if(null==e||null==e)return"";const t=new Date(e/1e3),n=t.getMonth()+1,a=t.getDate(),r=t.getHours(),o=t.getMinutes(),l=t.getSeconds(),i=t.getMilliseconds();return[t.getFullYear(),(n>9?"":"0")+n,(a>9?"":"0")+a].join("-")+" "+[(r>9?"":"0")+r,(o>9?"":"0")+o,(l>9?"":"0")+l].join(":")+"."+i.toString().padStart(3,"0")}(null==(e=null==d?void 0:d.header)?void 0:e.timestamp)} `,`FPS:${Ro(r.fps,2)} / ${Ro(null==(t=null==d?void 0:d.header)?void 0:t.fps,2)}`),m.exports.createElement("div",{style:{color:"white",position:"fixed",fontSize:"14px",bottom:0,left:0}},`Lat:${Ro(null==(n=null==d?void 0:d.pose)?void 0:n.latitude,6)} Lon:${Ro(null==(a=null==d?void 0:d.pose)?void 0:a.longitude,6)}\n              Yaw:${Ro(null==(o=null==d?void 0:d.pose)?void 0:o.heading,2)} Status:${null==(l=null==d?void 0:d.pose)?void 0:l.state}(${null==(i=null==d?void 0:d.pose)?void 0:i.status})`))}),[r.fps,d]),de=m.exports.useMemo((()=>k&&m.exports.createElement(No,{setShowMapSaving:M,setPause:c})),[k,M,c]),fe=m.exports.useMemo((()=>"SLAM"==V&&B&&"localization"==B.slam.mode&&m.exports.createElement(Po,{onClick:ae,disable:"drawing"==Z},m.exports.createElement(vt,null))),[V,B,Z]);return m.exports.createElement("div",{style:{position:"relative"}},m.exports.createElement("div",{className:"scene"},le),ie,se,ce,pe,me,ue,de,fe)},calibration:function(){const{t:e}=v();let t=Tt("/:item"),n=jt();const a=ke((e=>e.avfuns)),r=Me(),[o,l]=m.exports.useState(dr.avfuns.calibration);return m.exports.useEffect((()=>{const e=Er();r(e)}),[]),m.exports.useEffect((()=>{"object"==typeof a&&l(a.calibration)}),[a]),"/"===(null==t?void 0:t.pathname)&&(t.pathname=""),u.createElement(u.Fragment,null,u.createElement(Jl,null,n.pathname===(null==t?void 0:t.pathname)&&u.createElement(re,{container:!0,spacing:2},Object.entries(Kl).map((([t,n])=>{if(o[t])return u.createElement(re,{item:!0,xs:12,sm:6,key:t},u.createElement(x,{to:t,style:{textDecoration:"none"}},u.createElement(Zl,{fullWidth:!0,variant:"contained"},e(n.name))))})))),u.createElement(Bt,null,Object.entries(Kl).map((([e,t])=>{if(!t.component)return;const n=t.component;return u.createElement(Ut,{path:e,key:e,element:u.createElement(n,null)})}))))}},Us={},Gs={configDev:function(){const[e,t]=m.exports.useState(!0),n=ai(),{t:a}=v(),[r,o]=m.exports.useState("BoardConfig");return u.createElement(u.Fragment,null,u.createElement(S,null,e||u.createElement(j,{open:!0,className:n.backdrop},u.createElement(B,{color:"inherit"})),u.createElement("div",{style:{display:"flex"}},u.createElement("div",{style:{width:"15%",marginRight:0}},u.createElement(re,{style:{marginTop:"1rem",marginLeft:"1rem"},container:!0},u.createElement(re,{item:!0,xs:12,zeroMinWidth:!0},u.createElement(oe,null,u.createElement(le,null,a("Mode")),u.createElement(ie,{label:a("mode"),name:"mode",value:r,onChange:e=>{o(e.target.value)}},u.createElement(I,{value:"BoardConfig"},a("BoardConfig")),u.createElement(I,{value:"SelectFunctions"},a("SelectFunctions"))))))),u.createElement("div",{style:{width:"70%",marginTop:"1rem"}},u.createElement("div",{hidden:"BoardConfig"!=r},u.createElement(ni,{setIsLoaded:t})),u.createElement("div",{hidden:"SelectFunctions"!=r},u.createElement(ei,{setIsLoaded:t}))))))}};function Vs(){const[e,t]=Cn("devMode",!1),[n,a]=w("theme",!1),[r,o]=m.exports.useState(u.createElement("div",null)),[l,s]=m.exports.useState(),c=m.exports.useRef(),p=Et();let d=Tt("/:item");const{data:f,run:g,cancel:h}=U(ta,{pollingInterval:1e4,loadingDelay:1e3,onSuccess:e=>{"registered"==e.licence?h():"error"==e.licence&&"/licence"!=(null==d?void 0:d.pathname)&&p("/licence",{replace:!0})}}),E="/editor"==(null==d?void 0:d.pathname)?[]:l?["home","upgrade"]:ye.concat("home",Object.keys(Bs),Object.keys(Us)),v="/editor"==(null==d?void 0:d.pathname)?[]:Object.keys(Gs);m.exports.useEffect((()=>{e?_t.enableAll():_t.setLevel(_t.levels.WARN)}),[e]),m.exports.useEffect((()=>{c.current&&"/editor"==(null==d?void 0:d.pathname)?o(c.current.menuBar()):o(u.createElement("div",null))}),[c,d]);let x=u.useMemo((()=>u.createElement(Zi,{ref:c})),[c]);return u.createElement(Pn,{isDarkMode:n},u.createElement(Fa,i({},{isDeveloperMode:e,setIsDeveloperMode:t,isDarkMode:n,setIsDarkMode:a,userLinks:E,menuBars:r,developerLinks:v})),u.createElement(Bt,null,u.createElement(Ut,{path:"/"},u.createElement(Ut,{index:!0,element:u.createElement($a,{onSuccess:()=>s(void 0)})}),u.createElement(Ut,{path:"home",element:u.createElement($a,{onSuccess:()=>s(void 0)})}),u.createElement(Ut,{path:"licence",element:u.createElement(ts,null)}),u.createElement(Ut,{path:"users",element:u.createElement(rs,null)}),u.createElement(Ut,{path:"tviz",element:u.createElement(js,null)}),u.createElement(Ut,{path:"editor",element:x}),Object.entries(i(i(i({},Bs),Us),Gs)).map((e=>{const[t,n]=e;return u.createElement(Ut,{key:t,path:`/${t}/*`,element:u.createElement(n,null)})})))))}var Hs=Sn({reducer:{avfuns:hr}});kn.render(u.createElement(u.StrictMode,null,u.createElement(Mn,null,u.createElement(In,{store:Hs},u.createElement(Vs,null)))),document.getElementById("root"));
